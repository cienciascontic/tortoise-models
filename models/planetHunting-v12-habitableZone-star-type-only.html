



<html>
  <head>
<link rel="stylesheet" type="text/css" href="app.css" charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="app-custom.css" charset="utf-8"/>
  </head>
  <body>
    <div id="model-container"></div>
<script type="text/javascript" src="app.js"></script>
    <script type="text/javascript">
;

      var session =
        (function () {
          var widgets = [{"left":260,"top":10,"right":903,"bottom":596,"patchSize":6.53,"fontSize":10,"wrappingAllowedInX":false,"wrappingAllowedInY":false,"minPxcor":-48,"maxPxcor":48,"minPycor":-42,"maxPycor":42,"updateMode":"Continuous","showTickCounter":false,"tickCounterLabel":"ticks","frameRate":30.0,"type":"view"},{"display":"reset model","left":84,"top":10,"right":166,"bottom":43,"source":"startup\nset custom-planet false","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(startup);\nworld.observer.setGlobal('custom-planet', false);"}},{"display":"Simulation-speed","left":261,"top":10,"right":903,"bottom":43,"varName":"Simulation-speed","min":"1","max":"100","default":15.0,"step":"1","units":null,"direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"1"},"compiledMax":{"success":true,"result":"100"},"compiledStep":{"success":true,"result":"1"}},{"display":"Run/Pause","left":3,"top":10,"right":84,"bottom":43,"source":"go","forever":true,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"Star-Type","left":2,"top":169,"right":254,"bottom":214,"varName":"Star-Type","choices":["M - red (temp 3120 K)","K - orange (temp 4640 K)","G - yellow (temp 5920 K) -> our Sun","F - white (temp 7240 K)","A - blue (temp 8620 K)"],"currentChoice":2,"type":"chooser"},{"display":"Select a star to observe where (shown in blue) an orbiting planet could have liquid water.","left":6,"top":113,"right":251,"bottom":167,"fontSize":14,"color":0.0,"transparent":true,"type":"textBox"},{"display":"Note: For a sense of scale, Earth will be shown oribiting at 1 au from each star.","left":15,"top":217,"right":250,"bottom":260,"fontSize":12,"color":14.0,"transparent":true,"type":"textBox"}];
          var code    = "globals [\n  insert-on?   ; tells whether the insert is visible--only happens for an occultation\n  insert-size  ; tells the size of the square insert\n  old-sim-speed ; used to store sim-speed while slowed down for occultation\n  G            ; the universal constant in HKS units \n  star-diameter\n  AU \n  sec/yr\n  radial-v-data                                ; a list of radial-velocity points each store-interval\n  store-interval                               ; the number of seconds between data points in radial-v-data\n  sim-speed\n\n  mouse-was-up?                                ; needed to call once when the mouse is first clicked\n  mousex  mousey                               ; cumulative motion of the mouse\n  starting-mousex  starting-mousey             ; starting location of the mouse for the current drag\n  theta                                        ; the tilt of the scene\n  dist                                         ; the distance from the observer to the star\n  old-distance                                 ; stores the old distance to the star\n  grid-size\n  scale                                        ; the number of patches per AU \n  old-theta                                    ; these remember the angles when a mouse drag event started\n  old-preset-planets                           ; remembers the previous value of preset-planets--used for triggering response to changes. \n  old-planet-mass\n  old-star-type\n \n  slow-speed                                   ; simulation speed during occultation\n  delta-t                                      ; the integration step size in years\n  first-step?                                  ; when the integration starts, it taks a half-step. This tells whether any step is the first. \n  bread-crumb-lifetime                                 ; the number of years bread-crumbs last\n  elapsed-time                                 ; the total amount of time since the last planet-making \n  last-bread-crumb-time                                ; the last time a bread-crumb was left behind\n  time/bread-crumb                                     ; how often bread-crumbs are created\n  v-scale                                      ; scales the velocity vector so that a velocity of v shows as v-scale * v  distance in the grid\n  last-plot-time\n  brightness\n  planet-mass\n  xRangeMin                                   ;lower bound of graph x-axis\n  xRangeMax                                   ;upper\n\n  last-velocity\n  last-brightness\n  new-planet\n  new-star\n  \n  plot-interval\n  days-per-year\n  b-y-max\n  b-y-min\n  v-y-max\n  v-y-min\n  \n  outerHZRad\n  innerHZRad\n  star-list\n  star-mass-list\n  outerHZ-list\n  innerHZ-list\n  view-scale-list\n  sun-size\n  solar-mass\n  earth-mass\n  star-color-list\n  star-rad-list\n  analyzing-solar-system?\n  orbital-dist-points\n  give-non-gas-feedback?\n  give-gas-feedback?\n  \n  graph-time-window\n  telescope-precision\n  magnify-y-axis\n  resetting?\n  grid-scale\n  planet-diameter\n  rocky-planet\n  custom-planet\n  preset-planets\n  ]\n\nbreed [outerHZ]\nbreed [innerHZ]\nbreed [bread-crumbs]                          ; used to mark where the planet has been\nbreed [planets planet]\nbreed [arrowheads arrowhead]                  ; used for velocity vector\nbreed [stars star]\nbreed [front-planets front-planet]            ; this will appear in front of the star b/c they are declared after the star\nbreed [front-arrowheads front-arrowhead]      ; ditto22\nbreed [spots]                                 ; grid end-points are used to make the grid\nbreed [insert-background]\nbreed [insert-star]\nbreed [insert-planet]\n;breed [velvals velval]\n;breed [lightvals lightval]\nbreed [view-displays view-display]                     ; These sit in the upper right and report angle, mass, and instructions. \n\nplanets-own [x-cor y-cor vx vy mass phase w-cor w-vel ]  ; the x-y pairs are measured in AU w-cor is measured in screen coords\nstars-own [x-cor y-cor vx vy mass phase w-cor w-vel ]\nspots-own [xs ys]                              ; the x-y pairs are measured in AU\nbread-crumbs-own [xd yd age]                   ; as they age, they fade away and eventually die\narrowheads-own [xa ya]                         ; the problem coordinats of the arrowhead\n\n;velvals-own [velocity time]\n;lightvals-own [bright time] \n           \nview-displays-own [number]                     ; this is how I tell them apart. 0 will be angle 1, mass and 2 user instructions\ndirected-link-breed [pointers pointer]         ; used to point out small planets that can't be seen\nundirected-link-breed [glines gline]           ; used for grid lines\n\nto startup\n  ca\n  ;  set startup variable values\n  set insert-on? false                         ; code stest this true around occulations\n  set insert-size 2 * max-pycor / 3            ; the patch size of the insert square-- 1/3 of the vertical height\n  set G 0 - 2 * 5.922e-5                           ; the universal gravitational constant in AU, years, and earth-mass units\n  set AU 1.5e8\n  set star-diameter 1.39e6 / AU                ; the star's diameter in AU    \n  set sec/yr 3.16e7\n  set store-interval 1 / 365.12                ; a day in years \n  set radial-v-data [ ]                        ; this declares it as a list\n  set slow-speed .1                            ; simulation speed during transit\n  set old-sim-speed .2                   ; used to return the simulation speed to its value before a transit  \n  set theta 0 \n  set scale 140                                ; in units of patches per AU\n  set grid-size 5                              ; total distance from left to right (and top to bottom) of grid\n  set old-distance 5                          ; distance to observer (always 2x grid size for reasonable distortion) \n  set grid-scale \"1 box = 0.25 au\"\n  set dist scale-to-num grid-scale\n  set mouse-was-up? true\n  set delta-t  .000003                         ; the integration step size in years (gets multiplied by the sim-speed which goes from 0 to 100. \n  set bread-crumb-lifetime  3                          ; the number of years bread-crumbs last\n  set elapsed-time 0\n  set time/bread-crumb .05                             ; the time between bread-crumbs\n  set v-scale 0.003 * dist ^ 1.5                               ; a multiplier of v to determine the length of the velocity vector\n  set last-plot-time 0\n  set brightness 1                             ; default brightness of the star\n  set custom-planet false                         ; start in the 'run' mode\n  set old-preset-planets \"Earth\"              ; used the first time through to detect user change of the preset-planets selector\n  set first-step? true\n  set days-per-year 365\n  set b-y-max 1.000\n  set v-y-max 8.6\n  set b-y-min 0.25\n  set v-y-min 1.0e-5\n  set graph-time-window 500\n  set telescope-precision 100\n  set magnify-y-axis 7000\n  \n  set sun-size 3\n  set earth-mass 5.97e24\n  set solar-mass 1.99e30 / earth-mass           ; in Earth Masses\n  set outerHZRad 1.37\n  set innerHZRad 0.95\n  set star-list [\"M - red (temp 3120 K)\" \"K - orange (temp 4640 K)\" \"G - yellow (temp 5920 K) -> our Sun\" \"F - white (temp 7240 K)\" \"A - blue (temp 8620 K)\"]\n  set star-mass-list (list (solar-mass * 0.21) (solar-mass * 0.69) (solar-mass * 1) (solar-mass * 1.29) (solar-mass * 2.1))\n  set star-color-list (list red orange yellow white cyan)\n  set star-rad-list (list (0.32 * sun-size) (0.74 * sun-size) (1 * sun-size) (1.2 * sun-size) (1.7 * sun-size))\n  set old-star-type item 2 star-list\n  set outerHZ-list [0.12 0.55 1.37 2.17 6.14]\n  set innerHZ-list [0.08 0.38 0.95 1.5 4.26]\n  set view-scale-list [\"1 box = 0.25 au\" \"1 box = 0.25 au\" \"1 box = 0.25 au\" \"1 box = 0.50 au\" \"1 box = 1.00 au\" ]\n  set star-type item 2 star-list\n  set analyzing-solar-system? false\n  set orbital-dist-points []\n  set give-non-gas-feedback? true\n  set give-gas-feedback? true\n;  set preset-planets \"Earth\"\n  \n  ;graphing variables:\n  set xRangeMin 0\n  set xRangeMax graph-time-window\n;  set yVelList [ ]\n;  set yLightList [ ]\n  \n  ; create various turtles\n  create-planets 1 [set shape \"circle\"\n    set color blue\n    set size 2 \n;    set x-cor .707                               ; place it about 1/8 around an orbit\n;    set y-cor .707\n;    set vx -2 * pi * .707\n;    set vy 2 * pi * .707                          ; in astronomical units per year. At r = 1 it travels 2pi AU per year\n;    let loc (screen-coords x-cor y-cor)\n;    let u first loc   let v item 1 loc\n;    if in-view? u v  [ setxy u v ]\n    set label \"Planet\"\n    ]  \n  set new-planet planet 0\n  create-stars 1 [\n    set shape \"circle\" \n    set color yellow\n    set mass solar-mass  \n    setxy 0 0 \n    set size sun-size ]\n;    set label \"Star\"\n;    set label-color orange]\n  set new-star star 1 \n  create-arrowheads 1 [set shape \"default\" set color red set size 3 ht ]\n  create-outerHZ 1 [\n    set shape \"circle\" \n    set color [18 99 146 125]\n    setxy 0 0 \n    set size tsize outerHZRad ]\n create-innerHZ 1 [\n    set shape \"circle\" \n    set color [0 0 0 200]\n    setxy 0 0 \n    set size tsize innerHZRad ]\n  create-front-planets 1 \n    [set shape \"circle\"\n    set color blue\n    set label \"Planet\"\n    set size 2 ]      ; create a planet and arrowhead that will go behind the sun\n  create-front-arrowheads 1  [set shape \"default\" set color red set size 3 ht ]\n  \n  create-view-displays 1 [set color black set size 0 setxy max-pxcor - 20 min-pycor + 3 set number 0 ht] ; used for instructions. \n  create-view-displays 1 [set color black set size 0 setxy max-pxcor - 37 min-pycor + 1 set number 1 ht] ; used for instructions. \n  create-view-displays 1 [set color black set size 0 setxy max-pxcor  max-pycor - 2.5 set number 2 ] ; used for mass. \n  create-view-displays 1 [set color black set size 0 setxy max-pxcor  max-pycor - 4.5 set number 3 ] ; used for tilt.\n  create-view-displays 1 [set color black set size 0 setxy min-pxcor + 23 max-pycor - insert-size + 1 set number 4 ] ; used for tilt.\n\n  create-insert-background 1 [            ; this is the background for the insert, shown only during a transit\n    setxy (min-pxcor + insert-size / 2 ) (max-pycor - insert-size / 2 )\n    set shape \"frame\"\n    set size  insert-size \n    ht]                                         ; hide for the time being \n  create-insert-star 1 [\n    setxy (min-pxcor + insert-size / 2 ) (max-pycor - insert-size / 2 )\n    set shape \"circle\"\n    set size insert-size / 2\n    set color yellow \n    ht ]\n  create-insert-planet 1 [\n    set shape \"circle 2\"\n    set color yellow \n    setxy (min-pxcor + insert-size / 2 ) (max-pycor - insert-size / 2 ) \n    ht ]\n\n;  new-grid grid-size                             ; creates the grid but doesn't show it\n;  ask bread-crumbs [ht set label-color black ]\n;  set dist grid-scale                      ; reads the slider that sets the distance to the star. \n  \n  ask new-planet [ create-glines-with arrowheads ]\n  set simulation-speed 15\n;  scale-variables grid-scale                       ; certain variables scale with the distance from the obsever to the star   \n  \n  new-grid 2.5\n;  set Preset-Planets \"Earth\"                             ; initialize the screen with the earth\n  set resetting? true\n  handle-presets\n;  do-scale-change  \n  set theta 0    \n;  update-screen                                          ; draw everything\n  output-print parse-output \"Create a solar system and press the 'check solar system' button to get feedback on the planet's ablity to support life.\"\n  go\nend\n\nto go                                                    ; this is called from a forever button\n  every .01 [\n    let v sqrt (([vx] of new-planet) ^ 2 + ([vy] of new-planet) ^ 2 )\n    ifelse insert-on?                           ; set the simulation speed from the slider normally except during occultation \n    [ set sim-speed ifelse-value (v > 10) [slow-speed / 6] [slow-speed]]        ; slow speed (extra slow for fast moving planets)\n    [ set sim-speed .2 * simulation-speed ^ 2  ]]     ; default speed\n  if old-star-type != star-type [\n    update-star ]\n  ifelse custom-planet                                     ; the program is modal depending on the \"make planet\" switch\n    [ handle-messages  \n      set-planet-mass                                     ; read the diameter slider and rocky planet switch to generate the planet mass\n      if not (Preset-Planets = old-Preset-Planets) [      ; has the user changed it preset-planets selector? If so, attend to it. \n        set old-Preset-Planets Preset-Planets             ; reset the old preset variable\n        if not (Preset-Planets = \"Custom\")                ; if the user has just selected anything but 'custom,' handle the preset \n          [handle-presets do-scale-change ]]\n      adjust-planet                                       ; supports custom planets always if make-planet is on. \n      do-scale-change\n      set first-step? true\n     ]  \n    [ ifelse Preset-Planets = \"No Planet\"\n      [ handle-presets\n        new-angles\n        step-forward-in-time\n;        support-graphs\n        ask planets [ht]\n        ask gline 0 2 [set hidden? true]\n        ask bread-crumbs [die]\n        ask arrowheads [ht]\n        ask front-arrowheads [ht]\n        ask front-planets [ht]\n        ask insert-background [ht]\n        ask insert-planet [ht]\n        ask insert-star [ht]\n        ask view-displays [ht]\n        set sim-speed  .2 * simulation-speed ^ 2\n      ]\n      [ handle-messages\n        set-planet-mass     \n        if not (Preset-Planets = old-Preset-Planets) [      ; has the user changed it preset-planets selector? If so, attend to it. \n          set old-Preset-Planets Preset-Planets         ; reset the old preset variable        \n                                                        ;          if not (Preset-Planets = \"Custom\")                ; if the user has just selected anything but 'custom,' handle the preset \n          handle-presets ]  \n        handle-occultation                         ; if the user isn't changing the planet, then run the simulation\n ;       new-angles                                 ; read the mouse and set theta and phi\n        do-scale-change                            ; check for scale change\n        step-forward-in-time              \n;        support-graphs\n        set first-step? false\n      ]\n    ]              \nend\n\nto check-solar-system\n  clear-output\n  output-print \"Analyzing....\"\n  set analyzing-solar-system? true\n  set custom-planet false\n  set orbital-dist-points []\nend\n\nto generate-analysis\n  clear-output\n  let output \"\"\n  let good-star-type? (star-type = item 1 star-list or star-type = item 2 star-list or star-type = item 3 star-list)\n  if (not good-star-type?) \n    [ ifelse star-type = item 0 star-list \n      [ set output (word output \"STAR TYPE: -\\nM-class stars have a very narrow zone in which liquid water could exist on the planet's surface.  Additionally, the zone is very close to the star. \\n\\nPLANET ROTATION: -\\nAny planet close enough to be in the liquid water zone of an M-class star would stop rotating over time.  One side of the planet would be very hot (facing the star) and the other side would be very cold (facing away from the star). \")\n        output-print parse-output output\n        stop ]\n      [ set output (word output \"STAR TYPE: -\\nA-class stars give off enormous amounts of ultraviolet radiation and have a relatively short lifespan, compared to other stars. \")\n        output-print parse-output output \n        stop ]]\n  if (not rocky-planet) [\n    set output (word output \"PLANET TYPE: -\\nThe chemical building blocks of life are rare on gaseous planets.  They are composed primarily of hydrogen and helium, with little carbon or water. \")\n    output-print parse-output output\n    stop ]\n  let large-enough? ([mass] of new-planet > 2.5e24 / earth-mass)     ; planet must be more than four time the mass of mars\n  if not large-enough? [\n    set output (word output \"PLANET SIZE: -\\nThe planet's mass is too small to exert enough gravitational force to hold an atmosphere.  Atmospheric gases will escape into space. \")\n    output-print parse-output output\n    stop ]\n  let avg-dist mean orbital-dist-points\n  let avg-dist-in-HZ (avg-dist >= innerHZRad and avg-dist <= outerHZRad)\n  let min-orbit min orbital-dist-points\n  let max-orbit max orbital-dist-points\n  let too-close? (min-orbit < innerHZRad)\n  let too-far? (max-orbit > outerHZRad)\n  let in-HZ? (not too-close? and not too-far?)\n  let passes-through-HZ? (min-orbit < innerHZRad and max-orbit > outerHZRad)\n  if passes-through-HZ? [\n    set output (word output \"ORBITAL DISTANCE: -\\nThere will be very large temperature swings as the planet orbits. Surface water will evaporate when too close to the star and freeze when the planet moves beyond the liquid water zone. \")\n    output-print parse-output output\n    stop ]\n  if too-close? [ \n    set output (word output \"ORBITAL DISTANCE: -\\nThe planet passes too close to the star. It will be very hot, causing water to evaporate at high rates, which could lead to a runaway greenhouse effect and/or cause water loss to space. \")\n    output-print parse-output output\n    stop]\n  if too-far? [\n    set output (word output \"ORBITAL DISTANCE: -\\nThe planet orbits too far from the star. It will be very cold, causing any surface water to be frozen. \")\n    output-print parse-output output\n    stop ]\n    \n  set output (word output \"STAR TYPE: +\\nThe star has a wide zone in which liquid water could exist.  The star's lifespan is more than one billion years, allowing time for life to evolve. \")\n  set output (word output \"\\n\\nPLANET TYPE: +\\nRocky planets are more likely to contain the chemical building blocks of life than gaseous planets. \")\n  set output (word output \"\\n\\nORBITAL DISTANCE: +\\nThe planet orbits within the zone in which liquid water could exist on the surface of the planet. \") \n  set output (word output \"\\n\\nPLANET SIZE: +\\nThe planet is large enough to hold an atmosphere.  It is also large enough to have tectonic activity (volcanoes and movement of planetary surfaces).  Tectonic activity allows for rock recycling on the planet, helping to stabilize atmospheric carbon dioxide levels, which stabalizes global temperatures. \")\n  output-print parse-output output\nend\n\nto handle-messages \n   if custom-planet [\n;      ask view-displays with [number = 0] [st set label \"Use the mouse to move the planet or use one of the presets.\" setxy max-pxcor - 25 min-pycor + 3]\n      ask view-displays with [number = 1] [st set label \"When you are ready to run the model, turn off the 'custom-planet' switch.\" setxy max-pxcor - 20 min-pycor + 1]]\n   if not custom-planet  [\n;      ask view-displays with [number = 0] [st set label \"Drag the mouse up or down to change the tilt.\" setxy max-pxcor - 30 min-pycor + 3]  \n      ask view-displays with [number = 1] [st set label \"To move the planet, turn on the 'custom-planet' switch.\" setxy max-pxcor - 27 min-pycor + 1]]\nend\n                \nto handle-occultation     ; looks for an occultation and sets globals to slow the simulation, show the insert, and warn the user. \n    if (near-occ? and not insert-on?) [               ; check for an occultation starting\n;    set sim-speed slow-speed\n    set insert-on? true \n    output-print \"A transit is coming up!!\"\n    ifelse planet-diameter > 4.2  \n        [output-print \"Watch the insert.\"]\n        [output-print \"The planet is too small to see.\"]\n    output-print \"Simulation slowed\" ]\n  if insert-on? and not near-occ? [               ; check for an occultation ending\n    set insert-on? false                          ; remove the insert\n    clear-output ]                                ; remove the message about occultation\nend\n\nto do-scale-change                                    ; handles scale changes     \n  let d 0                                         ; gives d the scope of this proceedure\n  ifelse grid-scale = \"From Earth\"\n    [set d 1e4] [set d scale-to-num grid-scale]         ; handle string in grid-scale chooser\n  update-scale d\nend\n\nto update-scale [d]                              ; handles scale change if needed\n  ifelse ( old-distance = d)                     ; check to see whether the distance has changed \n    [                                            ; go here if there is no change in the distance to star\n      set dist d                                 ; dist is used in 'screen-coords'  This line is probably unnecessary\n      ifelse d <= 500 \n        [ update-screen \n          ]                                      ; draw the grid, only if at 100 AU or closer\n        [ ask spots [ht]\n          ask arrowheads [ht]\n          ask bread-crumbs [ht]  \n          ask planets [ht] \n          ask glines [hide-link]\n;          create-spots 1 [st setxy 0 0 set size 1 set color white]\n          ]]                         ; grid end-points are used to make the grid\n\n    [ \n      ask bread-crumbs [die]                                            ; user changed view. pan to new value and redraw the grid\n      let n 50                                    ; in n steps\n      set dist old-distance                       ; starting at the old distance\n      let dd ( d - old-distance ) / n             ; step size\n      ifelse dd > 0                               ; check to see whether the grid is contracting (first option) or expanding (second)\n        [                                         ; if contracting (getting farther away), pan first, then redraw\n          repeat n [                              ; \n            set dist dist + dd                    ; don't need first step--that's old\n            update-screen ]\n          set old-distance d\n          set grid-size d / 2                     ; redraw grid with a size that is half the distance to the star. \n;          ask spots [die]                        ; restore this if we hate keeping the smaller grid \n          new-grid grid-size ]\n        [                                         ; if expanding (getting closer) redraw first then pan\n          set grid-size d / 2                     ; redraw grid with a size that is half the distance to the star. \n          ask spots [die]\n          new-grid grid-size \n          repeat n [                              ; \n            set dist dist + dd                    ; don't need first step--that's old\n            update-screen ]\n          set old-distance d\n        ]                                          ; end of pan\n    ; for the new scale, we need new values of time/bread-crumb, bread-crumb-lifetime,  v-scale, and delta-t. They scale as d ^.5\n    scale-variables d\n     ]\nend\n    \nto scale-variables [d]\n    let f d ^ 1.5\n    set bread-crumb-lifetime  .08 *  f            ; the number of years bread-crumbs last\n    set time/bread-crumb .0006 *   f              ; the time between bread-crumbs in years\n ;   set v-scale .003 * f\n ;   set delta-t .0000002 * f                      ; the time step, in earth-years                                      \nend \n\nto update-screen                                  ; uses dist, and redraws the star, planet, grid, arrowhead and bread-crumbs.  \n    ask spots                                     ; moves grid end-points using the new value of theta\n      [ st\n        let loc screen-coords xs ys\n        let u first loc   let v item 1 loc\n        ifelse in-view? u v \n          [setxy u v st]\n          [ht]]\n    ask planets [\n       let loc screen-coords x-cor y-cor\n       let u first loc   let v item 1 loc\n       set w-cor last loc                          ; w-cor is the distance in or out of the screen of the planets in patch units. \n       ifelse in-view? u v \n         [ setxy u v st\n           ask gline 0 2 [show-link]]\n          [ht \n           ask gline 0 2 [hide-link]\n           ask arrowheads [ht]\n           ask front-arrowheads [ht]\n           ask front-planets [ht]]]\n    ask stars [\n       let loc screen-coords x-cor y-cor\n       let u first loc   let v item 1 loc\n       set w-cor last loc                          ; w-cor is the distance in or out of the screen of the planets in patch units. \n\n       ifelse in-view? u v \n          [setxy u v st\n            ask outerHZ [\n              setxy u v\n              set size tSize outerHZRad ]\n            ask innerHZ [\n              setxy u v\n              set size tSize innerHZRad ]\n          ]\n          [ht ]]\n    ask bread-crumbs [\n       let loc screen-coords xd yd\n       let u first loc   let v item 1 loc\n       ifelse in-view? u v \n          [setxy u v st]\n          [ht ]\n        set age age + delta-t\n        if age > bread-crumb-lifetime [die] \n        let alpha 255 * (bread-crumb-lifetime - age ) / bread-crumb-lifetime\n        set color lput alpha [255 255 255 ]\n;        set color (bread-crumb-lifetime - age ) * 9.9 / bread-crumb-lifetime  ; Starts white, faces to black over bread-crumb-lifetime time. \n          ] \n    ask arrowheads [  \n        st\n        set xa ( [x-cor] of one-of planets) + v-scale * ( [vx] of one-of planets)   ;  vx is the same for both planets, so I use any one of them.\n        set ya ( [y-cor] of one-of planets) + v-scale * ( [vy] of one-of planets )\n        set heading 180 + towards new-planet  \n        let loc screen-coords xa ya\n        let u first loc   let v item 1 loc\n        ifelse in-view? u v \n          [setxy u v st]\n          [ht ]]  \n    ask front-planets [                        ; this follows the new-planet and shows itself only when going in front of the star\n      let yy [ycor] of new-planet\n      set xcor [xcor] of new-planet\n      set ycor [ycor] of new-planet       ; going in front of star \n      ifelse  yy >= 0 [ ht ] [if not ([hidden?] of new-planet) [st]]]                   ; planet is going in back of star\n    ask front-arrowheads [                      ; this follows the arrowheads and shows itself only when going in front of the star\n      let yy [ycor] of one-of arrowheads \n      set xcor [xcor] of one-of arrowheads \n      set ycor [ycor] of one-of arrowheads       ; going in front of star \n      set heading [heading] of one-of arrowheads\n      ifelse  yy >= 0 [ ht ] [if not ([hidden?] of new-planet) [st]]]                   ; arrowhead is going in back of star\n      \n    ifelse insert-on? ; support the insert if the insert condition is on\n      [ ask insert-star [st]       ; turn on the inserts\n        ask insert-background [st]\n        ask insert-planet [\n          st \n          set size (insert-size * planet-diameter ) / 218   ; 218 is twice the ratio of sun to earth diameters. Insert-size / 2 is the size of the star\n          let x-center min-pxcor + insert-size / 2  ; the center of the insert\n          let y-center max-pycor - insert-size / 2 \n          let u1 [x-cor] of one-of planets\n          let u2 [x-cor] of one-of stars\n          let v1 [ycor] of one-of planets\n          let v2 [ycor] of one-of stars\n          let mag 50 ; magnification of the motion of the planet in the insert\n          let du mag * (u1 - u2) * scale ; displacement from center (in insert-screen units)\n          let dv mag * (v1 - v2)\n          let u x-center + du   ; the insert-planet x-coordinate\n          let v y-center + dv   ; the insert-planet y-coordinate\n          ifelse in-insert? u v [st setxy u v] [ht]\n          ifelse (du ^ 2 + dv ^ 2) < (insert-size / 4 ) ^ 2 ; if the planet is inside the star (which is insert-size / 2 in diameter)\n            [set brightness 1 - ( size * 2 / insert-size ) ^ 2 ] ; the drop in brighhtness is the\n            [set brightness 1 ]                                             ;    square of the ratio of diameters of the planet and star\n        ]\n        if planet-diameter <= 3.4 \n          [ ask view-displays with [number = 4] [\n              st \n              set label \"planet too small to see\" \n              set label-color red\n              ifelse (first [hidden?] of insert-planet) [ask pointers [ hide-link ]] [create-pointers-to insert-planet ask pointers [ show-link]]\n              ]] \n      ]\n      [ ask insert-star [ht]           ; turn off inserts\n        ask insert-background [ht]\n         ask view-displays with [number = 4] [ht]\n        ask insert-planet [ht]\n        ask pointers [hide-link]\n        set brightness 1]\n;   ask view-displays with [number = 3] [set label (word \"The tilt is \" round (90 - theta) \" degrees.\") st]\nend\n\nto-report in-insert? [u v]\n  ifelse u > min-pxcor and u < min-pxcor + insert-size\n     and v < max-pycor and v > max-pycor - insert-size \n     [report true ][ report false ]\nend\n  \nto-report in-view? [u v]        ;tests to see wherther the point u, v can be seen in the view\n  let val ( u > min-pxcor and u < max-pxcor\n    and v > min-pycor and v < max-pycor )          ; tests whether within the screen\n  ifelse insert-on?                                ; further tests are needed if the insert is showing\n    [report val and not in-insert? u v ]\n    [report val]\nend\n\nto set-planet-mass\n  let rel-density 1 / 4.13                         ; the relative density of Jupiter compared to Earth\n  if rocky-planet [set rel-density 1 ]\n  ;  report the mass in terms of the earth's mass\n  let pm rel-density * ( planet-diameter ) ^ 3 \n  ask planets [set mass pm]  \n  ifelse pm < 30 [\n     ifelse pm < 2 \n       [set planet-mass precision pm 3 ]\n       [set planet-mass precision pm 2 ]] ; the planet diameter is in multiples of the earth's diameter. The earth mass is 1 \n     [set planet-mass round pm ]       ; show decimals only for low masses\n  ask view-displays with [number = 2][\n    set label (word \"The planet's mass is \" planet-mass \" times the earth's mass.\")\n    st]\nend   \n\nto adjust-planet                                    ; support the mouse as it adjusts the location and speed of the planet\n  ask bread-crumbs [die]\n  set theta 0\n  update-screen\n  if (mouse-inside? and mouse-down? \n     or not (old-planet-mass = planet-mass)) [                ; put up velocity vector, support user movements \n     set Preset-planets \"Custom\"                    ; if you get here, assume that the user is making a custom planet\n     set old-preset-planets \"Custom\"\n     set old-planet-mass planet-mass\n             ; first determine whether the planet or the arrowhead is nearer, then move the nearest\n     let loc-planet screen-coords ([x-cor] of new-planet) ([y-cor] of new-planet)   \n     let loc-arrowhead screen-coords ([xa] of one-of arrowheads) ([ya] of one-of arrowheads)\n     let loc-mouse (list mouse-xcor mouse-ycor 0) \n     \n; if the planet is now off screen ( in-view? is false for the planet ) bring it on screen\n     if not in-view? first loc-planet item 1 loc-planet [\n          ask new-planet [\n             set x-cor .1 * scale-to-num grid-scale\n             set y-cor .1 * scale-to-num grid-scale ]\n          ask arrowheads [\n             set xa .09 * scale-to-num grid-scale\n             set ya .11 * scale-to-num grid-scale ]\n          set loc-planet screen-coords ([x-cor] of new-planet) ([y-cor] of new-planet)   \n          set loc-arrowhead screen-coords ([xa] of one-of arrowheads) ([ya] of one-of arrowheads)\n          update-screen ]\n     \n     ifelse dist-between loc-mouse loc-planet < dist-between loc-mouse loc-arrowhead\n        [   ; do this block if the planet is closest\n            ; convert the screen coordinates of the mouse to problem cooridinates (x, y)\n            ; this is simplified because the view is fixed perpendicular to the user. Thus theta is zero and both z and zpp are zero. \n        while [ mouse-inside? and mouse-down? ][\n          ask planets [\n            let u mouse-xcor  let v mouse-ycor\n            set x-cor dist  * u / scale   ; this is the inverse transformation from screen coords to problem coords. \n            set y-cor dist  * v / scale ]\n          ask arrowheads [ \n           set xa ([x-cor] of one-of planets + v-scale * [vx] of one-of planets ) \n           set ya ([y-cor] of one-of planets + v-scale * [vy] of one-of planets )\n           set heading 180 + towards new-planet  ]\n        update-screen ]\n        ]\n        [  ; do this block if the arrowhead is nearest the cursor \n          while [ mouse-inside? and mouse-down? ][\n            ask arrowheads [\n              let u mouse-xcor  let v mouse-ycor\n              set xa dist  * u  / scale     ; this is the inverse transformation from screen coords to problem coords. \n              set ya dist  * v / scale \n              set heading 180 + towards new-planet]\n            ask planets [                                           ; set its vx and vy\n              set vx ([xa] of one-of arrowheads  - x-cor ) / v-scale\n              set vy ([ya] of one-of arrowheads  - y-cor ) / v-scale ]\n            update-screen ]\n          ]\n    scale-variables scale-to-num grid-scale\n    set v-scale 0.003 * scale-to-num grid-scale ^ 1.5  \n    ]   ; do nothing if the mouse is not inside the screen and not down\nend\n\n\nto-report near-occ?                 ; Tests for occultation. This will result in showing the insert and slowing the simulation\n  let u1 [x-cor] of one-of planets       ; xcor is the horizontal screen location\n  let u2 [x-cor] of one-of stars\n  let v1 [ycor] of one-of planets       ; xcor is the horizontal screen location\n  let v2 [ycor] of one-of stars\n  let w1 [w-cor] of one-of planets      ; this is the distance in or out of the screen toward the user\n  let w2 [w-cor] of one-of stars\n;show (word \"x-dist=\" abs (u1 - u2) \"   y-dis=\" abs (v1 - v2))\n;  ifelse (2 * abs (v1 - v2) + abs (u1 - u2)) < .3 and w1 < w2 \n  ifelse ((abs (u1 - u2) < 0.005) and (abs (v1 - v2) < 1e-14)) and w1 < w2\n    [report true ]       ; if the star and new-planet are near each other\n                         ;   and the planet is on the observer's side of the star, an occultation is near. \n    [report false ]      ; \nreport false\nend\n\nto step-forward-in-time \n  ; moves the planet and star ahead one integration step. Creates bread crumbs. The results are stored in the objects, not shown, yet\n  let time-step delta-t * sim-speed    \n  if first-step? [\n    ask stars [\n      set w-cor last screen-coords x-cor y-cor ]      ; initialize w-cor--used for sun velocity and occultation calculations \n    set last-bread-crumb-time 0  ]                  ; initialize the bread-crumb timer \n  ask planets [                                    ; standard Euler integration, but with half-step\n    set x-cor x-cor + vx * time-step / 2              ; move ahead a half-interval, to get a better average x for the acceleration\n    set y-cor y-cor + vy * time-step / 2  \n    let factor G * [mass] of one-of stars / ( x-cor ^ 2 + y-cor ^ 2 ) ^ 1.5 \n    let ax x-cor * factor                             ; note G is negative\n    let ay y-cor * factor\n    set vx vx + ax * time-step\n    set vy vy + ay * time-step\n    set x-cor x-cor + vx * time-step / 2              ; move ahead the other half-interval\n    set y-cor y-cor + vy * time-step / 2   \n    set elapsed-time elapsed-time + time-step ]\n  if last-bread-crumb-time + time/bread-crumb\n        < elapsed-time [                               ; time to create a new bread-crumb\n    set last-bread-crumb-time elapsed-time             ; used to be \"last-bread-crumb-time + time/bread-crumb\"\n    create-bread-crumbs 1 [\n      set shape \"dot\"\n      set size 1\n      set color orange\n      set age 0\n      set xd [x-cor] of one-of planets\n      set yd [y-cor] of one-of planets ]\n    ifelse analyzing-solar-system? and (length orbital-dist-points < 100 and (star-type != item 0 star-list and (star-type != item 4 star-list and ((rocky-planet) and ([mass] of new-planet > 2.5e24 / earth-mass)))))[\n      set orbital-dist-points fput dist-between list ([x-cor] of new-planet) ([y-cor] of new-planet)  list ([x-cor] of new-star) ([y-cor] of new-star) orbital-dist-points\n    ] \n    [ if analyzing-solar-system? [\n        set analyzing-solar-system? false\n        generate-analysis\n    ]]]\n  ask stars [\n    let rho 0 - [mass] of one-of planets / mass         ; the ratio of the massses of the star and planet determine the star's distance from 0,0\n    set x-cor rho * [x-cor] of one-of planets \n    set y-cor rho * [y-cor] of one-of planets\n    set vx rho * [vx] of one-of planets\n    set vy rho * [vy] of one-of planets\n    let old-w-cor w-cor\n    set w-cor last screen-coords x-cor y-cor            ; calculate the apparent motion away from the viewer\n    set w-vel (w-cor - old-w-cor ) / time-step\n    ]\n  ask bread-crumbs [set age age + time-step ]\nend\n\nto select-circular-velocity   ; reads the current distance and computes a velocity that would result in a circular orbit. \n  ask planets [\n    let x x-cor\n    let y y-cor\n    let a atan x y\n    let d sqrt (x-cor ^ 2 + y-cor ^ 2) ; the distance to the CofM. \n    ; for d = 1, v = 2pi. I think v will scale as sqrt d \n    let v 2 * pi / sqrt d * sqrt ([mass] of new-star / solar-mass)\n    set vx 0 - v * cos a\n    set vy v * sin a ]\n  update-screen   ; get the result shown\nend\n\nto support-graphs\n  let v 0              ;introduce local varibles for velocity and brightness that can be modified from the calculated values with noise, if selected\n  let b 0              ;  they are defined here so as to have scope for the whole procedure, not just the scope of ask star [ ]\n  let time-step  delta-t * sim-speed\n  set plot-interval .00005\n  if insert-on? [set plot-interval .00005 ]\n  ; we need to ask star because the radial velocity is stored in the sun as w-vel\n  ask stars [\n    ifelse first-step?  \n      [ clear-all-plots\n        set elapsed-time 0\n        set last-plot-time 0 \n        set last-bread-crumb-time 0\n;        ask bread-crumbs [die]                ; perhaps it is nice to leave the old breadcrumbs to die slowly, so the user can see the old orbit. \n        stop                                               ;jump out of the procedure\n      ]\n      [\n        set b brightness\n        if elapsed-time > last-plot-time + plot-interval [ ; permits one plotted point every .002 year except during transit \n          set last-plot-time elapsed-time\n          set v w-vel\n          let v-noise 0.3 * rand-noise / telescope-precision\n          let b-noise 0.3 * rand-noise / telescope-precision\n          if not (telescope-precision = 100)  [\n            set v w-vel +  v-noise\n            set b brightness + b-noise ]\n          ifelse Preset-Planets = \"No Planet\"\n          [ ifelse (telescope-precision = 100) [graph 1 0 elapsed-time] [graph (1 + b-noise) v-noise elapsed-time ]]\n          [ graph b v elapsed-time ]\n        ]\n      ]\n  ] ;close ask star. v and b contain the values to be graphed for time \nend\n\nto graph [b v t ]\n  ;set graph window...take care of the x range\n  let et precision (t * days-per-year) 3\n  ifelse et <  graph-time-window\n      [ set xRangeMin 0                             ;this case, time is less than graph-time-window\n      set xRangeMax graph-time-window\n      ]\n      [ set xRangeMin  precision (et - graph-time-window) 3\n        set xRangeMax precision (t * days-per-year) 3   ;this case, time is greater than graph-time-window\n      ]\n  set-current-plot \"Velocity of Star\"\n  set-plot-x-range xRangeMin xRangeMax\n  let magnitude precision (v-y-max - (v-y-max - v-y-min) * magnify-y-axis / 9958) 5\n  set-plot-y-range (-1 * magnitude) (magnitude)\n  plotxy t * days-per-year v \n  set-current-plot \"Light Intensity\"\n  set-plot-x-range xRangeMin xRangeMax\n  set-plot-y-range precision (b-y-min + ((b-y-max - b-y-min) * magnify-y-axis / 10000)) 3 b-y-max\n  plotxy t * days-per-year b \nend\n\nto y-autoscale-plot [min-val max-val graph-name ]\n  let range abs(max-val - min-val)\n  set-current-plot graph-name\n  set-plot-y-range (precision (min-val - range * 0.2) 3) (precision (min-val + range * 0.2) 3)\nend\n\nto handle-presets\n  ask planets [ \n    ifelse resetting? \n      [ set x-cor 1 / sqrt 2                            ; starts this off 45ยก around the orbit\n        set y-cor 1 / sqrt 2\n;        set grid-scale \"1 box = 0.25 au\"                          ; should be about 5x the orbital radius\n        set planet-diameter 1                           ; smallest gas planet is 2.6 times diameter of Earth!!\n;        set star-type item 0 star-list\n;        update-star\n        select-circular-velocity                        ; computes vx and vy for a circular orbit at this radius\n        set rocky-planet true \n        set resetting? false ]\n      [ if Preset-planets != \"No Planet\" [st]\n        if Preset-planets = \"Custom\" [\n          set custom-planet true]                           ; lands in 'move planet' next cycle through go\n        if Preset-planets = \"Earth\" [                     ; remember: mass in earth-masses, distances in AU, time in years\n          set x-cor 1 / sqrt 2                            ; starts this off 45ยก around the orbit\n          set y-cor 1 / sqrt 2\n          set grid-scale \"1 box = 0.25 au\"                          ; should be about 5x the orbital radius\n          set planet-diameter 1                           ; the earth is one earth diameter!!\n          set star-type item 2 star-list\n          update-star\n          select-circular-velocity                        ; computes vx and vy for a circular orbit at this radius\n          set rocky-planet true]\n        if Preset-planets = \"Mars\" [   \n          set x-cor 1.5 / sqrt 2\n          set y-cor 1.5 / sqrt 2\n          set grid-scale \"1 box = 0.25 au\"\n          set planet-diameter precision (.107 ^ .3333) 3       ; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses\n          set star-type item 2 star-list\n          update-star\n          select-circular-velocity\n          set rocky-planet true]\n        if Preset-planets = \"Jupiter\" [ \n          set x-cor 5.2 / sqrt 2\n          set y-cor 5.2 / sqrt 2\n          set grid-scale \"1 box = 1.00 au\"\n          set planet-diameter precision ((4.13 * 10.5) ^ .3333) 3       ; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses\n          set star-type item 2 star-list\n          update-star\n          select-circular-velocity\n          set rocky-planet false]\n        if Preset-planets = \"Venus\" [   \n          set x-cor .728 / sqrt 2\n          set y-cor .728  / sqrt 2\n          set grid-scale \"1 box = 0.25 au\"\n          set planet-diameter precision (.815 ^ .3333) 3       ; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses\n          set star-type item 2 star-list\n          update-star\n          select-circular-velocity\n          set rocky-planet true ]\n        if Preset-planets = \"Like Mercury but 10x larger diameter\" [   \n          set x-cor .467 / sqrt 2\n          set y-cor .467  / sqrt 2\n          select-circular-velocity\n          ;          set grid-scale \"1 box = 0.10 au\"\n          set planet-diameter precision (55 ^ .3333) 3       ; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses\n          set rocky-planet true ]\n        if Preset-planets = \"Like Earth but 10x larger diameter\" [   \n          set x-cor 1 / sqrt 2                            ; starts this off 45ยก around the orbit\n          set y-cor 1 / sqrt 2\n          select-circular-velocity                        ; computes vx and vy for a circular orbit at this radius\n                                                          ;          set grid-scale \"1 box = 0.25 au\"                          ; should be about 5x the orbital radius\n          set planet-diameter 10                           ; the earth is one earth diameter!!\n          set rocky-planet true]\n        if Preset-planets = \"Earth-like planet near the star\" [   \n          set x-cor .2 / sqrt 2\n          set y-cor .2  / sqrt 2\n          select-circular-velocity\n          ;          set grid-scale \"1 box = 0.05 au\"\n          set planet-diameter 1       ; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses\n          set rocky-planet true ]\n        if Preset-planets = \"Large rocky planet very near the star\" [ \n          set x-cor .1 / sqrt 2\n          set y-cor .1  / sqrt 2\n          select-circular-velocity\n          ;         set grid-scale \"1 box = 0.05 au\"\n          set planet-diameter 50      ; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses\n          set rocky-planet true ] \n        if preset-planets = \"Micro planet\" [\n          set planet-diameter .0000000001\n          select-circular-velocity\n          ht ]\n        scale-variables scale-to-num grid-scale \n        set v-scale .003 * scale-to-num grid-scale ^ 1.5]]\nend\n\nto update-star\n  set old-star-type star-type\n  let list-pos position star-type star-list\n  set innerHZRad item list-pos innerHZ-list\n  set outerHZRad item list-pos outerHZ-list\n  set grid-scale ifelse-value (preset-planets = \"Jupiter\") [\"1 box = 1.00 au\"] [item list-pos view-scale-list]\n  ask new-star [\n    set mass item list-pos star-mass-list\n    set size item list-pos star-rad-list\n    set color item list-pos star-color-list ]\n  select-circular-velocity\nend\n\nto-report rand-noise ; makes a bell-shaped distribution w/ sd = 1\n  report ((random 11 + random 11 + random 11 + random 11 + random 11 ) - 25 ) / 15 ; a normal distribution around zero with a sd of about 1\nend\n\nto-report tSize [rad]\n  report rad / (dist / 10) * 28   ;at full size grid (not in the middle of scaling) size 28 = 1/10 the dist value in AU \nend\n\nto-report parse-output [string]\n  let seg-length 0\n  let output-string \"\"\n  while [member? \" \" string] [\n    let space-pos position \" \" string\n    let added-string substring string 0 (space-pos + 1)\n    if member? \"\\n\" added-string\n      [ set seg-length length added-string - position \"\\n\" added-string ]\n    if ((seg-length + space-pos) > 35) [\n      set output-string (word output-string \"\\n\") \n      set seg-length 0]\n    set seg-length seg-length + length added-string\n    set output-string (word output-string added-string)\n    set string substring string (space-pos + 1) length string\n  ]\n  report (word output-string string)\nend\n  \nto-report scale-to-num [legend]\n  report my-read-from-string (substring legend (position \"=\" legend + 2) (position \"=\" legend + 6)) * 20\nend\n\n; this breaks normal netlogo, but is fine for tortoise conversion\nto-report my-read-from-string [string]\n  report string\nend\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;;;;;;;;;  general mouse rotation proceedures ;;;;;;;;;;;;\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\nto-report screen-coords [x y]     ; given theta, scale, and dist (the distance to the observer in problem units), the grid-size (in problem units) \n                                  ;         this returns u v in screen coordinates and zpp the distance out of the screen\n   let ypp y * cos(theta)         ; rotate around the x-axis to the prime-prime coordinates in which the observer is on the z-axis at infinity. \n   let zpp y * sin(theta) \n   let u scale * x / (dist + zpp )      ; this compensates for distortion for small values of dist\n   let v scale * ypp  / (dist + zpp )   ; scale has units of (patch size) / (problem distance units)   \n   report (list u v zpp)\nend\n\nto new-angles   ; supports the mouse and sets new values for the global theta\n  if mouse-down? and mouse-inside? [         ; ignore if the mouse is not down inside the view\n    if mouse-was-up? [                       ; detect the first time the mouse is clicked\n       set mouse-was-up? false               ; reset the mouse-was-up? logical                  \n       set starting-mousey mouse-ycor\n          ; remember the theta when the mouse was pressed\n       set old-theta theta]\n    let dmy mouse-ycor - starting-mousey\n    set theta old-theta + dmy * 180 / (max-pycor - min-pycor)   ; this gives a 180 rotation for a movement up or down the view\n    if theta > 90 [set theta 90]              ; constrain theta to between 0 and 90\n    if theta < 0 [ set theta 0 ]\n    ]   \n if (not mouse-down? and not mouse-was-up?) [ ; detect the first time the mouse was released after being down\n   set mouse-was-up? true ]                   ; set the mouse-was-up? logical\nend\n\nto new-grid [dia]              ; creates a 10x10 grid of total extent dia. Grid spacing is dia/10\n  let rad dia / 2\n  let spacing dia / 10         ; Grid spacing is dia/10\n    let x 0 - rad              ; first make grid lines parallel to the x-axis\n    let y 0 - rad\n    let s false       ; show every other grid label\n    while [x <= rad] [\n      create-spots 1 [\n        set xs x \n        set ys y ]\n      create-spots 1 [\n        set xs x \n        set ys y + rad\n        if s and x != 0[\n          set label (word (precision x 2) \" au\")]\n        set s not s\n        ]  ; toggle show-label\n      set x x + spacing ]\n    set x 0 - rad\n    set y rad\n    while [x <= rad] [\n      create-spots 1 [\n        set xs x \n        set ys y \n        create-glines-with spots with [xs = x and ys = 0 - rad]\n      set x x + spacing ]]\n    \n    set x 0 - rad\n    set y 0 - rad\n    set s false       ; show every other grid label\n    while [y <= rad] [\n      create-spots 1 [\n        set xs x \n        set ys y ]\n      create-spots 1 [\n        set xs x + rad\n        set ys y\n        if s and y != 0[\n          set label (word (precision y 2) \" au\")]\n        set s not s\n        set y y + spacing ]]\n    set x rad\n    set y 0 - rad\n    while [y <= rad] [\n      create-spots 1 [\n        set xs x \n        set ys y \n        create-glines-with spots with [xs = 0 - rad and ys = y]\n      set y y + spacing ]]\n    ask spots with [(ys = 0) or (xs = 0)] [ask glines with [end1 = myself] [set color pink]]\n    ask spots [set size .01 set label-color gray]  ; I don't care about the spots, just the lines between them\nend\n\nto-report dist-between [a b]   ; a and b are lists of x, y, z values; z is ignored\n  report sqrt ((first a - first b) ^ 2 + (item 1 a - item 1 b) ^ 2)\nend";
          var info    = "WHAT IS IT?\n-----------\nThis software allows you to explore how star-planet systems outside the solar system can be identified. It allows you to create different planets orbiting a star like our sun. These systems can be identified from Earth in two ways:\n\n1) The wobble that the planet causes in the star can be detected. This involves detecting slight changes in the location of spectral lines in the light from the star due to the Doppler shift caused by the wobble. \n2) Dimming of the light from the star when the planet passes in front of the star, called a transit or occultation. \n\nThis software calculates both these signals for any size of any orbiting planetรthe wobble and the drop of light level. \n\nReal instruments on Earth cannot necessarily see these signals because any measurement necessarily is accompanied by noiseรunwanted random variations in the signal. One way to reduce this noise is to use a bigger, more precise telescope. This model allows you to see the signal without noise and with an amount of noise that depends on the precision of the telescope. \n\n\nHOW TO USE IT\n-------------\nPress Run/Pause to start. You will see an earth-like planet orbiting a star. You can leave this button in the รRunร position. \n\nYou can drag the cursor over the grid to change the viewing angle while the planet orbits. You can look at the system straight down, edge on or anything between. \n\nWhen the planet passes in front of the star, a magnified insert pops up and the model slows way down so you can see the transit. Earth is too small to see at this scale, but slide the planet diameter slider up to 4.5 or larger, an you can see the planet to scale during the transit. Note that the simulation speed is automatically slowed down during the transit--otherwise it would be too fast to see.\n\nIf you select a large diameter planet, you can see the star wobbling, too. The simulation shows both the planet and star orbiting around the center of mass.\n\nAll the time you are playing, the two graphs are busy. The result can be a mess because of noise. Turn off 'noise?' (just below the graph) and click on 'Reset Graphs' (also below). Now you can see what the graphs would look like if there was no noise. Too bad scientists donรt have a noise switch like this!!\n\nThe upper graph shows the \"proper\" motion of the star--that is the motion away from you, the viewer. Note that if you look straight down on the grid (drag your mouse downward) there is no proper motion--the graph is flat. Do you understand why?\n\nFor most planets and viewing angles, the upper graph goes up and down as the planet orbits. But look at the scale. The actual amplitude can vary enormously. Earth gives 2e-5. A monster planet 50x Earth's diameter (125,000 x its mass) gives an amplitude of 2.5, more than 100,000 times larger. The significance of this is apparent if you turn on the noise. The normal Earth is invisible in the noise, but the monster is hardly effected.\n\nThe issue here as is common throughout research is the signal-to-noise ratio. You can just about see the signal for a planet 4x the Earth's diameter. Note: reset the graphs each time you change the diameter.\n\nYou can explore whether a closer planet would generate a larger signal. To experiment with a different planet, press the รNew Planetร button in the lower right. This stops the simulation and allows you to select a preset planet or make one of your own. \n\nYou can use the รPreset-Planetsร pull-down menu to select a planet and to make your own. Several kinds of planets have been pre-loaded that you use to explore the signals they would make. \n\nIf you select รNone. Set with mouse.ร This automatically sets a straight-down view and allows you to use the mouse to move the planet or the tip of its velocity vector. It is sometimes hard to select a velocity that doesnรt cause the planet to zoom away or crash into the sun. To simplify this, there is a 'Make circular' that generates a velocity that gives a circular orbit.\n\nYou can also change the รDistance-to-starร to make planets with small or large orbits. It is easy to loose the planet off-screen if you are not careful. If the planet is lost, you can always hit 'reset' to start over or use the Preset-Planets button\n\nThe lower graph shows the star's brightness, which only changes during a transit of the planet. First look at it with no noise and then experiment with orbits and masses that give a signal that you can see.\n\n\nTHINGS TO NOTICE\n----------------\nBy exploring this model, you can answer the following questions:\n\n1. What is the origin of a starรs wobble? What kinds of planet result in the greatest wobble? \n2. What kinds of planets and inclinations are necessary to detect the wobble?\n3. Under what conditions is there a drop in star intensity? \n4. In this model, what is the smallest planet that causes enough wobble to be detected above the noise?\n5. In this model, what is the smallest planet that causes enough drop in start intensity to be detected above the noise?\n6. Estimate the fraction of star-planet systems with large planets that we can detect through intensity drop and through wobble? \n7. Why have most planets detected so far been too large to support life? \n\n\n\nCREDITS AND REFERENCES\n----------------------\nCreated by Bob Tinker\nOctober 2010\nDesign assistance by Dan Damelin\nThis software is available under the GNU open srouce license. ";
          return Tortoise.fromCompiledModel('#model-container', widgets, code, info, '', true);
        })();
      var modelConfig  = (typeof window.modelConfig !== "undefined" && window.modelConfig !== null) ? window.modelConfig : {};
var modelPlotOps = (typeof modelConfig.plotOps !== "undefined" && modelConfig.plotOps !== null) ? modelConfig.plotOps : {};

var PenBundle = tortoise_require('engine/plot/pen');
var Plot      = tortoise_require('engine/plot/plot');
var PlotOps   = tortoise_require('engine/plot/plotops');

modelConfig.plots = [];
if (typeof javax !== "undefined") { modelConfig.output = { clear: function(){}, write: function(str) { context.getWriter().print(str); } } }

var workspace = tortoise_require('engine/workspace')(modelConfig)([{ name: 'OUTERHZ', singular: 'turtle', varNames: [] }, { name: 'INNERHZ', singular: 'turtle', varNames: [] }, { name: 'BREAD-CRUMBS', singular: 'turtle', varNames: ['xd', 'yd', 'age'] }, { name: 'PLANETS', singular: 'planet', varNames: ['x-cor', 'y-cor', 'vx', 'vy', 'mass', 'phase', 'w-cor', 'w-vel'] }, { name: 'ARROWHEADS', singular: 'arrowhead', varNames: ['xa', 'ya'] }, { name: 'STARS', singular: 'star', varNames: ['x-cor', 'y-cor', 'vx', 'vy', 'mass', 'phase', 'w-cor', 'w-vel'] }, { name: 'FRONT-PLANETS', singular: 'front-planet', varNames: [] }, { name: 'FRONT-ARROWHEADS', singular: 'front-arrowhead', varNames: [] }, { name: 'SPOTS', singular: 'turtle', varNames: ['xs', 'ys'] }, { name: 'INSERT-BACKGROUND', singular: 'turtle', varNames: [] }, { name: 'INSERT-STAR', singular: 'turtle', varNames: [] }, { name: 'INSERT-PLANET', singular: 'turtle', varNames: [] }, { name: 'VIEW-DISPLAYS', singular: 'view-display', varNames: ['number'] }, { name: 'POINTERS', singular: 'pointer', varNames: [], isDirected: true }, { name: 'GLINES', singular: 'gline', varNames: [], isDirected: false }])([], [])(['simulation-speed', 'star-type', 'insert-on?', 'insert-size', 'old-sim-speed', 'g', 'star-diameter', 'au', 'sec/yr', 'radial-v-data', 'store-interval', 'sim-speed', 'mouse-was-up?', 'mousex', 'mousey', 'starting-mousex', 'starting-mousey', 'theta', 'dist', 'old-distance', 'grid-size', 'scale', 'old-theta', 'old-preset-planets', 'old-planet-mass', 'old-star-type', 'slow-speed', 'delta-t', 'first-step?', 'bread-crumb-lifetime', 'elapsed-time', 'last-bread-crumb-time', 'time/bread-crumb', 'v-scale', 'last-plot-time', 'brightness', 'planet-mass', 'xrangemin', 'xrangemax', 'last-velocity', 'last-brightness', 'new-planet', 'new-star', 'plot-interval', 'days-per-year', 'b-y-max', 'b-y-min', 'v-y-max', 'v-y-min', 'outerhzrad', 'innerhzrad', 'star-list', 'star-mass-list', 'outerhz-list', 'innerhz-list', 'view-scale-list', 'sun-size', 'solar-mass', 'earth-mass', 'star-color-list', 'star-rad-list', 'analyzing-solar-system?', 'orbital-dist-points', 'give-non-gas-feedback?', 'give-gas-feedback?', 'graph-time-window', 'telescope-precision', 'magnify-y-axis', 'resetting?', 'grid-scale', 'planet-diameter', 'rocky-planet', 'custom-planet', 'preset-planets'], ['simulation-speed', 'star-type'], [], -48, 48, -42, 42, 6.53, false, false, {"default":{"rotate":true,"elements":[{"xcors":[150,40,150,260],"ycors":[5,250,205,250],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"airplane":{"rotate":true,"elements":[{"xcors":[150,135,120,120,15,15,120,135,105,120,150,180,210,165,180,285,285,180,180,165],"ycors":[0,15,60,105,165,195,180,240,270,285,270,285,270,240,180,195,165,105,60,15],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"arrow":{"rotate":true,"elements":[{"xcors":[150,0,105,105,195,195,300],"ycors":[0,150,150,293,293,150,150],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"box":{"rotate":false,"elements":[{"xcors":[150,285,285,150],"ycors":[285,225,75,135],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[150,15,150,285],"ycors":[135,75,15,75],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[15,15,150,150],"ycors":[75,225,285,135],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x1":150,"y1":285,"x2":150,"y2":135,"type":"line","color":"rgba(0, 0, 0, 1.0)","filled":false,"marked":false},{"x1":150,"y1":135,"x2":15,"y2":75,"type":"line","color":"rgba(0, 0, 0, 1.0)","filled":false,"marked":false},{"x1":150,"y1":135,"x2":285,"y2":75,"type":"line","color":"rgba(0, 0, 0, 1.0)","filled":false,"marked":false}]},"bug":{"rotate":true,"elements":[{"x":96,"y":182,"diam":108,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":110,"y":127,"diam":80,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":110,"y":75,"diam":80,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x1":150,"y1":100,"x2":80,"y2":30,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":150,"y1":100,"x2":220,"y2":30,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"butterfly":{"rotate":true,"elements":[{"xcors":[150,209,225,225,195,165,150],"ycors":[165,199,225,255,270,255,240],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[150,89,75,75,105,135,150],"ycors":[165,198,225,255,270,255,240],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[139,100,55,25,10,10,25,40,85,139],"ycors":[148,105,90,90,105,135,180,195,194,163],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[162,200,245,275,290,290,275,260,215,162],"ycors":[150,105,90,90,105,135,180,195,195,165],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[150,135,120,135,150,165,180,165],"ycors":[255,225,150,120,105,120,150,225],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":135,"y":90,"diam":30,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x1":150,"y1":105,"x2":195,"y2":60,"type":"line","color":"rgba(0, 0, 0, 1.0)","filled":false,"marked":false},{"x1":150,"y1":105,"x2":105,"y2":60,"type":"line","color":"rgba(0, 0, 0, 1.0)","filled":false,"marked":false}]},"car":{"rotate":false,"elements":[{"xcors":[300,279,261,240,226,213,203,185,159,135,75,0,0,0,300,300],"ycors":[180,164,144,135,132,106,84,63,50,50,60,150,165,225,225,180],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":180,"y":180,"diam":90,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":30,"y":180,"diam":90,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xcors":[162,132,134,209,194,189,180],"ycors":[80,78,135,135,105,96,89],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":47,"y":195,"diam":58,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":195,"y":195,"diam":58,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"circle":{"rotate":false,"elements":[{"x":0,"y":0,"diam":300,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"circle 2":{"rotate":false,"elements":[{"x":0,"y":0,"diam":300,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":15,"y":15,"diam":270,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"cow":{"rotate":false,"elements":[{"xcors":[200,197,179,177,166,140,93,78,72,49,48,37,25,25,45,103,179,198,252,272,293,285,255,242,224],"ycors":[193,249,249,196,187,189,191,179,211,209,181,149,120,89,72,84,75,76,64,81,103,121,121,118,167],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[73,86,62,48],"ycors":[210,251,249,208],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[25,16,9,23,25,39],"ycors":[114,195,204,213,200,123],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"cylinder":{"rotate":false,"elements":[{"x":0,"y":0,"diam":300,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"dot":{"rotate":false,"elements":[{"x":90,"y":90,"diam":120,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"face happy":{"rotate":false,"elements":[{"x":8,"y":8,"diam":285,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":60,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":180,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xcors":[150,90,62,47,67,90,109,150,192,210,227,251,236,212],"ycors":[255,239,213,191,179,203,218,225,218,203,181,194,217,240],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"face neutral":{"rotate":false,"elements":[{"x":8,"y":7,"diam":285,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":60,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":180,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":60,"ymin":195,"xmax":240,"ymax":225,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"face sad":{"rotate":false,"elements":[{"x":8,"y":8,"diam":285,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":60,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":180,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xcors":[150,90,62,47,67,90,109,150,192,210,227,251,236,212],"ycors":[168,184,210,232,244,220,205,198,205,220,242,229,206,183],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"fish":{"rotate":false,"elements":[{"xcors":[44,21,15,0,15,0,13,20,45],"ycors":[131,87,86,120,150,180,214,212,166],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xcors":[135,119,95,76,46,60],"ycors":[195,235,218,210,204,165],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xcors":[75,83,71,86,166,135],"ycors":[45,77,103,114,78,60],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xcors":[30,151,226,280,292,292,287,270,195,151,30],"ycors":[136,77,81,119,146,160,170,195,210,212,166],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":215,"y":106,"diam":30,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"flag":{"rotate":false,"elements":[{"xmin":60,"ymin":15,"xmax":75,"ymax":300,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[90,270,90],"ycors":[150,90,30],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x1":75,"y1":135,"x2":90,"y2":135,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":75,"y1":45,"x2":90,"y2":45,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"flower":{"rotate":false,"elements":[{"xcors":[135,165,180,180,150,165,195,195,165],"ycors":[120,165,210,240,300,300,240,195,135],"type":"polygon","color":"rgba(89, 176, 60, 1.0)","filled":true,"marked":false},{"x":85,"y":132,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":130,"y":147,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":192,"y":85,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":85,"y":40,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":177,"y":40,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":177,"y":132,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":70,"y":85,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":130,"y":25,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":96,"y":51,"diam":108,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":113,"y":68,"diam":74,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xcors":[189,219,249,279,234],"ycors":[233,188,173,188,218],"type":"polygon","color":"rgba(89, 176, 60, 1.0)","filled":true,"marked":false},{"xcors":[180,150,105,75,135],"ycors":[255,210,210,240,240],"type":"polygon","color":"rgba(89, 176, 60, 1.0)","filled":true,"marked":false}]},"frame":{"rotate":false,"elements":[{"xmin":0,"ymin":0,"xmax":300,"ymax":300,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":false,"marked":false}]},"house":{"rotate":false,"elements":[{"xmin":45,"ymin":120,"xmax":255,"ymax":285,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":120,"ymin":210,"xmax":180,"ymax":285,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xcors":[15,150,285],"ycors":[120,15,120],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x1":30,"y1":120,"x2":270,"y2":120,"type":"line","color":"rgba(0, 0, 0, 1.0)","filled":false,"marked":false}]},"leaf":{"rotate":false,"elements":[{"xcors":[150,135,120,60,30,60,60,15,30,15,40,45,60,90,105,120,105,120,135,150,165,180,195,180,195,210,240,255,263,285,270,285,240,240,270,240,180,165],"ycors":[210,195,210,210,195,180,165,135,120,105,104,90,90,105,120,120,60,60,30,15,30,60,60,120,120,105,90,90,104,105,120,135,165,180,195,210,210,195],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[135,135,120,105,105,135,165,165],"ycors":[195,240,255,255,285,285,240,195],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"line":{"rotate":true,"elements":[{"x1":150,"y1":0,"x2":150,"y2":300,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"line half":{"rotate":true,"elements":[{"x1":150,"y1":0,"x2":150,"y2":150,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"pentagon":{"rotate":false,"elements":[{"xcors":[150,15,60,240,285],"ycors":[15,120,285,285,120],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"person":{"rotate":false,"elements":[{"x":110,"y":5,"diam":80,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[105,120,90,105,135,150,165,195,210,180,195],"ycors":[90,195,285,300,300,225,300,300,285,195,90],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":127,"ymin":79,"xmax":172,"ymax":94,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[195,240,225,165],"ycors":[90,150,180,105],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[105,60,75,135],"ycors":[90,150,180,105],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"plant":{"rotate":false,"elements":[{"xmin":135,"ymin":90,"xmax":165,"ymax":300,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[135,90,45,75,135],"ycors":[255,210,195,255,285],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[165,210,255,225,165],"ycors":[255,210,195,255,285],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[135,90,45,75,135],"ycors":[180,135,120,180,210],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[165,165,225,255,210],"ycors":[180,210,180,120,135],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[135,90,45,75,135],"ycors":[105,60,45,105,135],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[165,165,225,255,210],"ycors":[105,135,105,45,60],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[135,120,150,180,165],"ycors":[90,45,15,45,90],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"sheep":{"rotate":false,"elements":[{"xmin":151,"ymin":225,"xmax":180,"ymax":285,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":47,"ymin":225,"xmax":75,"ymax":285,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":15,"ymin":75,"xmax":210,"ymax":225,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":135,"y":75,"diam":150,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":165,"y":76,"diam":116,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"square":{"rotate":false,"elements":[{"xmin":30,"ymin":30,"xmax":270,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"square 2":{"rotate":false,"elements":[{"xmin":30,"ymin":30,"xmax":270,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":60,"ymin":60,"xmax":240,"ymax":240,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"star":{"rotate":false,"elements":[{"xcors":[151,185,298,207,242,151,59,94,3,116],"ycors":[1,108,108,175,282,216,282,175,108,108],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"target":{"rotate":false,"elements":[{"x":0,"y":0,"diam":300,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":30,"y":30,"diam":240,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":60,"y":60,"diam":180,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":90,"y":90,"diam":120,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":120,"y":120,"diam":60,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"tree":{"rotate":false,"elements":[{"x":118,"y":3,"diam":94,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":120,"ymin":195,"xmax":180,"ymax":300,"type":"rectangle","color":"rgba(157, 110, 72, 1.0)","filled":true,"marked":false},{"x":65,"y":21,"diam":108,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":116,"y":41,"diam":127,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":45,"y":90,"diam":120,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":104,"y":74,"diam":152,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"triangle":{"rotate":false,"elements":[{"xcors":[150,15,285],"ycors":[30,255,255],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"triangle 2":{"rotate":false,"elements":[{"xcors":[150,15,285],"ycors":[30,255,255],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[151,225,75],"ycors":[99,223,224],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"truck":{"rotate":false,"elements":[{"xmin":4,"ymin":45,"xmax":195,"ymax":187,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[296,296,259,244,208,207],"ycors":[193,150,134,104,104,194],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":195,"ymin":60,"xmax":195,"ymax":105,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xcors":[238,252,219,218],"ycors":[112,141,141,112],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":234,"y":174,"diam":42,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":181,"ymin":185,"xmax":214,"ymax":194,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":144,"y":174,"diam":42,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":24,"y":174,"diam":42,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":24,"y":174,"diam":42,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x":144,"y":174,"diam":42,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x":234,"y":174,"diam":42,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"turtle":{"rotate":true,"elements":[{"xcors":[215,240,246,228,215,193],"ycors":[204,233,254,266,252,210],"type":"polygon","color":"rgba(89, 176, 60, 1.0)","filled":true,"marked":false},{"xcors":[195,225,245,260,269,261,240,225,210],"ycors":[90,75,75,89,108,124,105,105,105],"type":"polygon","color":"rgba(89, 176, 60, 1.0)","filled":true,"marked":false},{"xcors":[105,75,55,40,31,39,60,75,90],"ycors":[90,75,75,89,108,124,105,105,105],"type":"polygon","color":"rgba(89, 176, 60, 1.0)","filled":true,"marked":false},{"xcors":[132,134,107,108,150,192,192,169,172],"ycors":[85,64,51,17,2,18,52,65,87],"type":"polygon","color":"rgba(89, 176, 60, 1.0)","filled":true,"marked":false},{"xcors":[85,60,54,72,85,107],"ycors":[204,233,254,266,252,210],"type":"polygon","color":"rgba(89, 176, 60, 1.0)","filled":true,"marked":false},{"xcors":[119,179,209,224,220,175,128,81,74,88],"ycors":[75,75,101,135,225,261,261,224,135,99],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"wheel":{"rotate":false,"elements":[{"x":3,"y":3,"diam":294,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x":30,"y":30,"diam":240,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x1":150,"y1":285,"x2":150,"y2":15,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":15,"y1":150,"x2":285,"y2":150,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x":120,"y":120,"diam":60,"type":"circle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x1":216,"y1":40,"x2":79,"y2":269,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":40,"y1":84,"x2":269,"y2":221,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":40,"y1":216,"x2":269,"y2":79,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":84,"y1":40,"x2":221,"y2":269,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"x":{"rotate":false,"elements":[{"xcors":[270,225,30,75],"ycors":[75,30,225,270],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[30,75,270,225],"ycors":[75,30,225,270],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]}}, {"default":{"direction-indicator":{"rotate":true,"elements":[{"x1":150,"y1":150,"x2":90,"y2":180,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":150,"y1":150,"x2":210,"y2":180,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"curviness":0.0,"lines":[{"x-offset":-0.2,"is-visible":false,"dashes":[0.0,1.0]},{"x-offset":0.0,"is-visible":true,"dashes":[1.0,0.0]},{"x-offset":0.2,"is-visible":false,"dashes":[0.0,1.0]}]}});

var BreedManager  = workspace.breedManager;
var LayoutManager = workspace.layoutManager;
var LinkPrims     = workspace.linkPrims;
var ListPrims     = workspace.listPrims;
var MousePrims    = workspace.mousePrims;
var plotManager   = workspace.plotManager;
var Prims         = workspace.prims;
var PrintPrims    = workspace.printPrims;
var OutputPrims   = workspace.outputPrims;
var SelfPrims     = workspace.selfPrims;
var SelfManager   = workspace.selfManager;
var Updater       = workspace.updater;
var world         = workspace.world;

var Call           = tortoise_require('util/call');
var ColorModel     = tortoise_require('util/colormodel');
var Exception      = tortoise_require('util/exception');
var Trig           = tortoise_require('util/trig');
var Type           = tortoise_require('util/typechecker');
var notImplemented = tortoise_require('util/notimplemented');

var Dump      = tortoise_require('engine/dump');
var Link      = tortoise_require('engine/core/link');
var LinkSet   = tortoise_require('engine/core/linkset');
var Nobody    = tortoise_require('engine/core/nobody');
var PatchSet  = tortoise_require('engine/core/patchset');
var Turtle    = tortoise_require('engine/core/turtle');
var TurtleSet = tortoise_require('engine/core/turtleset');
var Tasks     = tortoise_require('engine/prim/tasks');

var AgentModel = tortoise_require('agentmodel');
var Random     = tortoise_require('shim/random');
var StrictMath = tortoise_require('shim/strictmath');
function startup() {
  world.clearAll();
  world.observer.setGlobal('insert-on?', false);
  world.observer.setGlobal('insert-size', ((2 * world.topology.maxPycor) / 3));
  world.observer.setGlobal('g', (0 - (2 * 5.922E-5)));
  world.observer.setGlobal('au', 150000000);
  world.observer.setGlobal('star-diameter', (1390000 / world.observer.getGlobal('au')));
  world.observer.setGlobal('sec/yr', 31600000);
  world.observer.setGlobal('store-interval', (1 / 365.12));
  world.observer.setGlobal('radial-v-data', []);
  world.observer.setGlobal('slow-speed', 0.1);
  world.observer.setGlobal('old-sim-speed', 0.2);
  world.observer.setGlobal('theta', 0);
  world.observer.setGlobal('scale', 140);
  world.observer.setGlobal('grid-size', 5);
  world.observer.setGlobal('old-distance', 5);
  world.observer.setGlobal('grid-scale', "1 box = 0.25 au");
  world.observer.setGlobal('dist', Call(scaleToNum, world.observer.getGlobal('grid-scale')));
  world.observer.setGlobal('mouse-was-up?', true);
  world.observer.setGlobal('delta-t', 3.0E-6);
  world.observer.setGlobal('bread-crumb-lifetime', 3);
  world.observer.setGlobal('elapsed-time', 0);
  world.observer.setGlobal('time/bread-crumb', 0.05);
  world.observer.setGlobal('v-scale', (0.003 * StrictMath.pow(world.observer.getGlobal('dist'), 1.5)));
  world.observer.setGlobal('last-plot-time', 0);
  world.observer.setGlobal('brightness', 1);
  world.observer.setGlobal('custom-planet', false);
  world.observer.setGlobal('old-preset-planets', "Earth");
  world.observer.setGlobal('first-step?', true);
  world.observer.setGlobal('days-per-year', 365);
  world.observer.setGlobal('b-y-max', 1);
  world.observer.setGlobal('v-y-max', 8.6);
  world.observer.setGlobal('b-y-min', 0.25);
  world.observer.setGlobal('v-y-min', 1.0E-5);
  world.observer.setGlobal('graph-time-window', 500);
  world.observer.setGlobal('telescope-precision', 100);
  world.observer.setGlobal('magnify-y-axis', 7000);
  world.observer.setGlobal('sun-size', 3);
  world.observer.setGlobal('earth-mass', 5.97E24);
  world.observer.setGlobal('solar-mass', (1.99E30 / world.observer.getGlobal('earth-mass')));
  world.observer.setGlobal('outerhzrad', 1.37);
  world.observer.setGlobal('innerhzrad', 0.95);
  world.observer.setGlobal('star-list', ["M - red (temp 3120 K)", "K - orange (temp 4640 K)", "G - yellow (temp 5920 K) -> our Sun", "F - white (temp 7240 K)", "A - blue (temp 8620 K)"]);
  world.observer.setGlobal('star-mass-list', ListPrims.list((world.observer.getGlobal('solar-mass') * 0.21), (world.observer.getGlobal('solar-mass') * 0.69), (world.observer.getGlobal('solar-mass') * 1), (world.observer.getGlobal('solar-mass') * 1.29), (world.observer.getGlobal('solar-mass') * 2.1)));
  world.observer.setGlobal('star-color-list', ListPrims.list(15, 25, 45, 9.9, 85));
  world.observer.setGlobal('star-rad-list', ListPrims.list((0.32 * world.observer.getGlobal('sun-size')), (0.74 * world.observer.getGlobal('sun-size')), (1 * world.observer.getGlobal('sun-size')), (1.2 * world.observer.getGlobal('sun-size')), (1.7 * world.observer.getGlobal('sun-size'))));
  world.observer.setGlobal('old-star-type', ListPrims.item(2, world.observer.getGlobal('star-list')));
  world.observer.setGlobal('outerhz-list', [0.12, 0.55, 1.37, 2.17, 6.14]);
  world.observer.setGlobal('innerhz-list', [0.08, 0.38, 0.95, 1.5, 4.26]);
  world.observer.setGlobal('view-scale-list', ["1 box = 0.25 au", "1 box = 0.25 au", "1 box = 0.25 au", "1 box = 0.50 au", "1 box = 1.00 au"]);
  world.observer.setGlobal('star-type', ListPrims.item(2, world.observer.getGlobal('star-list')));
  world.observer.setGlobal('analyzing-solar-system?', false);
  world.observer.setGlobal('orbital-dist-points', []);
  world.observer.setGlobal('give-non-gas-feedback?', true);
  world.observer.setGlobal('give-gas-feedback?', true);
  world.observer.setGlobal('xrangemin', 0);
  world.observer.setGlobal('xrangemax', world.observer.getGlobal('graph-time-window'));
  world.turtleManager.createTurtles(1, 'PLANETS').ask(function() {
    SelfPrims.setVariable('shape', "circle");
    SelfPrims.setVariable('color', 105);
    SelfPrims.setVariable('size', 2);
    SelfPrims.setVariable('label', "Planet");
  }, true);
  world.observer.setGlobal('new-planet', world.turtleManager.getTurtleOfBreed("PLANETS", 0));
  world.turtleManager.createTurtles(1, 'STARS').ask(function() {
    SelfPrims.setVariable('shape', "circle");
    SelfPrims.setVariable('color', 45);
    SelfPrims.setVariable('mass', world.observer.getGlobal('solar-mass'));
    SelfPrims.setXY(0, 0);
    SelfPrims.setVariable('size', world.observer.getGlobal('sun-size'));
  }, true);
  world.observer.setGlobal('new-star', world.turtleManager.getTurtleOfBreed("STARS", 1));
  world.turtleManager.createTurtles(1, 'ARROWHEADS').ask(function() {
    SelfPrims.setVariable('shape', "default");
    SelfPrims.setVariable('color', 15);
    SelfPrims.setVariable('size', 3);
    SelfManager.self().hideTurtle(true);;
  }, true);
  world.turtleManager.createTurtles(1, 'OUTERHZ').ask(function() {
    SelfPrims.setVariable('shape', "circle");
    SelfPrims.setVariable('color', [18, 99, 146, 125]);
    SelfPrims.setXY(0, 0);
    SelfPrims.setVariable('size', Call(tsize, world.observer.getGlobal('outerhzrad')));
  }, true);
  world.turtleManager.createTurtles(1, 'INNERHZ').ask(function() {
    SelfPrims.setVariable('shape', "circle");
    SelfPrims.setVariable('color', [0, 0, 0, 200]);
    SelfPrims.setXY(0, 0);
    SelfPrims.setVariable('size', Call(tsize, world.observer.getGlobal('innerhzrad')));
  }, true);
  world.turtleManager.createTurtles(1, 'FRONT-PLANETS').ask(function() {
    SelfPrims.setVariable('shape', "circle");
    SelfPrims.setVariable('color', 105);
    SelfPrims.setVariable('label', "Planet");
    SelfPrims.setVariable('size', 2);
  }, true);
  world.turtleManager.createTurtles(1, 'FRONT-ARROWHEADS').ask(function() {
    SelfPrims.setVariable('shape', "default");
    SelfPrims.setVariable('color', 15);
    SelfPrims.setVariable('size', 3);
    SelfManager.self().hideTurtle(true);;
  }, true);
  world.turtleManager.createTurtles(1, 'VIEW-DISPLAYS').ask(function() {
    SelfPrims.setVariable('color', 0);
    SelfPrims.setVariable('size', 0);
    SelfPrims.setXY((world.topology.maxPxcor - 20), (world.topology.minPycor + 3));
    SelfPrims.setVariable('number', 0);
    SelfManager.self().hideTurtle(true);;
  }, true);
  world.turtleManager.createTurtles(1, 'VIEW-DISPLAYS').ask(function() {
    SelfPrims.setVariable('color', 0);
    SelfPrims.setVariable('size', 0);
    SelfPrims.setXY((world.topology.maxPxcor - 37), (world.topology.minPycor + 1));
    SelfPrims.setVariable('number', 1);
    SelfManager.self().hideTurtle(true);;
  }, true);
  world.turtleManager.createTurtles(1, 'VIEW-DISPLAYS').ask(function() {
    SelfPrims.setVariable('color', 0);
    SelfPrims.setVariable('size', 0);
    SelfPrims.setXY(world.topology.maxPxcor, (world.topology.maxPycor - 2.5));
    SelfPrims.setVariable('number', 2);
  }, true);
  world.turtleManager.createTurtles(1, 'VIEW-DISPLAYS').ask(function() {
    SelfPrims.setVariable('color', 0);
    SelfPrims.setVariable('size', 0);
    SelfPrims.setXY(world.topology.maxPxcor, (world.topology.maxPycor - 4.5));
    SelfPrims.setVariable('number', 3);
  }, true);
  world.turtleManager.createTurtles(1, 'VIEW-DISPLAYS').ask(function() {
    SelfPrims.setVariable('color', 0);
    SelfPrims.setVariable('size', 0);
    SelfPrims.setXY((world.topology.minPxcor + 23), ((world.topology.maxPycor - world.observer.getGlobal('insert-size')) + 1));
    SelfPrims.setVariable('number', 4);
  }, true);
  world.turtleManager.createTurtles(1, 'INSERT-BACKGROUND').ask(function() {
    SelfPrims.setXY((world.topology.minPxcor + (world.observer.getGlobal('insert-size') / 2)), (world.topology.maxPycor - (world.observer.getGlobal('insert-size') / 2)));
    SelfPrims.setVariable('shape', "frame");
    SelfPrims.setVariable('size', world.observer.getGlobal('insert-size'));
    SelfManager.self().hideTurtle(true);;
  }, true);
  world.turtleManager.createTurtles(1, 'INSERT-STAR').ask(function() {
    SelfPrims.setXY((world.topology.minPxcor + (world.observer.getGlobal('insert-size') / 2)), (world.topology.maxPycor - (world.observer.getGlobal('insert-size') / 2)));
    SelfPrims.setVariable('shape', "circle");
    SelfPrims.setVariable('size', (world.observer.getGlobal('insert-size') / 2));
    SelfPrims.setVariable('color', 45);
    SelfManager.self().hideTurtle(true);;
  }, true);
  world.turtleManager.createTurtles(1, 'INSERT-PLANET').ask(function() {
    SelfPrims.setVariable('shape', "circle 2");
    SelfPrims.setVariable('color', 45);
    SelfPrims.setXY((world.topology.minPxcor + (world.observer.getGlobal('insert-size') / 2)), (world.topology.maxPycor - (world.observer.getGlobal('insert-size') / 2)));
    SelfManager.self().hideTurtle(true);;
  }, true);
  world.observer.getGlobal('new-planet').ask(function() {
    LinkPrims.createLinksWith(world.turtleManager.turtlesOfBreed("ARROWHEADS"), 'GLINES').ask(function() {}, false);
  }, true);
  world.observer.setGlobal('simulation-speed', 15);
  Call(newGrid, 2.5);
  world.observer.setGlobal('resetting?', true);
  Call(handlePresets);
  world.observer.setGlobal('theta', 0);
  OutputPrims.print(Call(parseOutput, "Create a solar system and press the 'check solar system' button to get feedback on the planet's ablity to support life."));
  Call(go);
}
function go() {
  if (Prims.isThrottleTimeElapsed("go_0", workspace.selfManager.self(), 0.01)) {
    Prims.resetThrottleTimerFor("go_0", workspace.selfManager.self());
    var v = StrictMath.sqrt((StrictMath.pow(world.observer.getGlobal('new-planet').projectionBy(function() {
      return SelfPrims.getVariable('vx');
    }), 2) + StrictMath.pow(world.observer.getGlobal('new-planet').projectionBy(function() {
      return SelfPrims.getVariable('vy');
    }), 2)));
    if (world.observer.getGlobal('insert-on?')) {
      world.observer.setGlobal('sim-speed', (Prims.gt(v, 10) ? (world.observer.getGlobal('slow-speed') / 6) : world.observer.getGlobal('slow-speed')));
    }
    else {
      world.observer.setGlobal('sim-speed', (0.2 * StrictMath.pow(world.observer.getGlobal('simulation-speed'), 2)));
    }
  }
  if (!Prims.equality(world.observer.getGlobal('old-star-type'), world.observer.getGlobal('star-type'))) {
    Call(updateStar);
  }
  if (world.observer.getGlobal('custom-planet')) {
    Call(handleMessages);
    Call(setPlanetMass);
    if (!Prims.equality(world.observer.getGlobal('preset-planets'), world.observer.getGlobal('old-preset-planets'))) {
      world.observer.setGlobal('old-preset-planets', world.observer.getGlobal('preset-planets'));
      if (!Prims.equality(world.observer.getGlobal('preset-planets'), "Custom")) {
        Call(handlePresets);
        Call(doScaleChange);
      }
    }
    Call(adjustPlanet);
    Call(doScaleChange);
    world.observer.setGlobal('first-step?', true);
  }
  else {
    if (Prims.equality(world.observer.getGlobal('preset-planets'), "No Planet")) {
      Call(handlePresets);
      Call(newAngles);
      Call(stepForwardInTime);
      world.turtleManager.turtlesOfBreed("PLANETS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.linkManager.getLink(0, 2, 'GLINES').ask(function() {
        SelfPrims.setVariable('hidden?', true);
      }, true);
      world.turtleManager.turtlesOfBreed("BREAD-CRUMBS").ask(function() {
        SelfPrims.die();
      }, true);
      world.turtleManager.turtlesOfBreed("ARROWHEADS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("FRONT-ARROWHEADS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("FRONT-PLANETS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("INSERT-BACKGROUND").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("INSERT-PLANET").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("INSERT-STAR").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("VIEW-DISPLAYS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.observer.setGlobal('sim-speed', (0.2 * StrictMath.pow(world.observer.getGlobal('simulation-speed'), 2)));
    }
    else {
      Call(handleMessages);
      Call(setPlanetMass);
      if (!Prims.equality(world.observer.getGlobal('preset-planets'), world.observer.getGlobal('old-preset-planets'))) {
        world.observer.setGlobal('old-preset-planets', world.observer.getGlobal('preset-planets'));
        Call(handlePresets);
      }
      Call(handleOccultation);
      Call(doScaleChange);
      Call(stepForwardInTime);
      world.observer.setGlobal('first-step?', false);
    }
  }
}
function checkSolarSystem() {
  OutputPrims.clear();
  OutputPrims.print("Analyzing....");
  world.observer.setGlobal('analyzing-solar-system?', true);
  world.observer.setGlobal('custom-planet', false);
  world.observer.setGlobal('orbital-dist-points', []);
}
function generateAnalysis() {
  OutputPrims.clear();
  var output = "";
  var goodStarType_p = ((Prims.equality(world.observer.getGlobal('star-type'), ListPrims.item(1, world.observer.getGlobal('star-list'))) || Prims.equality(world.observer.getGlobal('star-type'), ListPrims.item(2, world.observer.getGlobal('star-list')))) || Prims.equality(world.observer.getGlobal('star-type'), ListPrims.item(3, world.observer.getGlobal('star-list'))));
  if (!goodStarType_p) {
    if (Prims.equality(world.observer.getGlobal('star-type'), ListPrims.item(0, world.observer.getGlobal('star-list')))) {
      output = (Dump("") + Dump(output) + Dump("STAR TYPE: -\nM-class stars have a very narrow zone in which liquid water could exist on the planet's surface.  Additionally, the zone is very close to the star. \n\nPLANET ROTATION: -\nAny planet close enough to be in the liquid water zone of an M-class star would stop rotating over time.  One side of the planet would be very hot (facing the star) and the other side would be very cold (facing away from the star). "));
      OutputPrims.print(Call(parseOutput, output));
      throw new Exception.StopInterrupt;
    }
    else {
      output = (Dump("") + Dump(output) + Dump("STAR TYPE: -\nA-class stars give off enormous amounts of ultraviolet radiation and have a relatively short lifespan, compared to other stars. "));
      OutputPrims.print(Call(parseOutput, output));
      throw new Exception.StopInterrupt;
    }
  }
  if (!world.observer.getGlobal('rocky-planet')) {
    output = (Dump("") + Dump(output) + Dump("PLANET TYPE: -\nThe chemical building blocks of life are rare on gaseous planets.  They are composed primarily of hydrogen and helium, with little carbon or water. "));
    OutputPrims.print(Call(parseOutput, output));
    throw new Exception.StopInterrupt;
  }
  var largeEnough_p = Prims.gt(world.observer.getGlobal('new-planet').projectionBy(function() {
    return SelfPrims.getVariable('mass');
  }), (2.5E24 / world.observer.getGlobal('earth-mass')));
  if (!largeEnough_p) {
    output = (Dump("") + Dump(output) + Dump("PLANET SIZE: -\nThe planet's mass is too small to exert enough gravitational force to hold an atmosphere.  Atmospheric gases will escape into space. "));
    OutputPrims.print(Call(parseOutput, output));
    throw new Exception.StopInterrupt;
  }
  var avgDist = ListPrims.mean(world.observer.getGlobal('orbital-dist-points'));
  var avgDistInHz = (Prims.gte(avgDist, world.observer.getGlobal('innerhzrad')) && Prims.lte(avgDist, world.observer.getGlobal('outerhzrad')));
  var minOrbit = ListPrims.min(world.observer.getGlobal('orbital-dist-points'));
  var maxOrbit = ListPrims.max(world.observer.getGlobal('orbital-dist-points'));
  var tooClose_p = Prims.lt(minOrbit, world.observer.getGlobal('innerhzrad'));
  var tooFar_p = Prims.gt(maxOrbit, world.observer.getGlobal('outerhzrad'));
  var inHz_p = (!tooClose_p && !tooFar_p);
  var passesThroughHz_p = (Prims.lt(minOrbit, world.observer.getGlobal('innerhzrad')) && Prims.gt(maxOrbit, world.observer.getGlobal('outerhzrad')));
  if (passesThroughHz_p) {
    output = (Dump("") + Dump(output) + Dump("ORBITAL DISTANCE: -\nThere will be very large temperature swings as the planet orbits. Surface water will evaporate when too close to the star and freeze when the planet moves beyond the liquid water zone. "));
    OutputPrims.print(Call(parseOutput, output));
    throw new Exception.StopInterrupt;
  }
  if (tooClose_p) {
    output = (Dump("") + Dump(output) + Dump("ORBITAL DISTANCE: -\nThe planet passes too close to the star. It will be very hot, causing water to evaporate at high rates, which could lead to a runaway greenhouse effect and/or cause water loss to space. "));
    OutputPrims.print(Call(parseOutput, output));
    throw new Exception.StopInterrupt;
  }
  if (tooFar_p) {
    output = (Dump("") + Dump(output) + Dump("ORBITAL DISTANCE: -\nThe planet orbits too far from the star. It will be very cold, causing any surface water to be frozen. "));
    OutputPrims.print(Call(parseOutput, output));
    throw new Exception.StopInterrupt;
  }
  output = (Dump("") + Dump(output) + Dump("STAR TYPE: +\nThe star has a wide zone in which liquid water could exist.  The star's lifespan is more than one billion years, allowing time for life to evolve. "));
  output = (Dump("") + Dump(output) + Dump("\n\nPLANET TYPE: +\nRocky planets are more likely to contain the chemical building blocks of life than gaseous planets. "));
  output = (Dump("") + Dump(output) + Dump("\n\nORBITAL DISTANCE: +\nThe planet orbits within the zone in which liquid water could exist on the surface of the planet. "));
  output = (Dump("") + Dump(output) + Dump("\n\nPLANET SIZE: +\nThe planet is large enough to hold an atmosphere.  It is also large enough to have tectonic activity (volcanoes and movement of planetary surfaces).  Tectonic activity allows for rock recycling on the planet, helping to stabilize atmospheric carbon dioxide levels, which stabalizes global temperatures. "));
  OutputPrims.print(Call(parseOutput, output));
}
function handleMessages() {
  if (world.observer.getGlobal('custom-planet')) {
    world.turtleManager.turtlesOfBreed("VIEW-DISPLAYS").agentFilter(function() {
      return Prims.equality(SelfPrims.getVariable('number'), 1);
    }).ask(function() {
      SelfManager.self().hideTurtle(false);;
      SelfPrims.setVariable('label', "When you are ready to run the model, turn off the 'custom-planet' switch.");
      SelfPrims.setXY((world.topology.maxPxcor - 20), (world.topology.minPycor + 1));
    }, true);
  }
  if (!world.observer.getGlobal('custom-planet')) {
    world.turtleManager.turtlesOfBreed("VIEW-DISPLAYS").agentFilter(function() {
      return Prims.equality(SelfPrims.getVariable('number'), 1);
    }).ask(function() {
      SelfManager.self().hideTurtle(false);;
      SelfPrims.setVariable('label', "To move the planet, turn on the 'custom-planet' switch.");
      SelfPrims.setXY((world.topology.maxPxcor - 27), (world.topology.minPycor + 1));
    }, true);
  }
}
function handleOccultation() {
  if ((Call(nearOcc_p) && !world.observer.getGlobal('insert-on?'))) {
    world.observer.setGlobal('insert-on?', true);
    OutputPrims.print("A transit is coming up!!");
    if (Prims.gt(world.observer.getGlobal('planet-diameter'), 4.2)) {
      OutputPrims.print("Watch the insert.");
    }
    else {
      OutputPrims.print("The planet is too small to see.");
    }
    OutputPrims.print("Simulation slowed");
  }
  if ((world.observer.getGlobal('insert-on?') && !Call(nearOcc_p))) {
    world.observer.setGlobal('insert-on?', false);
    OutputPrims.clear();
  }
}
function doScaleChange() {
  var d = 0;
  if (Prims.equality(world.observer.getGlobal('grid-scale'), "From Earth")) {
    d = 10000;
  }
  else {
    d = Call(scaleToNum, world.observer.getGlobal('grid-scale'));
  }
  Call(updateScale, d);
}
function updateScale(d) {
  if (Prims.equality(world.observer.getGlobal('old-distance'), d)) {
    world.observer.setGlobal('dist', d);
    if (Prims.lte(d, 500)) {
      Call(updateScreen);
    }
    else {
      world.turtleManager.turtlesOfBreed("SPOTS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("ARROWHEADS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("BREAD-CRUMBS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("PLANETS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.linkManager.linksOfBreed("GLINES").ask(function() {
        SelfPrims.setVariable('hidden?', true)
      }, true);
    }
  }
  else {
    world.turtleManager.turtlesOfBreed("BREAD-CRUMBS").ask(function() {
      SelfPrims.die();
    }, true);
    var n = 50;
    world.observer.setGlobal('dist', world.observer.getGlobal('old-distance'));
    var dd = ((d - world.observer.getGlobal('old-distance')) / n);
    if (Prims.gt(dd, 0)) {
      for (var _index_21421_21427 = 0, _repeatcount_21421_21427 = StrictMath.floor(n); _index_21421_21427 < _repeatcount_21421_21427; _index_21421_21427++){
        world.observer.setGlobal('dist', (world.observer.getGlobal('dist') + dd));
        Call(updateScreen);
      }
      world.observer.setGlobal('old-distance', d);
      world.observer.setGlobal('grid-size', (d / 2));
      Call(newGrid, world.observer.getGlobal('grid-size'));
    }
    else {
      world.observer.setGlobal('grid-size', (d / 2));
      world.turtleManager.turtlesOfBreed("SPOTS").ask(function() {
        SelfPrims.die();
      }, true);
      Call(newGrid, world.observer.getGlobal('grid-size'));
      for (var _index_22142_22148 = 0, _repeatcount_22142_22148 = StrictMath.floor(n); _index_22142_22148 < _repeatcount_22142_22148; _index_22142_22148++){
        world.observer.setGlobal('dist', (world.observer.getGlobal('dist') + dd));
        Call(updateScreen);
      }
      world.observer.setGlobal('old-distance', d);
    }
    Call(scaleVariables, d);
  }
}
function scaleVariables(d) {
  var f = StrictMath.pow(d, 1.5);
  world.observer.setGlobal('bread-crumb-lifetime', (0.08 * f));
  world.observer.setGlobal('time/bread-crumb', (6.0E-4 * f));
}
function updateScreen() {
  world.turtleManager.turtlesOfBreed("SPOTS").ask(function() {
    SelfManager.self().hideTurtle(false);;
    var loc = Call(screen_Coords, SelfPrims.getVariable('xs'), SelfPrims.getVariable('ys'));
    var u = ListPrims.first(loc);
    var v = ListPrims.item(1, loc);
    if (Call(inView_p, u, v)) {
      SelfPrims.setXY(u, v);
      SelfManager.self().hideTurtle(false);;
    }
    else {
      SelfManager.self().hideTurtle(true);;
    }
  }, true);
  world.turtleManager.turtlesOfBreed("PLANETS").ask(function() {
    var loc = Call(screen_Coords, SelfPrims.getVariable('x-cor'), SelfPrims.getVariable('y-cor'));
    var u = ListPrims.first(loc);
    var v = ListPrims.item(1, loc);
    SelfPrims.setVariable('w-cor', ListPrims.last(loc));
    if (Call(inView_p, u, v)) {
      SelfPrims.setXY(u, v);
      SelfManager.self().hideTurtle(false);;
      world.linkManager.getLink(0, 2, 'GLINES').ask(function() {
        SelfPrims.setVariable('hidden?', false)
      }, true);
    }
    else {
      SelfManager.self().hideTurtle(true);;
      world.linkManager.getLink(0, 2, 'GLINES').ask(function() {
        SelfPrims.setVariable('hidden?', true)
      }, true);
      world.turtleManager.turtlesOfBreed("ARROWHEADS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("FRONT-ARROWHEADS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
      world.turtleManager.turtlesOfBreed("FRONT-PLANETS").ask(function() {
        SelfManager.self().hideTurtle(true);;
      }, true);
    }
  }, true);
  world.turtleManager.turtlesOfBreed("STARS").ask(function() {
    var loc = Call(screen_Coords, SelfPrims.getVariable('x-cor'), SelfPrims.getVariable('y-cor'));
    var u = ListPrims.first(loc);
    var v = ListPrims.item(1, loc);
    SelfPrims.setVariable('w-cor', ListPrims.last(loc));
    if (Call(inView_p, u, v)) {
      SelfPrims.setXY(u, v);
      SelfManager.self().hideTurtle(false);;
      world.turtleManager.turtlesOfBreed("OUTERHZ").ask(function() {
        SelfPrims.setXY(u, v);
        SelfPrims.setVariable('size', Call(tsize, world.observer.getGlobal('outerhzrad')));
      }, true);
      world.turtleManager.turtlesOfBreed("INNERHZ").ask(function() {
        SelfPrims.setXY(u, v);
        SelfPrims.setVariable('size', Call(tsize, world.observer.getGlobal('innerhzrad')));
      }, true);
    }
    else {
      SelfManager.self().hideTurtle(true);;
    }
  }, true);
  world.turtleManager.turtlesOfBreed("BREAD-CRUMBS").ask(function() {
    var loc = Call(screen_Coords, SelfPrims.getVariable('xd'), SelfPrims.getVariable('yd'));
    var u = ListPrims.first(loc);
    var v = ListPrims.item(1, loc);
    if (Call(inView_p, u, v)) {
      SelfPrims.setXY(u, v);
      SelfManager.self().hideTurtle(false);;
    }
    else {
      SelfManager.self().hideTurtle(true);;
    }
    SelfPrims.setVariable('age', (SelfPrims.getVariable('age') + world.observer.getGlobal('delta-t')));
    if (Prims.gt(SelfPrims.getVariable('age'), world.observer.getGlobal('bread-crumb-lifetime'))) {
      SelfPrims.die();
    }
    var alpha = ((255 * (world.observer.getGlobal('bread-crumb-lifetime') - SelfPrims.getVariable('age'))) / world.observer.getGlobal('bread-crumb-lifetime'));
    SelfPrims.setVariable('color', ListPrims.lput(alpha, [255, 255, 255]));
  }, true);
  world.turtleManager.turtlesOfBreed("ARROWHEADS").ask(function() {
    SelfManager.self().hideTurtle(false);;
    SelfPrims.setVariable('xa', (ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
      return SelfPrims.getVariable('x-cor');
    }) + (world.observer.getGlobal('v-scale') * ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
      return SelfPrims.getVariable('vx');
    }))));
    SelfPrims.setVariable('ya', (ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
      return SelfPrims.getVariable('y-cor');
    }) + (world.observer.getGlobal('v-scale') * ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
      return SelfPrims.getVariable('vy');
    }))));
    SelfPrims.setVariable('heading', (180 + SelfManager.self().towards(world.observer.getGlobal('new-planet'))));
    var loc = Call(screen_Coords, SelfPrims.getVariable('xa'), SelfPrims.getVariable('ya'));
    var u = ListPrims.first(loc);
    var v = ListPrims.item(1, loc);
    if (Call(inView_p, u, v)) {
      SelfPrims.setXY(u, v);
      SelfManager.self().hideTurtle(false);;
    }
    else {
      SelfManager.self().hideTurtle(true);;
    }
  }, true);
  world.turtleManager.turtlesOfBreed("FRONT-PLANETS").ask(function() {
    var yy = world.observer.getGlobal('new-planet').projectionBy(function() {
      return SelfPrims.getVariable('ycor');
    });
    SelfPrims.setVariable('xcor', world.observer.getGlobal('new-planet').projectionBy(function() {
      return SelfPrims.getVariable('xcor');
    }));
    SelfPrims.setVariable('ycor', world.observer.getGlobal('new-planet').projectionBy(function() {
      return SelfPrims.getVariable('ycor');
    }));
    if (Prims.gte(yy, 0)) {
      SelfManager.self().hideTurtle(true);;
    }
    else {
      if (!world.observer.getGlobal('new-planet').projectionBy(function() {
        return SelfPrims.getVariable('hidden?');
      })) {
        SelfManager.self().hideTurtle(false);;
      }
    }
  }, true);
  world.turtleManager.turtlesOfBreed("FRONT-ARROWHEADS").ask(function() {
    var yy = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("ARROWHEADS")).projectionBy(function() {
      return SelfPrims.getVariable('ycor');
    });
    SelfPrims.setVariable('xcor', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("ARROWHEADS")).projectionBy(function() {
      return SelfPrims.getVariable('xcor');
    }));
    SelfPrims.setVariable('ycor', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("ARROWHEADS")).projectionBy(function() {
      return SelfPrims.getVariable('ycor');
    }));
    SelfPrims.setVariable('heading', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("ARROWHEADS")).projectionBy(function() {
      return SelfPrims.getVariable('heading');
    }));
    if (Prims.gte(yy, 0)) {
      SelfManager.self().hideTurtle(true);;
    }
    else {
      if (!world.observer.getGlobal('new-planet').projectionBy(function() {
        return SelfPrims.getVariable('hidden?');
      })) {
        SelfManager.self().hideTurtle(false);;
      }
    }
  }, true);
  if (world.observer.getGlobal('insert-on?')) {
    world.turtleManager.turtlesOfBreed("INSERT-STAR").ask(function() {
      SelfManager.self().hideTurtle(false);;
    }, true);
    world.turtleManager.turtlesOfBreed("INSERT-BACKGROUND").ask(function() {
      SelfManager.self().hideTurtle(false);;
    }, true);
    world.turtleManager.turtlesOfBreed("INSERT-PLANET").ask(function() {
      SelfManager.self().hideTurtle(false);;
      SelfPrims.setVariable('size', ((world.observer.getGlobal('insert-size') * world.observer.getGlobal('planet-diameter')) / 218));
      var xCenter = (world.topology.minPxcor + (world.observer.getGlobal('insert-size') / 2));
      var yCenter = (world.topology.maxPycor - (world.observer.getGlobal('insert-size') / 2));
      var u1 = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
        return SelfPrims.getVariable('x-cor');
      });
      var u2 = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("STARS")).projectionBy(function() {
        return SelfPrims.getVariable('x-cor');
      });
      var v1 = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
        return SelfPrims.getVariable('ycor');
      });
      var v2 = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("STARS")).projectionBy(function() {
        return SelfPrims.getVariable('ycor');
      });
      var mag = 50;
      var du = ((mag * (u1 - u2)) * world.observer.getGlobal('scale'));
      var dv = (mag * (v1 - v2));
      var u = (xCenter + du);
      var v = (yCenter + dv);
      if (Call(inInsert_p, u, v)) {
        SelfManager.self().hideTurtle(false);;
        SelfPrims.setXY(u, v);
      }
      else {
        SelfManager.self().hideTurtle(true);;
      }
      if (Prims.lt((StrictMath.pow(du, 2) + StrictMath.pow(dv, 2)), StrictMath.pow((world.observer.getGlobal('insert-size') / 4), 2))) {
        world.observer.setGlobal('brightness', (1 - StrictMath.pow(((SelfPrims.getVariable('size') * 2) / world.observer.getGlobal('insert-size')), 2)));
      }
      else {
        world.observer.setGlobal('brightness', 1);
      }
    }, true);
    if (Prims.lte(world.observer.getGlobal('planet-diameter'), 3.4)) {
      world.turtleManager.turtlesOfBreed("VIEW-DISPLAYS").agentFilter(function() {
        return Prims.equality(SelfPrims.getVariable('number'), 4);
      }).ask(function() {
        SelfManager.self().hideTurtle(false);;
        SelfPrims.setVariable('label', "planet too small to see");
        SelfPrims.setVariable('label-color', 15);
        if (ListPrims.first(world.turtleManager.turtlesOfBreed("INSERT-PLANET").projectionBy(function() {
          return SelfPrims.getVariable('hidden?');
        }))) {
          world.linkManager.linksOfBreed("POINTERS").ask(function() {
            SelfPrims.setVariable('hidden?', true)
          }, true);
        }
        else {
          LinkPrims.createLinksTo(world.turtleManager.turtlesOfBreed("INSERT-PLANET"), 'POINTERS').ask(function() {}, false);
          world.linkManager.linksOfBreed("POINTERS").ask(function() {
            SelfPrims.setVariable('hidden?', false)
          }, true);
        }
      }, true);
    }
  }
  else {
    world.turtleManager.turtlesOfBreed("INSERT-STAR").ask(function() {
      SelfManager.self().hideTurtle(true);;
    }, true);
    world.turtleManager.turtlesOfBreed("INSERT-BACKGROUND").ask(function() {
      SelfManager.self().hideTurtle(true);;
    }, true);
    world.turtleManager.turtlesOfBreed("VIEW-DISPLAYS").agentFilter(function() {
      return Prims.equality(SelfPrims.getVariable('number'), 4);
    }).ask(function() {
      SelfManager.self().hideTurtle(true);;
    }, true);
    world.turtleManager.turtlesOfBreed("INSERT-PLANET").ask(function() {
      SelfManager.self().hideTurtle(true);;
    }, true);
    world.linkManager.linksOfBreed("POINTERS").ask(function() {
      SelfPrims.setVariable('hidden?', true)
    }, true);
    world.observer.setGlobal('brightness', 1);
  }
}
function inInsert_p(u, v) {
  if ((((Prims.gt(u, world.topology.minPxcor) && Prims.lt(u, (world.topology.minPxcor + world.observer.getGlobal('insert-size')))) && Prims.lt(v, world.topology.maxPycor)) && Prims.gt(v, (world.topology.maxPycor - world.observer.getGlobal('insert-size'))))) {
    return true;
  }
  else {
    return false;
  }
}
function inView_p(u, v) {
  var val = (((Prims.gt(u, world.topology.minPxcor) && Prims.lt(u, world.topology.maxPxcor)) && Prims.gt(v, world.topology.minPycor)) && Prims.lt(v, world.topology.maxPycor));
  if (world.observer.getGlobal('insert-on?')) {
    return (val && !Call(inInsert_p, u, v));
  }
  else {
    return val;
  }
}
function setPlanetMass() {
  var relDensity = (1 / 4.13);
  if (world.observer.getGlobal('rocky-planet')) {
    relDensity = 1;
  }
  var pm = (relDensity * StrictMath.pow(world.observer.getGlobal('planet-diameter'), 3));
  world.turtleManager.turtlesOfBreed("PLANETS").ask(function() {
    SelfPrims.setVariable('mass', pm);
  }, true);
  if (Prims.lt(pm, 30)) {
    if (Prims.lt(pm, 2)) {
      world.observer.setGlobal('planet-mass', Prims.precision(pm, 3));
    }
    else {
      world.observer.setGlobal('planet-mass', Prims.precision(pm, 2));
    }
  }
  else {
    world.observer.setGlobal('planet-mass', StrictMath.round(pm));
  }
  world.turtleManager.turtlesOfBreed("VIEW-DISPLAYS").agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable('number'), 2);
  }).ask(function() {
    SelfPrims.setVariable('label', (Dump("") + Dump("The planet's mass is ") + Dump(world.observer.getGlobal('planet-mass')) + Dump(" times the earth's mass.")));
    SelfManager.self().hideTurtle(false);;
  }, true);
}
function adjustPlanet() {
  world.turtleManager.turtlesOfBreed("BREAD-CRUMBS").ask(function() {
    SelfPrims.die();
  }, true);
  world.observer.setGlobal('theta', 0);
  Call(updateScreen);
  if (((MousePrims.isInside() && MousePrims.isDown()) || !Prims.equality(world.observer.getGlobal('old-planet-mass'), world.observer.getGlobal('planet-mass')))) {
    world.observer.setGlobal('preset-planets', "Custom");
    world.observer.setGlobal('old-preset-planets', "Custom");
    world.observer.setGlobal('old-planet-mass', world.observer.getGlobal('planet-mass'));
    var locPlanet = Call(screen_Coords, world.observer.getGlobal('new-planet').projectionBy(function() {
      return SelfPrims.getVariable('x-cor');
    }), world.observer.getGlobal('new-planet').projectionBy(function() {
      return SelfPrims.getVariable('y-cor');
    }));
    var locArrowhead = Call(screen_Coords, ListPrims.oneOf(world.turtleManager.turtlesOfBreed("ARROWHEADS")).projectionBy(function() {
      return SelfPrims.getVariable('xa');
    }), ListPrims.oneOf(world.turtleManager.turtlesOfBreed("ARROWHEADS")).projectionBy(function() {
      return SelfPrims.getVariable('ya');
    }));
    var locMouse = ListPrims.list(MousePrims.getX(), MousePrims.getY(), 0);
    if (!Call(inView_p, ListPrims.first(locPlanet), ListPrims.item(1, locPlanet))) {
      world.observer.getGlobal('new-planet').ask(function() {
        SelfPrims.setVariable('x-cor', (0.1 * Call(scaleToNum, world.observer.getGlobal('grid-scale'))));
        SelfPrims.setVariable('y-cor', (0.1 * Call(scaleToNum, world.observer.getGlobal('grid-scale'))));
      }, true);
      world.turtleManager.turtlesOfBreed("ARROWHEADS").ask(function() {
        SelfPrims.setVariable('xa', (0.09 * Call(scaleToNum, world.observer.getGlobal('grid-scale'))));
        SelfPrims.setVariable('ya', (0.11 * Call(scaleToNum, world.observer.getGlobal('grid-scale'))));
      }, true);
      locPlanet = Call(screen_Coords, world.observer.getGlobal('new-planet').projectionBy(function() {
        return SelfPrims.getVariable('x-cor');
      }), world.observer.getGlobal('new-planet').projectionBy(function() {
        return SelfPrims.getVariable('y-cor');
      }));
      locArrowhead = Call(screen_Coords, ListPrims.oneOf(world.turtleManager.turtlesOfBreed("ARROWHEADS")).projectionBy(function() {
        return SelfPrims.getVariable('xa');
      }), ListPrims.oneOf(world.turtleManager.turtlesOfBreed("ARROWHEADS")).projectionBy(function() {
        return SelfPrims.getVariable('ya');
      }));
      Call(updateScreen);
    }
    if (Prims.lt(Call(distBetween, locMouse, locPlanet), Call(distBetween, locMouse, locArrowhead))) {
      while ((MousePrims.isInside() && MousePrims.isDown())) {
        world.turtleManager.turtlesOfBreed("PLANETS").ask(function() {
          var u = MousePrims.getX();
          var v = MousePrims.getY();
          SelfPrims.setVariable('x-cor', ((world.observer.getGlobal('dist') * u) / world.observer.getGlobal('scale')));
          SelfPrims.setVariable('y-cor', ((world.observer.getGlobal('dist') * v) / world.observer.getGlobal('scale')));
        }, true);
        world.turtleManager.turtlesOfBreed("ARROWHEADS").ask(function() {
          SelfPrims.setVariable('xa', (ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
            return SelfPrims.getVariable('x-cor');
          }) + (world.observer.getGlobal('v-scale') * ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
            return SelfPrims.getVariable('vx');
          }))));
          SelfPrims.setVariable('ya', (ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
            return SelfPrims.getVariable('y-cor');
          }) + (world.observer.getGlobal('v-scale') * ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
            return SelfPrims.getVariable('vy');
          }))));
          SelfPrims.setVariable('heading', (180 + SelfManager.self().towards(world.observer.getGlobal('new-planet'))));
        }, true);
        Call(updateScreen);
      }
    }
    else {
      while ((MousePrims.isInside() && MousePrims.isDown())) {
        world.turtleManager.turtlesOfBreed("ARROWHEADS").ask(function() {
          var u = MousePrims.getX();
          var v = MousePrims.getY();
          SelfPrims.setVariable('xa', ((world.observer.getGlobal('dist') * u) / world.observer.getGlobal('scale')));
          SelfPrims.setVariable('ya', ((world.observer.getGlobal('dist') * v) / world.observer.getGlobal('scale')));
          SelfPrims.setVariable('heading', (180 + SelfManager.self().towards(world.observer.getGlobal('new-planet'))));
        }, true);
        world.turtleManager.turtlesOfBreed("PLANETS").ask(function() {
          SelfPrims.setVariable('vx', ((ListPrims.oneOf(world.turtleManager.turtlesOfBreed("ARROWHEADS")).projectionBy(function() {
            return SelfPrims.getVariable('xa');
          }) - SelfPrims.getVariable('x-cor')) / world.observer.getGlobal('v-scale')));
          SelfPrims.setVariable('vy', ((ListPrims.oneOf(world.turtleManager.turtlesOfBreed("ARROWHEADS")).projectionBy(function() {
            return SelfPrims.getVariable('ya');
          }) - SelfPrims.getVariable('y-cor')) / world.observer.getGlobal('v-scale')));
        }, true);
        Call(updateScreen);
      }
    }
    Call(scaleVariables, Call(scaleToNum, world.observer.getGlobal('grid-scale')));
    world.observer.setGlobal('v-scale', (0.003 * StrictMath.pow(Call(scaleToNum, world.observer.getGlobal('grid-scale')), 1.5)));
  }
}
function nearOcc_p() {
  var u1 = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
    return SelfPrims.getVariable('x-cor');
  });
  var u2 = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("STARS")).projectionBy(function() {
    return SelfPrims.getVariable('x-cor');
  });
  var v1 = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
    return SelfPrims.getVariable('ycor');
  });
  var v2 = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("STARS")).projectionBy(function() {
    return SelfPrims.getVariable('ycor');
  });
  var w1 = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
    return SelfPrims.getVariable('w-cor');
  });
  var w2 = ListPrims.oneOf(world.turtleManager.turtlesOfBreed("STARS")).projectionBy(function() {
    return SelfPrims.getVariable('w-cor');
  });
  if (((Prims.lt(StrictMath.abs((u1 - u2)), 0.005) && Prims.lt(StrictMath.abs((v1 - v2)), 1.0E-14)) && Prims.lt(w1, w2))) {
    return true;
  }
  else {
    return false;
  }
  return false;
}
function stepForwardInTime() {
  var timeStep = (world.observer.getGlobal('delta-t') * world.observer.getGlobal('sim-speed'));
  if (world.observer.getGlobal('first-step?')) {
    world.turtleManager.turtlesOfBreed("STARS").ask(function() {
      SelfPrims.setVariable('w-cor', ListPrims.last(Call(screen_Coords, SelfPrims.getVariable('x-cor'), SelfPrims.getVariable('y-cor'))));
    }, true);
    world.observer.setGlobal('last-bread-crumb-time', 0);
  }
  world.turtleManager.turtlesOfBreed("PLANETS").ask(function() {
    SelfPrims.setVariable('x-cor', (SelfPrims.getVariable('x-cor') + ((SelfPrims.getVariable('vx') * timeStep) / 2)));
    SelfPrims.setVariable('y-cor', (SelfPrims.getVariable('y-cor') + ((SelfPrims.getVariable('vy') * timeStep) / 2)));
    var factor = ((world.observer.getGlobal('g') * ListPrims.oneOf(world.turtleManager.turtlesOfBreed("STARS")).projectionBy(function() {
      return SelfPrims.getVariable('mass');
    })) / StrictMath.pow((StrictMath.pow(SelfPrims.getVariable('x-cor'), 2) + StrictMath.pow(SelfPrims.getVariable('y-cor'), 2)), 1.5));
    var ax = (SelfPrims.getVariable('x-cor') * factor);
    var ay = (SelfPrims.getVariable('y-cor') * factor);
    SelfPrims.setVariable('vx', (SelfPrims.getVariable('vx') + (ax * timeStep)));
    SelfPrims.setVariable('vy', (SelfPrims.getVariable('vy') + (ay * timeStep)));
    SelfPrims.setVariable('x-cor', (SelfPrims.getVariable('x-cor') + ((SelfPrims.getVariable('vx') * timeStep) / 2)));
    SelfPrims.setVariable('y-cor', (SelfPrims.getVariable('y-cor') + ((SelfPrims.getVariable('vy') * timeStep) / 2)));
    world.observer.setGlobal('elapsed-time', (world.observer.getGlobal('elapsed-time') + timeStep));
  }, true);
  if (Prims.lt((world.observer.getGlobal('last-bread-crumb-time') + world.observer.getGlobal('time/bread-crumb')), world.observer.getGlobal('elapsed-time'))) {
    world.observer.setGlobal('last-bread-crumb-time', world.observer.getGlobal('elapsed-time'));
    world.turtleManager.createTurtles(1, 'BREAD-CRUMBS').ask(function() {
      SelfPrims.setVariable('shape', "dot");
      SelfPrims.setVariable('size', 1);
      SelfPrims.setVariable('color', 25);
      SelfPrims.setVariable('age', 0);
      SelfPrims.setVariable('xd', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
        return SelfPrims.getVariable('x-cor');
      }));
      SelfPrims.setVariable('yd', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
        return SelfPrims.getVariable('y-cor');
      }));
    }, true);
    if ((world.observer.getGlobal('analyzing-solar-system?') && (Prims.lt(ListPrims.length(world.observer.getGlobal('orbital-dist-points')), 100) && (!Prims.equality(world.observer.getGlobal('star-type'), ListPrims.item(0, world.observer.getGlobal('star-list'))) && (!Prims.equality(world.observer.getGlobal('star-type'), ListPrims.item(4, world.observer.getGlobal('star-list'))) && (world.observer.getGlobal('rocky-planet') && Prims.gt(world.observer.getGlobal('new-planet').projectionBy(function() {
      return SelfPrims.getVariable('mass');
    }), (2.5E24 / world.observer.getGlobal('earth-mass'))))))))) {
      world.observer.setGlobal('orbital-dist-points', ListPrims.fput(Call(distBetween, ListPrims.list(world.observer.getGlobal('new-planet').projectionBy(function() {
        return SelfPrims.getVariable('x-cor');
      }), world.observer.getGlobal('new-planet').projectionBy(function() {
        return SelfPrims.getVariable('y-cor');
      })), ListPrims.list(world.observer.getGlobal('new-star').projectionBy(function() {
        return SelfPrims.getVariable('x-cor');
      }), world.observer.getGlobal('new-star').projectionBy(function() {
        return SelfPrims.getVariable('y-cor');
      }))), world.observer.getGlobal('orbital-dist-points')));
    }
    else {
      if (world.observer.getGlobal('analyzing-solar-system?')) {
        world.observer.setGlobal('analyzing-solar-system?', false);
        Call(generateAnalysis);
      }
    }
  }
  world.turtleManager.turtlesOfBreed("STARS").ask(function() {
    var rho = (0 - (ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
      return SelfPrims.getVariable('mass');
    }) / SelfPrims.getVariable('mass')));
    SelfPrims.setVariable('x-cor', (rho * ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
      return SelfPrims.getVariable('x-cor');
    })));
    SelfPrims.setVariable('y-cor', (rho * ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
      return SelfPrims.getVariable('y-cor');
    })));
    SelfPrims.setVariable('vx', (rho * ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
      return SelfPrims.getVariable('vx');
    })));
    SelfPrims.setVariable('vy', (rho * ListPrims.oneOf(world.turtleManager.turtlesOfBreed("PLANETS")).projectionBy(function() {
      return SelfPrims.getVariable('vy');
    })));
    var oldWCor = SelfPrims.getVariable('w-cor');
    SelfPrims.setVariable('w-cor', ListPrims.last(Call(screen_Coords, SelfPrims.getVariable('x-cor'), SelfPrims.getVariable('y-cor'))));
    SelfPrims.setVariable('w-vel', ((SelfPrims.getVariable('w-cor') - oldWCor) / timeStep));
  }, true);
  world.turtleManager.turtlesOfBreed("BREAD-CRUMBS").ask(function() {
    SelfPrims.setVariable('age', (SelfPrims.getVariable('age') + timeStep));
  }, true);
}
function selectCircularVelocity() {
  world.turtleManager.turtlesOfBreed("PLANETS").ask(function() {
    var x = SelfPrims.getVariable('x-cor');
    var y = SelfPrims.getVariable('y-cor');
    var a = Trig.atan(x, y);
    var d = StrictMath.sqrt((StrictMath.pow(SelfPrims.getVariable('x-cor'), 2) + StrictMath.pow(SelfPrims.getVariable('y-cor'), 2)));
    var v = (((2 * 3.141592653589793) / StrictMath.sqrt(d)) * StrictMath.sqrt((world.observer.getGlobal('new-star').projectionBy(function() {
      return SelfPrims.getVariable('mass');
    }) / world.observer.getGlobal('solar-mass'))));
    SelfPrims.setVariable('vx', (0 - (v * Trig.unsquashedCos(a))));
    SelfPrims.setVariable('vy', (v * Trig.unsquashedSin(a)));
  }, true);
  Call(updateScreen);
}
function supportGraphs() {
  var v = 0;
  var b = 0;
  var timeStep = (world.observer.getGlobal('delta-t') * world.observer.getGlobal('sim-speed'));
  world.observer.setGlobal('plot-interval', 5.0E-5);
  if (world.observer.getGlobal('insert-on?')) {
    world.observer.setGlobal('plot-interval', 5.0E-5);
  }
  world.turtleManager.turtlesOfBreed("STARS").ask(function() {
    if (world.observer.getGlobal('first-step?')) {
      plotManager.clearAllPlots();
      world.observer.setGlobal('elapsed-time', 0);
      world.observer.setGlobal('last-plot-time', 0);
      world.observer.setGlobal('last-bread-crumb-time', 0);
      throw new Exception.StopInterrupt;
    }
    else {
      b = world.observer.getGlobal('brightness');
      if (Prims.gt(world.observer.getGlobal('elapsed-time'), (world.observer.getGlobal('last-plot-time') + world.observer.getGlobal('plot-interval')))) {
        world.observer.setGlobal('last-plot-time', world.observer.getGlobal('elapsed-time'));
        v = SelfPrims.getVariable('w-vel');
        var vNoise = ((0.3 * Call(randNoise)) / world.observer.getGlobal('telescope-precision'));
        var bNoise = ((0.3 * Call(randNoise)) / world.observer.getGlobal('telescope-precision'));
        if (!Prims.equality(world.observer.getGlobal('telescope-precision'), 100)) {
          v = (SelfPrims.getVariable('w-vel') + vNoise);
          b = (world.observer.getGlobal('brightness') + bNoise);
        }
        if (Prims.equality(world.observer.getGlobal('preset-planets'), "No Planet")) {
          if (Prims.equality(world.observer.getGlobal('telescope-precision'), 100)) {
            Call(graph, 1, 0, world.observer.getGlobal('elapsed-time'));
          }
          else {
            Call(graph, (1 + bNoise), vNoise, world.observer.getGlobal('elapsed-time'));
          }
        }
        else {
          Call(graph, b, v, world.observer.getGlobal('elapsed-time'));
        }
      }
    }
  }, true);
}
function graph(b, v, t) {
  var et = Prims.precision((t * world.observer.getGlobal('days-per-year')), 3);
  if (Prims.lt(et, world.observer.getGlobal('graph-time-window'))) {
    world.observer.setGlobal('xrangemin', 0);
    world.observer.setGlobal('xrangemax', world.observer.getGlobal('graph-time-window'));
  }
  else {
    world.observer.setGlobal('xrangemin', Prims.precision((et - world.observer.getGlobal('graph-time-window')), 3));
    world.observer.setGlobal('xrangemax', Prims.precision((t * world.observer.getGlobal('days-per-year')), 3));
  }
  plotManager.setCurrentPlot("Velocity of Star");
  plotManager.setXRange(world.observer.getGlobal('xrangemin'), world.observer.getGlobal('xrangemax'));
  var magnitude = Prims.precision((world.observer.getGlobal('v-y-max') - (((world.observer.getGlobal('v-y-max') - world.observer.getGlobal('v-y-min')) * world.observer.getGlobal('magnify-y-axis')) / 9958)), 5);
  plotManager.setYRange((-1 * magnitude), magnitude);
  plotManager.plotPoint((t * world.observer.getGlobal('days-per-year')), v);
  plotManager.setCurrentPlot("Light Intensity");
  plotManager.setXRange(world.observer.getGlobal('xrangemin'), world.observer.getGlobal('xrangemax'));
  plotManager.setYRange(Prims.precision((world.observer.getGlobal('b-y-min') + (((world.observer.getGlobal('b-y-max') - world.observer.getGlobal('b-y-min')) * world.observer.getGlobal('magnify-y-axis')) / 10000)), 3), world.observer.getGlobal('b-y-max'));
  plotManager.plotPoint((t * world.observer.getGlobal('days-per-year')), b);
}
function yAutoscalePlot(minVal, maxVal, graphName) {
  var range = StrictMath.abs((maxVal - minVal));
  plotManager.setCurrentPlot(graphName);
  plotManager.setYRange(Prims.precision((minVal - (range * 0.2)), 3), Prims.precision((minVal + (range * 0.2)), 3));
}
function handlePresets() {
  world.turtleManager.turtlesOfBreed("PLANETS").ask(function() {
    if (world.observer.getGlobal('resetting?')) {
      SelfPrims.setVariable('x-cor', (1 / StrictMath.sqrt(2)));
      SelfPrims.setVariable('y-cor', (1 / StrictMath.sqrt(2)));
      world.observer.setGlobal('planet-diameter', 1);
      Call(selectCircularVelocity);
      world.observer.setGlobal('rocky-planet', true);
      world.observer.setGlobal('resetting?', false);
    }
    else {
      if (!Prims.equality(world.observer.getGlobal('preset-planets'), "No Planet")) {
        SelfManager.self().hideTurtle(false);;
      }
      if (Prims.equality(world.observer.getGlobal('preset-planets'), "Custom")) {
        world.observer.setGlobal('custom-planet', true);
      }
      if (Prims.equality(world.observer.getGlobal('preset-planets'), "Earth")) {
        SelfPrims.setVariable('x-cor', (1 / StrictMath.sqrt(2)));
        SelfPrims.setVariable('y-cor', (1 / StrictMath.sqrt(2)));
        world.observer.setGlobal('grid-scale', "1 box = 0.25 au");
        world.observer.setGlobal('planet-diameter', 1);
        world.observer.setGlobal('star-type', ListPrims.item(2, world.observer.getGlobal('star-list')));
        Call(updateStar);
        Call(selectCircularVelocity);
        world.observer.setGlobal('rocky-planet', true);
      }
      if (Prims.equality(world.observer.getGlobal('preset-planets'), "Mars")) {
        SelfPrims.setVariable('x-cor', (1.5 / StrictMath.sqrt(2)));
        SelfPrims.setVariable('y-cor', (1.5 / StrictMath.sqrt(2)));
        world.observer.setGlobal('grid-scale', "1 box = 0.25 au");
        world.observer.setGlobal('planet-diameter', Prims.precision(StrictMath.pow(0.107, 0.3333), 3));
        world.observer.setGlobal('star-type', ListPrims.item(2, world.observer.getGlobal('star-list')));
        Call(updateStar);
        Call(selectCircularVelocity);
        world.observer.setGlobal('rocky-planet', true);
      }
      if (Prims.equality(world.observer.getGlobal('preset-planets'), "Jupiter")) {
        SelfPrims.setVariable('x-cor', (5.2 / StrictMath.sqrt(2)));
        SelfPrims.setVariable('y-cor', (5.2 / StrictMath.sqrt(2)));
        world.observer.setGlobal('grid-scale', "1 box = 1.00 au");
        world.observer.setGlobal('planet-diameter', Prims.precision(StrictMath.pow((4.13 * 10.5), 0.3333), 3));
        world.observer.setGlobal('star-type', ListPrims.item(2, world.observer.getGlobal('star-list')));
        Call(updateStar);
        Call(selectCircularVelocity);
        world.observer.setGlobal('rocky-planet', false);
      }
      if (Prims.equality(world.observer.getGlobal('preset-planets'), "Venus")) {
        SelfPrims.setVariable('x-cor', (0.728 / StrictMath.sqrt(2)));
        SelfPrims.setVariable('y-cor', (0.728 / StrictMath.sqrt(2)));
        world.observer.setGlobal('grid-scale', "1 box = 0.25 au");
        world.observer.setGlobal('planet-diameter', Prims.precision(StrictMath.pow(0.815, 0.3333), 3));
        world.observer.setGlobal('star-type', ListPrims.item(2, world.observer.getGlobal('star-list')));
        Call(updateStar);
        Call(selectCircularVelocity);
        world.observer.setGlobal('rocky-planet', true);
      }
      if (Prims.equality(world.observer.getGlobal('preset-planets'), "Like Mercury but 10x larger diameter")) {
        SelfPrims.setVariable('x-cor', (0.467 / StrictMath.sqrt(2)));
        SelfPrims.setVariable('y-cor', (0.467 / StrictMath.sqrt(2)));
        Call(selectCircularVelocity);
        world.observer.setGlobal('planet-diameter', Prims.precision(StrictMath.pow(55, 0.3333), 3));
        world.observer.setGlobal('rocky-planet', true);
      }
      if (Prims.equality(world.observer.getGlobal('preset-planets'), "Like Earth but 10x larger diameter")) {
        SelfPrims.setVariable('x-cor', (1 / StrictMath.sqrt(2)));
        SelfPrims.setVariable('y-cor', (1 / StrictMath.sqrt(2)));
        Call(selectCircularVelocity);
        world.observer.setGlobal('planet-diameter', 10);
        world.observer.setGlobal('rocky-planet', true);
      }
      if (Prims.equality(world.observer.getGlobal('preset-planets'), "Earth-like planet near the star")) {
        SelfPrims.setVariable('x-cor', (0.2 / StrictMath.sqrt(2)));
        SelfPrims.setVariable('y-cor', (0.2 / StrictMath.sqrt(2)));
        Call(selectCircularVelocity);
        world.observer.setGlobal('planet-diameter', 1);
        world.observer.setGlobal('rocky-planet', true);
      }
      if (Prims.equality(world.observer.getGlobal('preset-planets'), "Large rocky planet very near the star")) {
        SelfPrims.setVariable('x-cor', (0.1 / StrictMath.sqrt(2)));
        SelfPrims.setVariable('y-cor', (0.1 / StrictMath.sqrt(2)));
        Call(selectCircularVelocity);
        world.observer.setGlobal('planet-diameter', 50);
        world.observer.setGlobal('rocky-planet', true);
      }
      if (Prims.equality(world.observer.getGlobal('preset-planets'), "Micro planet")) {
        world.observer.setGlobal('planet-diameter', 1.0E-10);
        Call(selectCircularVelocity);
        SelfManager.self().hideTurtle(true);;
      }
      Call(scaleVariables, Call(scaleToNum, world.observer.getGlobal('grid-scale')));
      world.observer.setGlobal('v-scale', (0.003 * StrictMath.pow(Call(scaleToNum, world.observer.getGlobal('grid-scale')), 1.5)));
    }
  }, true);
}
function updateStar() {
  world.observer.setGlobal('old-star-type', world.observer.getGlobal('star-type'));
  var listPos = ListPrims.position(world.observer.getGlobal('star-type'), world.observer.getGlobal('star-list'));
  world.observer.setGlobal('innerhzrad', ListPrims.item(listPos, world.observer.getGlobal('innerhz-list')));
  world.observer.setGlobal('outerhzrad', ListPrims.item(listPos, world.observer.getGlobal('outerhz-list')));
  world.observer.setGlobal('grid-scale', (Prims.equality(world.observer.getGlobal('preset-planets'), "Jupiter") ? "1 box = 1.00 au" : ListPrims.item(listPos, world.observer.getGlobal('view-scale-list'))));
  world.observer.getGlobal('new-star').ask(function() {
    SelfPrims.setVariable('mass', ListPrims.item(listPos, world.observer.getGlobal('star-mass-list')));
    SelfPrims.setVariable('size', ListPrims.item(listPos, world.observer.getGlobal('star-rad-list')));
    SelfPrims.setVariable('color', ListPrims.item(listPos, world.observer.getGlobal('star-color-list')));
  }, true);
  Call(selectCircularVelocity);
}
function randNoise() {
  return ((((((Prims.random(11) + Prims.random(11)) + Prims.random(11)) + Prims.random(11)) + Prims.random(11)) - 25) / 15);
}
function tsize(rad) {
  return ((rad / (world.observer.getGlobal('dist') / 10)) * 28);
}
function parseOutput(string) {
  var segLength = 0;
  var outputString = "";
  while (ListPrims.member(" ", string)) {
    var spacePos = ListPrims.position(" ", string);
    var addedString = ListPrims.substring(string, 0, (spacePos + 1));
    if (ListPrims.member("\n", addedString)) {
      segLength = (ListPrims.length(addedString) - ListPrims.position("\n", addedString));
    }
    if (Prims.gt((segLength + spacePos), 35)) {
      outputString = (Dump("") + Dump(outputString) + Dump("\n"));
      segLength = 0;
    }
    segLength = (segLength + ListPrims.length(addedString));
    outputString = (Dump("") + Dump(outputString) + Dump(addedString));
    string = ListPrims.substring(string, (spacePos + 1), ListPrims.length(string));
  }
  return (Dump("") + Dump(outputString) + Dump(string));
}
function scaleToNum(legend) {
  return (Call(myReadFromString, ListPrims.substring(legend, (ListPrims.position("=", legend) + 2), (ListPrims.position("=", legend) + 6))) * 20);
}
function myReadFromString(string) {
  return string;
}
function screen_Coords(x, y) {
  var ypp = (y * Trig.unsquashedCos(world.observer.getGlobal('theta')));
  var zpp = (y * Trig.unsquashedSin(world.observer.getGlobal('theta')));
  var u = ((world.observer.getGlobal('scale') * x) / (world.observer.getGlobal('dist') + zpp));
  var v = ((world.observer.getGlobal('scale') * ypp) / (world.observer.getGlobal('dist') + zpp));
  return ListPrims.list(u, v, zpp);
}
function newAngles() {
  if ((MousePrims.isDown() && MousePrims.isInside())) {
    if (world.observer.getGlobal('mouse-was-up?')) {
      world.observer.setGlobal('mouse-was-up?', false);
      world.observer.setGlobal('starting-mousey', MousePrims.getY());
      world.observer.setGlobal('old-theta', world.observer.getGlobal('theta'));
    }
    var dmy = (MousePrims.getY() - world.observer.getGlobal('starting-mousey'));
    world.observer.setGlobal('theta', (world.observer.getGlobal('old-theta') + ((dmy * 180) / (world.topology.maxPycor - world.topology.minPycor))));
    if (Prims.gt(world.observer.getGlobal('theta'), 90)) {
      world.observer.setGlobal('theta', 90);
    }
    if (Prims.lt(world.observer.getGlobal('theta'), 0)) {
      world.observer.setGlobal('theta', 0);
    }
  }
  if ((!MousePrims.isDown() && !world.observer.getGlobal('mouse-was-up?'))) {
    world.observer.setGlobal('mouse-was-up?', true);
  }
}
function newGrid(dia) {
  var rad = (dia / 2);
  var spacing = (dia / 10);
  var x = (0 - rad);
  var y = (0 - rad);
  var s = false;
  while (Prims.lte(x, rad)) {
    world.turtleManager.createTurtles(1, 'SPOTS').ask(function() {
      SelfPrims.setVariable('xs', x);
      SelfPrims.setVariable('ys', y);
    }, true);
    world.turtleManager.createTurtles(1, 'SPOTS').ask(function() {
      SelfPrims.setVariable('xs', x);
      SelfPrims.setVariable('ys', (y + rad));
      if ((s && !Prims.equality(x, 0))) {
        SelfPrims.setVariable('label', (Dump("") + Dump(Prims.precision(x, 2)) + Dump(" au")));
      }
      s = !s;
    }, true);
    x = (x + spacing);
  }
  x = (0 - rad);
  y = rad;
  while (Prims.lte(x, rad)) {
    world.turtleManager.createTurtles(1, 'SPOTS').ask(function() {
      SelfPrims.setVariable('xs', x);
      SelfPrims.setVariable('ys', y);
      LinkPrims.createLinksWith(world.turtleManager.turtlesOfBreed("SPOTS").agentFilter(function() {
        return (Prims.equality(SelfPrims.getVariable('xs'), x) && Prims.equality(SelfPrims.getVariable('ys'), (0 - rad)));
      }), 'GLINES').ask(function() {}, false);
      x = (x + spacing);
    }, true);
  }
  x = (0 - rad);
  y = (0 - rad);
  s = false;
  while (Prims.lte(y, rad)) {
    world.turtleManager.createTurtles(1, 'SPOTS').ask(function() {
      SelfPrims.setVariable('xs', x);
      SelfPrims.setVariable('ys', y);
    }, true);
    world.turtleManager.createTurtles(1, 'SPOTS').ask(function() {
      SelfPrims.setVariable('xs', (x + rad));
      SelfPrims.setVariable('ys', y);
      if ((s && !Prims.equality(y, 0))) {
        SelfPrims.setVariable('label', (Dump("") + Dump(Prims.precision(y, 2)) + Dump(" au")));
      }
      s = !s;
      y = (y + spacing);
    }, true);
  }
  x = rad;
  y = (0 - rad);
  while (Prims.lte(y, rad)) {
    world.turtleManager.createTurtles(1, 'SPOTS').ask(function() {
      SelfPrims.setVariable('xs', x);
      SelfPrims.setVariable('ys', y);
      LinkPrims.createLinksWith(world.turtleManager.turtlesOfBreed("SPOTS").agentFilter(function() {
        return (Prims.equality(SelfPrims.getVariable('xs'), (0 - rad)) && Prims.equality(SelfPrims.getVariable('ys'), y));
      }), 'GLINES').ask(function() {}, false);
      y = (y + spacing);
    }, true);
  }
  world.turtleManager.turtlesOfBreed("SPOTS").agentFilter(function() {
    return (Prims.equality(SelfPrims.getVariable('ys'), 0) || Prims.equality(SelfPrims.getVariable('xs'), 0));
  }).ask(function() {
    world.linkManager.linksOfBreed("GLINES").agentFilter(function() {
      return Prims.equality(SelfPrims.getVariable('end1'), SelfManager.myself());
    }).ask(function() {
      SelfPrims.setVariable('color', 135);
    }, true);
  }, true);
  world.turtleManager.turtlesOfBreed("SPOTS").ask(function() {
    SelfPrims.setVariable('size', 0.01);
    SelfPrims.setVariable('label-color', 5);
  }, true);
}
function distBetween(a, b) {
  return StrictMath.sqrt((StrictMath.pow((ListPrims.first(a) - ListPrims.first(b)), 2) + StrictMath.pow((ListPrims.item(1, a) - ListPrims.item(1, b)), 2)));
}
world.observer.setGlobal('simulation-speed', 15);
world.observer.setGlobal('star-type', "G - yellow (temp 5920 K) -> our Sun");
      session.startLoop()
    </script>
  </body>
</html>
