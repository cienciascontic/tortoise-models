



<html>
  <head>
<link rel="stylesheet" type="text/css" href="app.css" charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="app-custom.css" charset="utf-8"/>
  </head>
  <body>
    <div id="model-container"></div>
<script type="text/javascript" src="app.js"></script>
    <script type="text/javascript">
;

      var session =
        (function () {
          var widgets = [{"left":301,"top":10,"right":662,"bottom":392,"patchSize":9.0,"fontSize":14,"wrappingAllowedInX":true,"wrappingAllowedInY":true,"minPxcor":-19,"maxPxcor":19,"minPycor":-19,"maxPycor":19,"updateMode":"Continuous","showTickCounter":true,"tickCounterLabel":"ticks","frameRate":30.0,"type":"view"},{"display":"initial-number","left":96,"top":11,"right":246,"bottom":44,"varName":"initial-number","min":"0","max":"250","default":70.0,"step":"10","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"250"},"compiledStep":{"success":true,"result":"10"}},{"display":"gain-from-food","left":97,"top":85,"right":246,"bottom":118,"varName":"gain-from-food","min":"0.0","max":"4","default":2.0,"step":"0.5","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"4"},"compiledStep":{"success":true,"result":"0.5"}},{"display":"limited-grass?","left":9,"top":169,"right":139,"bottom":202,"varName":"limited-grass?","on":true,"type":"switch"},{"display":"grass-regrowth-rate","left":96,"top":49,"right":247,"bottom":82,"varName":"grass-regrowth-rate","min":".5","max":"95","default":80.5,"step":"5","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0.5"},"compiledMax":{"success":true,"result":"95"},"compiledStep":{"success":true,"result":"5"}},{"display":"setup","left":12,"top":10,"right":81,"bottom":43,"source":"setup","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(setup);"}},{"display":"go once","left":11,"top":51,"right":92,"bottom":84,"source":"go","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"populations","left":9,"top":328,"right":290,"bottom":525,"xAxis":"time","yAxis":"pop.","xmin":0.0,"xmax":20.0,"ymin":0.0,"ymax":100.0,"autoPlotOn":true,"legendOn":true,"setupCode":"","updateCode":"","pens":[{"display":"sheep","interval":1.0,"mode":0,"color":-16777216,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"grass","interval":1.0,"mode":0,"color":-10899396,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}}],"type":"plot","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"population","left":75,"top":269,"right":148,"bottom":314,"source":"count turtles","precision":3,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.turtles().size()"}},{"display":"year","left":13,"top":270,"right":63,"bottom":315,"source":"year","precision":0,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.observer.getGlobal(\"year\")"}},{"display":"reaper","left":185,"top":178,"right":257,"bottom":211,"source":"reaper","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(reaper);"}},{"display":"ON: grass slowly regrows after it is eaten.\nOFF: grass grows back instantly. ","left":10,"top":205,"right":156,"bottom":264,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"number-removed","left":155,"top":216,"right":286,"bottom":249,"varName":"number-removed","min":"0","max":"100","default":30.0,"step":"1","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"100"},"compiledStep":{"success":true,"result":"1"}},{"display":"reduce the herd by number-removed","left":171,"top":256,"right":278,"bottom":284,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"go/stop","left":9,"top":93,"right":91,"bottom":126,"source":"go","forever":true,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"birthrate-%","left":97,"top":122,"right":245,"bottom":155,"varName":"birthrate-%","min":"0","max":"100","default":100.0,"step":"1","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"100"},"compiledStep":{"success":true,"result":"1"}}];
          var code    = "globals [ year   year-length  avg-pop ]\nbreed [ males ]\nbreed [ females ]\n\nturtles-own [ energy  teeth  age ]\nmales-own [  ]            \nfemales-own [  ]  \npatches-own [ countdown]\n\nto startup\nsetup\nend\n  \nto setup \n  ca\n  set year 0\n  set year-length 12\n  ask patches [ set pcolor green ]\n  if limited-grass? [\n      ;; indicates whether the grass switch is on  \n      ;; if it is true, then grass grows and the sheep eat it  \n      ;; if it false, then the grass grows back instantly \n    ask patches [\n      set countdown random (101 - grass-regrowth-rate) ;; initialize grass grow clocks randomly\n      if (random 2) = 0  ;;half the patches start out with grass\n          [ set pcolor brown ]\n    ]\n  ]\n    ask patches [create-fences]\n    \n  set-default-shape females \"ewes\"\n  set-default-shape males \"rams2\"\n  create-males (initial-number / 2)  ;; create the males, then initialize their variables\n  [ \n    set color white\n    set size 2.5\n    set age random 5\n    set energy random (2 * gain-from-food)\n    setxy random-float world-width\n          random-float world-height\n    repeat 6 [if pcolor = red [rt 90 fd 3 ]]\n  ] \n  \n    create-females (initial-number / 2)  ;; create the females, then initialize their variables\n  [ \n    set color white\n    set size 2.5\n    set age random 5\n    set energy random (2 * gain-from-food)\n    setxy random-float world-width\n          random-float world-height\n    if pcolor = red [rt 180 fd 1] \n    repeat 6 [if pcolor = red [rt 90 fd 3 ]]\n]  \n\n  set avg-pop initial-number\n  do-plot\nend\n\nto go\n  repeat year-length [\n  ask males [\n        move\n        eat-grass\n        death\n        ] \n      \n    ask females [\n        move\n        eat-grass \n        death\n        ]\n       \n    if limited-grass? [ ask patches [ grow-grass ] ]\n      display\n    ] \n    \n    ask males  [ \n      set age age + 1\n    ]\n    \n    ask females [\n      set age age + 1 \n      if age > 1 and age <= 6 [reproduce]\n    ]\n    set year year + 1\n    do-plot  ;; plot populations\n  if not any? turtles [ stop ]\nend\n\nto move  ;; turtle procedure\n  rt random-float 50 - random-float 50\n  fd 1\n  if pcolor = red [rt 180 fd 1] \nend\n\nto eat-grass  ;; turtle procedure\n  ;; sheep eat grass, turn the patch brown\n  if limited-grass? [\n    set energy energy - 1 ;; deduct energy for sheep only if limited-grass? switch is on \n    if pcolor = green [ \n      set pcolor brown \n    set energy energy + gain-from-food  ] ;; sheep gain more energy if they have better teeth\n     ] \n     \nend\n\nto reproduce  ;;turtle procedure\n  if random 100 < birthrate-%\n    [ breed-and-birth ] ;; females mate with any ram in the whole field, \"birth-rate\" percent of the time \nend\n\nto breed-and-birth ;; turtle procedure\n  if count males > 0 [  ;; use this to prevent a runtime error if the population is near to extinction\n    hatch 1 [\n    fd 10\n    set age 0\n    set energy 3\n    ifelse (random 2 = 1) \n      [set breed males] \n      [set breed females]\n     ] ]\nend\n\nto death  ;; turtle procedure\n  ;; when energy dips below zero, or sheep gets old, die\n  if energy < 0 [ die ] \n  if age > 6 [die ]\nend\n\nto grow-grass  ;; patch procedure\n  ;; countdown on brown patches, if reach 0, grow some grass\n  if pcolor = brown [ \n    ifelse countdown <= 0\n      [ set pcolor green\n        set countdown (102 - grass-regrowth-rate) ] \n      [ set countdown (countdown - 1) ] \n  ] \nend\n\nto reaper\n   ifelse (count turtles > number-removed) [\n   ask n-of number-removed turtles [die]\n   ]\n   [ask turtles [die]]\nend\n\nto create-fences; patch procedure\nif (abs pxcor) = max-pxcor   [set pcolor red]\nif (abs pycor) = max-pycor [set pcolor red]\n;; if pxcor = 0 [set pcolor red]\nend\n\nto smooth\nset avg-pop (0.95 * avg-pop + 0.05 * count turtles)\nend\n\nto do-plot \n  smooth\n  set-current-plot \"populations\"\n  set-current-plot-pen \"sheep\" \n    plot (count turtles)\n        \n;  set-current-plot-pen \"avg-total\"\n;    plot avg-pop         \n \n  ;; divide by four to keep it within similar range as sheep populations                                         \n  set-current-plot-pen \"grass\"\n    plot (count patches with [pcolor = green]) / 4\n  \nend\n\n";
          var info    = "		Evolution:  Sheep-populationB\n This is a model of a flock of sheep whose survival depends on eating grass. One can study the effect on the population of initial number, grass regrowth rate, and birthrate. PopulationB focuses on uncontrolled growth.\n\nHere are are some explorations:\n\n1. Picture yourself as a rancher with a large field of sheep. You start with an equal number of males (horns) and females (no horns). They live for six years. The sheep move around the field and eat grass, which grows back at a certain rate. The patch is green if there is grass there, and brown if there is no grass. In the model, the sheep move and eat during the year. They use up energy as they move, and gain energy from eating grass. If their energy goes to zero, they die. \n\n2. Once a year, from age 3 to age 6, each female gives birth to a baby. \n\n3. To run the model, always first hit SETUP. Hit GO-ONCE to run the model for one year. Hit GO-FOREVER to run the model continuously. To stop, hit the same button again. The graph shows the amount of grass (green) and the total population (black) as time goes by.\n\n4. What would happen to the population if the sheep had as much grass as they wanted?\n\n5. Try this with the model. Change the LIMITED-GRASS? Switch to OFF. Then there is unlimited grass for the sheep to eat. Click on SETUP. Click on GO-ONCE five times. As the number of sheep gets very large, the model will run more slowly! What happens to the population?\n\n6. Start again by clicking on SETUP. Try using the REAPER button, which reduces the herd at the end of each year. The NUMBER-REMOVED slider sets how many sheep are removed by the REAPER button. Run the model with the GO-FOREVER button. Can you keep the population under control? How?\n\n7. What you just did with the REAPER button is what must happen in nature to keep a population stable. Many animals die every year!\n\n8. Now try changing the variable BIRTHRATE-%. This is the chance that a female will have a baby once a year. Try to keep the population stable even when the GO-FOREVER button is on. If the population gets out of control, stop, hit SETUP, and start again. What is a value of BIRTHRATE-% that keeps the population roughly steady when the grass growth is unlimited? \n\n9. Notice that the effect of changing the birthrate is delayed. Why is this?\n\n10. What is the lowest value of BIRTHRATE-% for which the herd doesnÕt die off?\n\n11. If the sheep only died of old age, the birthrate for a constant population Ð called the Òreplacement rateÓ Ð should be about 50%. HereÕs why.\na. For a 100% birthrate, each female has one baby a year for four years Ð a total of 4 babies in her lifetime.\nb. For a 50% birthrate, each female has 2 babies in her lifetime. \nc. Since the male doesnÕt have babies, the 2 babies just replace the mother and the father.\nIs your minimum birthrate greater or less than 50%? \n\n12. Many animals Ð for example, mosquitoes and fish Ð may lay thousands of eggs in one year. Why might this be a good survival strategy. Why donÕt they take over the world?\n\nTo explore extinction, go on to sheep-populationC.\n";
          return Tortoise.fromCompiledModel('#model-container', widgets, code, info, '', true);
        })();
      var modelConfig  = (typeof window.modelConfig !== "undefined" && window.modelConfig !== null) ? window.modelConfig : {};
var modelPlotOps = (typeof modelConfig.plotOps !== "undefined" && modelConfig.plotOps !== null) ? modelConfig.plotOps : {};

var PenBundle = tortoise_require('engine/plot/pen');
var Plot      = tortoise_require('engine/plot/plot');
var PlotOps   = tortoise_require('engine/plot/plotops');

modelConfig.plots = [(function() {
  var name    = 'populations';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('sheep', plotOps.makePenOps, false, new PenBundle.State(0.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'sheep')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'sheep')(function() {}); }); }),
new PenBundle.Pen('grass', plotOps.makePenOps, false, new PenBundle.State(55.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'grass')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'grass')(function() {}); }); })];
  var setup   = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', undefined)(function() {}); }); };
  var update  = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', undefined)(function() {}); }); };
  return new Plot(name, pens, plotOps, 'time', 'pop.', true, 0.0, 20.0, 0.0, 100.0, setup, update);
})()];
if (typeof javax !== "undefined") { modelConfig.output = { clear: function(){}, write: function(str) { context.getWriter().print(str); } } }

var workspace = tortoise_require('engine/workspace')(modelConfig)([{ name: "MALES", singular: "turtle", varNames: [] }, { name: "FEMALES", singular: "turtle", varNames: [] }])(["energy", "teeth", "age"], [])(["initial-number", "gain-from-food", "limited-grass?", "grass-regrowth-rate", "number-removed", "birthrate-%", "year", "year-length", "avg-pop"], ["initial-number", "gain-from-food", "limited-grass?", "grass-regrowth-rate", "number-removed", "birthrate-%"], ["countdown"], -19, 19, -19, 19, 9.0, true, true, {"default":{"rotate":true,"elements":[{"xcors":[150,40,150,260],"ycors":[5,250,205,250],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"ewes":{"rotate":false,"elements":[{"xcors":[91,70,41,16,1,2,23,49,49,58,48,61,85,72,90,122,152,198,190,201,231,215,227,229,220,241,249,252,270,259,239,195,168,140,122],"ycors":[124,96,91,101,127,147,170,175,202,216,248,293,292,251,208,220,220,212,252,287,288,249,186,173,146,153,179,191,189,148,121,116,116,116,123],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[247,218,215,237],"ycors":[175,151,142,144],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[84,135,169,200,198,104,75],"ycors":[218,233,229,224,207,203,203],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[3,12,29,39,63],"ycors":[126,97,88,88,94],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[269,263,247,253],"ycors":[188,212,208,192],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"link":{"rotate":true,"elements":[{"x1":150,"y1":0,"x2":150,"y2":300,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"link direction":{"rotate":true,"elements":[{"x1":150,"y1":150,"x2":30,"y2":225,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":150,"y1":150,"x2":270,"y2":225,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"rams2":{"rotate":false,"elements":[{"xcors":[92,157,238,266,274,270,260,248,229,242,242,232,251,225,204,208,155,92,56,67,39,30,72,59,35,15,3,1,12,47,13,52,78,110,126,129,116,103,111,99,69,64,82,92,126,155,156],"ycors":[102,97,108,146,183,199,197,159,137,184,208,250,292,295,240,195,202,181,206,252,252,199,157,127,125,120,100,68,46,35,47,28,22,25,39,53,73,74,55,39,42,50,66,90,91,97,98],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[69,83,58,57],"ycors":[55,41,40,56],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"sheep":{"rotate":false,"elements":[{"xmin":90,"ymin":75,"xmax":270,"ymax":225,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":15,"y":75,"diam":150,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":81,"ymin":225,"xmax":134,"ymax":286,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":180,"ymin":225,"xmax":238,"ymax":285,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":1,"y":88,"diam":92,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":35,"ymin":108,"xmax":38,"ymax":119,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":75,"y":91,"diam":44,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":73,"y":98,"diam":108,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":19,"y":103,"diam":81,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":39,"y":81,"diam":64,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":29,"y":159,"diam":34,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":20,"y":147,"diam":24,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":44,"y":108,"diam":3,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":52,"y":120,"diam":3,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":0,"y":56,"diam":110,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":80,"ymin":227,"xmax":137,"ymax":289,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":181,"ymin":229,"xmax":240,"ymax":287,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":-2,"y":56,"diam":115,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"sheep2":{"rotate":false,"elements":[{"xmin":64,"ymin":116,"xmax":243,"ymax":214,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":244,"ymin":214,"xmax":244,"ymax":215,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":244,"ymin":215,"xmax":245,"ymax":216,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":91,"ymin":220,"xmax":127,"ymax":280,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":221,"xmax":224,"ymax":283,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":221,"xmax":189,"ymax":220,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":12,"y":65,"diam":105,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[129,195,257,246],"ycors":[116,105,124,175],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[258,271,264,251],"ycors":[128,193,195,157],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[58,90,94,76,59,63],"ycors":[69,72,111,118,110,84],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":false},{"xcors":[63,50,76],"ycors":[93,115,117],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":false},{"xcors":[224,190,191],"ycors":[219,218,225],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":190,"ymin":221,"xmax":225,"ymax":226,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":92,"ymin":220,"xmax":127,"ymax":225,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[250,253,264,276,274,257],"ycors":[164,196,198,195,159,128],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"wolf":{"rotate":false,"elements":[{"xmin":15,"ymin":105,"xmax":105,"ymax":165,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":45,"ymin":90,"xmax":105,"ymax":105,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[60,83,104],"ycors":[90,44,90],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[67,82,97],"ycors":[90,59,89],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":48,"ymin":93,"xmax":59,"ymax":105,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xmin":51,"ymin":96,"xmax":55,"ymax":101,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":0,"ymin":121,"xmax":15,"ymax":135,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":15,"ymin":136,"xmax":60,"ymax":151,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xcors":[15,23,31],"ycors":[136,149,136],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xcors":[30,37,43],"ycors":[151,136,151],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xmin":105,"ymin":120,"xmax":263,"ymax":195,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":108,"ymin":195,"xmax":259,"ymax":201,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":114,"ymin":201,"xmax":252,"ymax":210,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":120,"ymin":210,"xmax":243,"ymax":214,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":115,"ymin":114,"xmax":255,"ymax":120,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":128,"ymin":108,"xmax":248,"ymax":114,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":150,"ymin":105,"xmax":225,"ymax":108,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":132,"ymin":214,"xmax":155,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":110,"ymin":260,"xmax":132,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":210,"ymin":214,"xmax":232,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":260,"xmax":210,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x1":263,"y1":127,"x2":281,"y2":155,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":281,"y1":155,"x2":281,"y2":192,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]}}, {"default":{"direction-indicator":{"rotate":true,"elements":[{"x1":150,"y1":150,"x2":90,"y2":180,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":150,"y1":150,"x2":210,"y2":180,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"curviness":0.0,"lines":[{"x-offset":-0.2,"is-visible":false,"dash-pattern":[0.0,1.0]},{"x-offset":0.0,"is-visible":true,"dash-pattern":[1.0,0.0]},{"x-offset":0.2,"is-visible":false,"dash-pattern":[0.0,1.0]}]}});

var BreedManager  = workspace.breedManager;
var LayoutManager = workspace.layoutManager;
var LinkPrims     = workspace.linkPrims;
var ListPrims     = workspace.listPrims;
var MousePrims    = workspace.mousePrims;
var plotManager   = workspace.plotManager;
var Prims         = workspace.prims;
var PrintPrims    = workspace.printPrims;
var OutputPrims   = workspace.outputPrims;
var SelfPrims     = workspace.selfPrims;
var SelfManager   = workspace.selfManager;
var Updater       = workspace.updater;
var world         = workspace.world;

var Call           = tortoise_require('util/call');
var Exception      = tortoise_require('util/exception');
var NLMath         = tortoise_require('util/nlmath');
var notImplemented = tortoise_require('util/notimplemented');

var Dump      = tortoise_require('engine/dump');
var ColorModel = tortoise_require('engine/core/colormodel');
var Link      = tortoise_require('engine/core/link');
var LinkSet   = tortoise_require('engine/core/linkset');
var Nobody    = tortoise_require('engine/core/nobody');
var PatchSet  = tortoise_require('engine/core/patchset');
var Turtle    = tortoise_require('engine/core/turtle');
var TurtleSet = tortoise_require('engine/core/turtleset');
var NLType    = tortoise_require('engine/core/typechecker');
var Tasks     = tortoise_require('engine/prim/tasks');

var AgentModel = tortoise_require('agentmodel');
var Meta       = tortoise_require('meta');
var Random     = tortoise_require('shim/random');
var StrictMath = tortoise_require('shim/strictmath');
function startup() {
  Call(setup);
}
function setup() {
  world.clearAll();
  world.observer.setGlobal("year", 0);
  world.observer.setGlobal("year-length", 12);
  world.patches().ask(function() {
    SelfPrims.setPatchVariable("pcolor", 55);
  }, true);
  if (world.observer.getGlobal("limited-grass?")) {
    world.patches().ask(function() {
      SelfPrims.setPatchVariable("countdown", Prims.random((101 - world.observer.getGlobal("grass-regrowth-rate"))));
      if (Prims.equality(Prims.random(2), 0)) {
        SelfPrims.setPatchVariable("pcolor", 35);
      }
    }, true);
  }
  world.patches().ask(function() {
    Call(createFences);
  }, true);
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("FEMALES").getBreedName(), "ewes")
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("MALES").getBreedName(), "rams2")
  world.turtleManager.createTurtles((world.observer.getGlobal("initial-number") / 2), "MALES").ask(function() {
    SelfPrims.setVariable("color", 9.9);
    SelfPrims.setVariable("size", 2.5);
    SelfPrims.setVariable("age", Prims.random(5));
    SelfPrims.setVariable("energy", Prims.random((2 * world.observer.getGlobal("gain-from-food"))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    for (var _index_1084_1090 = 0, _repeatcount_1084_1090 = StrictMath.floor(6); _index_1084_1090 < _repeatcount_1084_1090; _index_1084_1090++){
      if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
        SelfPrims.right(90);
        SelfPrims.fd(3);
      }
    }
  }, true);
  world.turtleManager.createTurtles((world.observer.getGlobal("initial-number") / 2), "FEMALES").ask(function() {
    SelfPrims.setVariable("color", 9.9);
    SelfPrims.setVariable("size", 2.5);
    SelfPrims.setVariable("age", Prims.random(5));
    SelfPrims.setVariable("energy", Prims.random((2 * world.observer.getGlobal("gain-from-food"))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
      SelfPrims.right(180);
      SelfPrims.fd(1);
    }
    for (var _index_1445_1451 = 0, _repeatcount_1445_1451 = StrictMath.floor(6); _index_1445_1451 < _repeatcount_1445_1451; _index_1445_1451++){
      if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
        SelfPrims.right(90);
        SelfPrims.fd(3);
      }
    }
  }, true);
  world.observer.setGlobal("avg-pop", world.observer.getGlobal("initial-number"));
  Call(doPlot);
}
function go() {
  for (var _index_1543_1549 = 0, _repeatcount_1543_1549 = StrictMath.floor(world.observer.getGlobal("year-length")); _index_1543_1549 < _repeatcount_1543_1549; _index_1543_1549++){
    world.turtleManager.turtlesOfBreed("MALES").ask(function() {
      Call(move);
      Call(eatGrass);
      Call(death);
    }, true);
    world.turtleManager.turtlesOfBreed("FEMALES").ask(function() {
      Call(move);
      Call(eatGrass);
      Call(death);
    }, true);
    if (world.observer.getGlobal("limited-grass?")) {
      world.patches().ask(function() {
        Call(growGrass);
      }, true);
    }
    notImplemented('display', undefined)();
  }
  world.turtleManager.turtlesOfBreed("MALES").ask(function() {
    SelfPrims.setVariable("age", (SelfPrims.getVariable("age") + 1));
  }, true);
  world.turtleManager.turtlesOfBreed("FEMALES").ask(function() {
    SelfPrims.setVariable("age", (SelfPrims.getVariable("age") + 1));
    if ((Prims.gt(SelfPrims.getVariable("age"), 1) && Prims.lte(SelfPrims.getVariable("age"), 6))) {
      Call(reproduce);
    }
  }, true);
  world.observer.setGlobal("year", (world.observer.getGlobal("year") + 1));
  Call(doPlot);
  if (!world.turtles().nonEmpty()) {
    throw new Exception.StopInterrupt;
  }
}
function move() {
  SelfPrims.right((Prims.randomFloat(50) - Prims.randomFloat(50)));
  SelfPrims.fd(1);
  if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
    SelfPrims.right(180);
    SelfPrims.fd(1);
  }
}
function eatGrass() {
  if (world.observer.getGlobal("limited-grass?")) {
    SelfPrims.setVariable("energy", (SelfPrims.getVariable("energy") - 1));
    if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 55)) {
      SelfPrims.setPatchVariable("pcolor", 35);
      SelfPrims.setVariable("energy", (SelfPrims.getVariable("energy") + world.observer.getGlobal("gain-from-food")));
    }
  }
}
function reproduce() {
  if (Prims.lt(Prims.random(100), world.observer.getGlobal("birthrate-%"))) {
    Call(breedAndBirth);
  }
}
function breedAndBirth() {
  if (Prims.gt(world.turtleManager.turtlesOfBreed("MALES").size(), 0)) {
    SelfPrims.hatch(1, "").ask(function() {
      SelfPrims.fd(10);
      SelfPrims.setVariable("age", 0);
      SelfPrims.setVariable("energy", 3);
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable("breed", world.turtleManager.turtlesOfBreed("MALES"));
      }
      else {
        SelfPrims.setVariable("breed", world.turtleManager.turtlesOfBreed("FEMALES"));
      }
    }, true);
  }
}
function death() {
  if (Prims.lt(SelfPrims.getVariable("energy"), 0)) {
    SelfPrims.die();
  }
  if (Prims.gt(SelfPrims.getVariable("age"), 6)) {
    SelfPrims.die();
  }
}
function growGrass() {
  if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 35)) {
    if (Prims.lte(SelfPrims.getPatchVariable("countdown"), 0)) {
      SelfPrims.setPatchVariable("pcolor", 55);
      SelfPrims.setPatchVariable("countdown", (102 - world.observer.getGlobal("grass-regrowth-rate")));
    }
    else {
      SelfPrims.setPatchVariable("countdown", (SelfPrims.getPatchVariable("countdown") - 1));
    }
  }
}
function reaper() {
  if (Prims.gt(world.turtles().size(), world.observer.getGlobal("number-removed"))) {
    ListPrims.nOf(world.observer.getGlobal("number-removed"), world.turtles()).ask(function() {
      SelfPrims.die();
    }, true);
  }
  else {
    world.turtles().ask(function() {
      SelfPrims.die();
    }, true);
  }
}
function createFences() {
  if (Prims.equality(NLMath.abs(SelfPrims.getPatchVariable("pxcor")), world.topology.maxPxcor)) {
    SelfPrims.setPatchVariable("pcolor", 15);
  }
  if (Prims.equality(NLMath.abs(SelfPrims.getPatchVariable("pycor")), world.topology.maxPycor)) {
    SelfPrims.setPatchVariable("pcolor", 15);
  }
}
function smooth() {
  world.observer.setGlobal("avg-pop", ((0.95 * world.observer.getGlobal("avg-pop")) + (0.05 * world.turtles().size())));
}
function doPlot() {
  Call(smooth);
  plotManager.setCurrentPlot("populations");
  plotManager.setCurrentPen("sheep");
  plotManager.plotValue(world.turtles().size());
  plotManager.setCurrentPen("grass");
  plotManager.plotValue((world.patches().agentFilter(function() {
    return Prims.equality(SelfPrims.getPatchVariable("pcolor"), 55);
  }).size() / 4));
}
world.observer.setGlobal("initial-number", 70);
world.observer.setGlobal("gain-from-food", 2);
world.observer.setGlobal("limited-grass?", true);
world.observer.setGlobal("grass-regrowth-rate", 80.5);
world.observer.setGlobal("number-removed", 30);
world.observer.setGlobal("birthrate-%", 100);
      session.startLoop()
    </script>
<script src='jquery-1.11.3.min.js' type='text/javascript'></script>
<script src='shutterbug-0.5.4.js' type='text/javascript'></script>
<script>
  Shutterbug.enable('body');
</script>
  </body>
</html>
