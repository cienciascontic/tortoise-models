



<html>
  <head>
<link rel="stylesheet" type="text/css" href="app.css" charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="app-custom.css" charset="utf-8"/>
  </head>
  <body>
    <div id="model-container"></div>
<script type="text/javascript" src="app.js"></script>
    <script type="text/javascript">
;

      var session =
        (function () {
          var widgets = [{"left":339,"top":10,"right":719,"bottom":411,"patchSize":10.0,"fontSize":14,"wrappingAllowedInX":true,"wrappingAllowedInY":true,"minPxcor":-18,"maxPxcor":18,"minPycor":-18,"maxPycor":18,"updateMode":"Continuous","showTickCounter":true,"tickCounterLabel":"ticks","frameRate":30.0,"type":"view"},{"display":"initial-number-sheep","left":165,"top":10,"right":322,"bottom":43,"varName":"initial-number-sheep","min":"0","max":"250","default":100.0,"step":"1","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"250"},"compiledStep":{"success":true,"result":"1"}},{"display":"grass-regrowth-rate","left":165,"top":44,"right":323,"bottom":77,"varName":"grass-regrowth-rate","min":"5","max":"95","default":80.0,"step":"5","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"5"},"compiledMax":{"success":true,"result":"95"},"compiledStep":{"success":true,"result":"5"}},{"display":"setup","left":22,"top":10,"right":91,"bottom":43,"source":"setup","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(setup);"}},{"display":"run once","left":20,"top":89,"right":107,"bottom":122,"source":"go","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"populations","left":8,"top":333,"right":317,"bottom":593,"xAxis":"time","yAxis":"pop.","xmin":0.0,"xmax":20.0,"ymin":0.0,"ymax":100.0,"autoPlotOn":true,"legendOn":true,"setupCode":"","updateCode":"","pens":[{"display":"white sheep","interval":1.0,"mode":0,"color":-16777216,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"grass","interval":1.0,"mode":0,"color":-10899396,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"blue mutation","interval":1.0,"mode":0,"color":-11221820,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}}],"type":"plot","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"white sheep","left":64,"top":275,"right":141,"bottom":320,"source":"count turtles with [color = white]","precision":1,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.turtles().agentFilter(function() {\n  return Prims.equality(SelfPrims.getVariable(\"color\"), 9.9);\n}).size()"}},{"display":"year","left":5,"top":275,"right":55,"bottom":320,"source":"year","precision":0,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.observer.getGlobal(\"year\")"}},{"display":"run/stop","left":18,"top":50,"right":106,"bottom":83,"source":"go","forever":true,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"selection?","left":189,"top":91,"right":307,"bottom":124,"varName":"selection?","on":true,"type":"switch"},{"display":"blue sheep","left":152,"top":277,"right":222,"bottom":322,"source":"count turtles with [color = cyan]","precision":2,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.turtles().agentFilter(function() {\n  return Prims.equality(SelfPrims.getVariable(\"color\"), 85);\n}).size()"}},{"display":"if selection? is ON, blue sheep get much more energy from grass","left":190,"top":131,"right":340,"bottom":187,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"add mutants","left":22,"top":153,"right":131,"bottom":186,"source":"add-mutants","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(addMutants);"}},{"display":"number-added","left":20,"top":191,"right":136,"bottom":224,"varName":"number-added","min":"0","max":"20","default":9.0,"step":"1","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"20"},"compiledStep":{"success":true,"result":"1"}},{"display":"adds blue sheep","left":33,"top":231,"right":151,"bottom":252,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"CC--cC--cc","left":346,"top":423,"right":506,"bottom":593,"xAxis":null,"yAxis":null,"xmin":0.0,"xmax":100.0,"ymin":0.0,"ymax":100.0,"autoPlotOn":true,"legendOn":false,"setupCode":"","updateCode":"","pens":[{"display":"default","interval":1.0,"mode":1,"color":-16777216,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}}],"type":"plot","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"Only cc has better teeth","left":537,"top":507,"right":627,"bottom":535,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"fussyfemales?","left":179,"top":189,"right":308,"bottom":222,"varName":"fussyfemales?","on":false,"type":"switch"},{"display":"fussy females won't mate with blue males","left":178,"top":227,"right":317,"bottom":255,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"}];
          var code    = "globals [ year   year-length  fence? teeth-avg gain-from-food ]\nbreed [ males ]\nbreed [ females ]\n\nturtles-own [ energy  teeth  age   geneA geneB geneC geneD   ]   \n    ;; A and B are the two chromosomes that have the teeth allele on them.\n    ;; C and D are the two chromosomes with the cyan allele on them.         \npatches-own [ countdown ]\n  \nto startup\nsetup\nend\n\nto setup \n  ;; (for this model to work with NetLogo's new plotting features,\n  ;; __clear-all-and-reset-ticks should be replaced with clear-all at\n  ;; the beginning of your setup procedure and reset-ticks at the end\n  ;; of the procedure.)\n  clear-all\n  set year 0\n  set year-length 12\n  set gain-from-food 2\n  ask patches [ set pcolor green ]\n  set fence? false    ;;this is not in use  \n    ask patches [\n      set countdown random (101 - grass-regrowth-rate) ;; initialize grass grow clocks randomly\n      if (random 2) = 0  ;;half the patches start out with grass\n          [ set pcolor brown ]\n    ]\n    ask patches [create-fences]\n    \n  set-default-shape females \"ewes\"\n  set-default-shape males \"rams2\"\n  create-males (initial-number-sheep / 2)  ;; create the males, then initialize their variables\n  [ \n    set color white\n    set size 2.5\n    set age random 5\n    set energy random (2 * gain-from-food)\n    setxy random-float world-width\n          random-float world-height\n    repeat 6 [if pcolor = red [rt 90 fd 3 ]]\n;;set each gene to 0 or 1, randomly \n    set geneA random 2\n    set geneB random 2\n    set geneC 0 ;;random 2\n    set geneD  0 ;; random 2\n  ] \n  \n    create-females (initial-number-sheep / 2)  ;; create the females, then initialize their variables\n  [ \n    set color white\n    set size 2.5\n    set age random 5\n    set energy random (2 * gain-from-food)\n    setxy random-float world-width\n          random-float world-height\n    if pcolor = red [rt 180 fd 1] \n    repeat 6 [if pcolor = red [rt 90 fd 3 ]]\n;;set each gene to 0 or 1, randomly \n    set geneA random 2\n    set geneB random 2\n    set geneC  0 ;;random 2\n    set geneD 0 ;;random 2\n]  \n\n\n;; geneA and geneB arene't expressed in this model\n  ask turtles [ \n      if (geneA + geneB = 2)   [set teeth 1.0]   ;; TT condition\n      if (geneA + geneB = 1)   [set teeth 1.0]   ;; tT and Tt condition\n      if (geneA + geneB = 0)   [set teeth 1.0]   ;; tt condition\n\n      ]\n  ;;display-labels\n  set teeth-avg (sum [teeth] of turtles) / count turtles\n  setup-histogram\n  do-plot\n  reset-ticks\nend\n\nto go\n   ask patches [\n      if pxcor = 0 and (abs pycor  < max-pycor)\n         [if fence?  [set pcolor red] ]    \n        ]\n        \n  ;; make CD very favorable -- regardless of what geneA and geneB are\n    ask turtles [if color = cyan [set teeth 2]]\n \n  repeat year-length [\n  ask males [\n        move\n        eat-grass\n        death\n        ] \n  \n    ask females [\n        move\n        eat-grass \n        death\n        ]\n        \n    ask patches [ grow-grass ] \n    display\n    ] \n    \n    ask males  [ \n      set age age + 1\n    ]\n    \n    ask females [\n      set age age + 1 \n      if age > 1 and age <= 6 [reproduce]\n    ]\n   ;; if auto-reap?  [reaper]\n    set year year + 1\n    if count turtles >  0 [set teeth-avg (sum [teeth] of turtles) / count turtles]\n    do-plot  ;; plot populations\n \n   ;;express the mutation CD (not Cd,cD, or cd) as changing colo\n    ask turtles [    \n     if (geneC + geneD = 2) \n       [set color cyan]  \n       ]\n ;;   ask turtles [set size (teeth * 2)]\n  if not any? turtles [ stop ]\nend\n\nto move  ;; turtle procedure\n  rt random-float 50 - random-float 50\n  fd 1\n  if pcolor = red [rt 180 fd 1] \nend\n\nto eat-grass  ;; turtle procedure\n  ;; sheep eat grass, turn the patch brown\n      set energy energy - 1 ;; deduct energy for sheep only if grass? switch is on\n      \n    if pcolor = green [ \n      set pcolor brown \n      ifelse selection? ;;no selection pressure on teeth if selection? = false\n        [set energy energy + (gain-from-food * teeth) ] ;; sheep gain more energy if they have better teeth\n        [set energy energy + (gain-from-food * 1) ] ;; all sheep gain the same energy\n      ]\nend\n\nto reproduce\n    breed-and-birth  ;; females mate with any ram in the whole field  \nend\n\nto breed-and-birth ;; turtle procedure\n  if count males with [color = white] > 0  [   ;; use this to prevent a runtime error if the population is near to extinction\n    hatch 1 [\n    fd 10\n    set age 0\n    set energy 3\n    ifelse (random 2 = 1) \n      [set breed males ] \n      [set breed females ]\n; \n; ;; geneA and geneB match the mother's by default. Choose baby's geneC to match one\n; ;; of mother's genes.\n\n     ifelse (random 2 = 1) ;;\n      [set geneC geneC ];; same as mother's first chromosome\n      [set geneC geneD];; same as mother's second chromosome\n  \n;;;; set geneD to match one of father's genes.\n\n  ifelse fussyfemales? = true \n    [ifelse (random 2 = 1)\n      [set geneD [geneC] of (one-of males with [color = white ])]\n      [set geneD [geneD] of (one-of males with [color = white ])]\n    ]\n   [ifelse (random 2 = 1)\n      [set geneD [geneC] of (one-of males )]\n      [set geneD [geneD] of (one-of males )]\n    ]\n;;express the gene CD -- better teeth are recessive\n     if (geneC + geneD = 2)   [set teeth 2.0]   ;; cc condition\n     if (geneC + geneD = 1)   [set teeth 1.0]   ;; cC condition\n     if (geneC + geneD = 0)   [set teeth 1.0]   ;; CC condition\n     ifelse (geneC + geneD = 2)\n      [set color cyan]\n      [set color white]\n\n   \n;      \n;  ;; T is dominant for better teeth\n;      if (geneA + geneB = 2)   [set teeth 1.0]   ;; TT condition\n;      if (geneA + geneB = 1)   [set teeth 1.0]   ;; tT and Tt condition\n;      if (geneA + geneB = 0)   [set teeth 1.0]   ;; tt condition\n     ] \n  ] \nend\n\nto add-mutants\n  crt  number-added [\n    ifelse (random 2 = 0) \n      [set breed females]\n      [set breed males]\n    set color cyan\n    set size 2.5\n    set age 2\n    set energy random (2 * gain-from-food)\n    setxy random-float world-width\n          random-float world-height\n    if pcolor = red [ fd 3 ]\n    set geneA random 2\n    set geneB random 2\n    set geneC 1\n    set geneD 1\n    ]\n end\n \nto death  ;; turtle procedure\n  ;; when energy dips below zero, or sheep gets old, die\n  if energy < 0 [ die ] \n  if age > 6 [die ]\nend\n\nto grow-grass  ;; patch procedure\n  ;; countdown on brown patches, if reach 0, grow some grass\n  if pcolor = brown [ \n    ifelse countdown <= 0\n      [ set pcolor green\n        set countdown (102 - grass-regrowth-rate) ] \n      [ set countdown (countdown - 1) ] \n  ] \nend\n\n\nto create-fences; patch procedure\nif (abs pxcor) = max-pxcor   [set pcolor red]\nif (abs pycor) = max-pycor [set pcolor red]\nif pxcor = 0 and fence? [set pcolor red]\nend\n\nto setup-histogram\n  set-current-plot \"cc--cC--CC\"\n  set-plot-x-range -.5  2.5\n  set-plot-y-range 0 initial-number-sheep\n  set-histogram-num-bars 3\nend\n\nto do-plot \n  set-current-plot \"populations\"\n  set-current-plot-pen \"white sheep\" \n    plot (count turtles with [color = white])\n \n  ;; divide by four to keep it within similar range as sheep populations                                         \n;  set-current-plot-pen \"grass\"\n ;   plot (count patches with [pcolor = green]) / 4\n  set-current-plot-pen \"blue mutation\"\n    plot count turtles with [color = cyan]\n   \n set-current-plot \"cc--cC--CC\"\n  histogram [(geneC + geneD)] of  turtles\nend\n";
          var info    = "\n		Evolution:  Sheep-fussyfemales\n This is a model of a flock of sheep whose survival depends on eating grass. The babies inherit traits from their parents according to Mendelian genetics. One can watch the spread of a mutation and how it depends on selection pressure. There are two such pressures here: the energy sheep get from grass, and the fact that females will not breed with mutated sheep.\n\nHere are are some explorations:  \n1. Picture yourself as a farmer with a large field of sheep. You start with an equal number of males (horns) and females (no horns). They live for six years. The sheep move around the field and eat grass, which grows back at a certain rate. The patch is green if there is grass there, and brown if there is no grass. In the model, the sheep move and eat during each year. They use up energy as they move, and they gain energy from eating grass. If their energy goes to zero, they die. \n\n2. Once a year, from age 3 to age 6, each female mates with a randomly chosen male and gives birth to a baby. The baby inherits its TEETH trait from both its parents. \n\n3. In this version, all of the sheep have standard teeth. There are two new   \nfeatures, one a pressure in favor of the muation, and one opposing it:  \na. An ADD MUTANTS button. When you hit this button, some blue sheep are added to the herd. Sheep pass their color gene on to their offspring.   \nb. A FUSSYFEMALES button. When you hit this button, females refuse to mate with blue (mutated) males.\n\n4. If SELECTION? = ON, a blue sheep gets twice as much energy from grass as a regular sheep. If SELECTION? = OFF, the blue color has no effect on its eating or how likely it is to survive and have offspring.\n\n5. Try the model with SELECTION? on or off, and FUSSYFEMALES? on or off. Run the model, add at least 15 mutants, and fill in the following table. \n\nCondition			What happens\n\n## SELECTION? = OFF\n\nFUSSYFEMALES? = ON\n	  \n## SELECTION? = ON\n\nFUSSYFEMALES? = OFF\n	  \n## SELECTION? = ON\n\nFUSSYFEMALES? = ON\n	";
          return Tortoise.fromCompiledModel('#model-container', widgets, code, info, '', true);
        })();
      var modelConfig  = (typeof window.modelConfig !== "undefined" && window.modelConfig !== null) ? window.modelConfig : {};
var modelPlotOps = (typeof modelConfig.plotOps !== "undefined" && modelConfig.plotOps !== null) ? modelConfig.plotOps : {};

var PenBundle = tortoise_require('engine/plot/pen');
var Plot      = tortoise_require('engine/plot/plot');
var PlotOps   = tortoise_require('engine/plot/plotops');

modelConfig.plots = [(function() {
  var name    = 'populations';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('white sheep', plotOps.makePenOps, false, new PenBundle.State(0.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'white sheep')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'white sheep')(function() {}); }); }),
new PenBundle.Pen('grass', plotOps.makePenOps, false, new PenBundle.State(55.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'grass')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'grass')(function() {}); }); }),
new PenBundle.Pen('blue mutation', plotOps.makePenOps, false, new PenBundle.State(85.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'blue mutation')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'blue mutation')(function() {}); }); })];
  var setup   = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', undefined)(function() {}); }); };
  var update  = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', undefined)(function() {}); }); };
  return new Plot(name, pens, plotOps, 'time', 'pop.', true, 0.0, 20.0, 0.0, 100.0, setup, update);
})(), (function() {
  var name    = 'CC--cC--cc';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('default', plotOps.makePenOps, false, new PenBundle.State(0.0, 1.0, PenBundle.DisplayMode.Bar), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('CC--cC--cc', 'default')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('CC--cC--cc', 'default')(function() {}); }); })];
  var setup   = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('CC--cC--cc', undefined)(function() {}); }); };
  var update  = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('CC--cC--cc', undefined)(function() {}); }); };
  return new Plot(name, pens, plotOps, '', '', false, 0.0, 100.0, 0.0, 100.0, setup, update);
})()];
if (typeof javax !== "undefined") { modelConfig.output = { clear: function(){}, write: function(str) { context.getWriter().print(str); } } }

var workspace = tortoise_require('engine/workspace')(modelConfig)([{ name: "MALES", singular: "turtle", varNames: [] }, { name: "FEMALES", singular: "turtle", varNames: [] }])(["energy", "teeth", "age", "genea", "geneb", "genec", "gened"], [])(["initial-number-sheep", "grass-regrowth-rate", "selection?", "number-added", "fussyfemales?", "year", "year-length", "fence?", "teeth-avg", "gain-from-food"], ["initial-number-sheep", "grass-regrowth-rate", "selection?", "number-added", "fussyfemales?"], ["countdown"], -18, 18, -18, 18, 10.0, true, true, {"default":{"rotate":true,"elements":[{"xcors":[150,40,150,260],"ycors":[5,250,205,250],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"ewes":{"rotate":false,"elements":[{"xcors":[91,70,41,16,1,2,23,49,49,58,48,61,85,72,90,122,152,198,190,201,231,215,227,229,220,241,249,252,270,259,239,195,168,140,122],"ycors":[124,96,91,101,127,147,170,175,202,216,248,293,292,251,208,220,220,212,252,287,288,249,186,173,146,153,179,191,189,148,121,116,116,116,123],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[247,218,215,237],"ycors":[175,151,142,144],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[84,135,169,200,198,104,75],"ycors":[218,233,229,224,207,203,203],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[3,12,29,39,63],"ycors":[126,97,88,88,94],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[269,263,247,253],"ycors":[188,212,208,192],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"rams2":{"rotate":false,"elements":[{"xcors":[92,157,238,266,274,270,260,248,229,242,242,232,251,225,204,208,155,92,56,67,39,30,72,59,35,15,3,1,12,47,13,52,78,110,126,129,116,103,111,99,69,64,82,92,126,155,156],"ycors":[102,97,108,146,183,199,197,159,137,184,208,250,292,295,240,195,202,181,206,252,252,199,157,127,125,120,100,68,46,35,47,28,22,25,39,53,73,74,55,39,42,50,66,90,91,97,98],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[69,83,58,57],"ycors":[55,41,40,56],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"sheep":{"rotate":false,"elements":[{"xmin":90,"ymin":75,"xmax":270,"ymax":225,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":15,"y":75,"diam":150,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":81,"ymin":225,"xmax":134,"ymax":286,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":180,"ymin":225,"xmax":238,"ymax":285,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":1,"y":88,"diam":92,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"wolf":{"rotate":false,"elements":[{"xmin":15,"ymin":105,"xmax":105,"ymax":165,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":45,"ymin":90,"xmax":105,"ymax":105,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[60,83,104],"ycors":[90,44,90],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[67,82,97],"ycors":[90,59,89],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":48,"ymin":93,"xmax":59,"ymax":105,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xmin":51,"ymin":96,"xmax":55,"ymax":101,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":0,"ymin":121,"xmax":15,"ymax":135,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":15,"ymin":136,"xmax":60,"ymax":151,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xcors":[15,23,31],"ycors":[136,149,136],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xcors":[30,37,43],"ycors":[151,136,151],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xmin":105,"ymin":120,"xmax":263,"ymax":195,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":108,"ymin":195,"xmax":259,"ymax":201,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":114,"ymin":201,"xmax":252,"ymax":210,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":120,"ymin":210,"xmax":243,"ymax":214,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":115,"ymin":114,"xmax":255,"ymax":120,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":128,"ymin":108,"xmax":248,"ymax":114,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":150,"ymin":105,"xmax":225,"ymax":108,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":132,"ymin":214,"xmax":155,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":110,"ymin":260,"xmax":132,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":210,"ymin":214,"xmax":232,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":260,"xmax":210,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x1":263,"y1":127,"x2":281,"y2":155,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":281,"y1":155,"x2":281,"y2":192,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]}}, {"default":{"direction-indicator":{"rotate":true,"elements":[{"x1":150,"y1":150,"x2":90,"y2":180,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":150,"y1":150,"x2":210,"y2":180,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"curviness":0.0,"lines":[{"x-offset":-0.2,"is-visible":false,"dash-pattern":[0.0,1.0]},{"x-offset":0.0,"is-visible":true,"dash-pattern":[1.0,0.0]},{"x-offset":0.2,"is-visible":false,"dash-pattern":[0.0,1.0]}]}});

var BreedManager  = workspace.breedManager;
var LayoutManager = workspace.layoutManager;
var LinkPrims     = workspace.linkPrims;
var ListPrims     = workspace.listPrims;
var MousePrims    = workspace.mousePrims;
var plotManager   = workspace.plotManager;
var Prims         = workspace.prims;
var PrintPrims    = workspace.printPrims;
var OutputPrims   = workspace.outputPrims;
var SelfPrims     = workspace.selfPrims;
var SelfManager   = workspace.selfManager;
var Updater       = workspace.updater;
var world         = workspace.world;

var Call           = tortoise_require('util/call');
var Exception      = tortoise_require('util/exception');
var NLMath         = tortoise_require('util/nlmath');
var notImplemented = tortoise_require('util/notimplemented');

var Dump      = tortoise_require('engine/dump');
var ColorModel = tortoise_require('engine/core/colormodel');
var Link      = tortoise_require('engine/core/link');
var LinkSet   = tortoise_require('engine/core/linkset');
var Nobody    = tortoise_require('engine/core/nobody');
var PatchSet  = tortoise_require('engine/core/patchset');
var Turtle    = tortoise_require('engine/core/turtle');
var TurtleSet = tortoise_require('engine/core/turtleset');
var NLType    = tortoise_require('engine/core/typechecker');
var Tasks     = tortoise_require('engine/prim/tasks');

var AgentModel = tortoise_require('agentmodel');
var Meta       = tortoise_require('meta');
var Random     = tortoise_require('shim/random');
var StrictMath = tortoise_require('shim/strictmath');
function startup() {
  Call(setup);
}
function setup() {
  world.clearAll();
  world.observer.setGlobal("year", 0);
  world.observer.setGlobal("year-length", 12);
  world.observer.setGlobal("gain-from-food", 2);
  world.patches().ask(function() {
    SelfPrims.setPatchVariable("pcolor", 55);
  }, true);
  world.observer.setGlobal("fence?", false);
  world.patches().ask(function() {
    SelfPrims.setPatchVariable("countdown", Prims.random((101 - world.observer.getGlobal("grass-regrowth-rate"))));
    if (Prims.equality(Prims.random(2), 0)) {
      SelfPrims.setPatchVariable("pcolor", 35);
    }
  }, true);
  world.patches().ask(function() {
    Call(createFences);
  }, true);
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("FEMALES").getBreedName(), "ewes")
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("MALES").getBreedName(), "rams2")
  world.turtleManager.createTurtles((world.observer.getGlobal("initial-number-sheep") / 2), "MALES").ask(function() {
    SelfPrims.setVariable("color", 9.9);
    SelfPrims.setVariable("size", 2.5);
    SelfPrims.setVariable("age", Prims.random(5));
    SelfPrims.setVariable("energy", Prims.random((2 * world.observer.getGlobal("gain-from-food"))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    for (var _index_1358_1364 = 0, _repeatcount_1358_1364 = StrictMath.floor(6); _index_1358_1364 < _repeatcount_1358_1364; _index_1358_1364++){
      if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
        SelfPrims.right(90);
        SelfPrims.fd(3);
      }
    }
    SelfPrims.setVariable("genea", Prims.random(2));
    SelfPrims.setVariable("geneb", Prims.random(2));
    SelfPrims.setVariable("genec", 0);
    SelfPrims.setVariable("gened", 0);
  }, true);
  world.turtleManager.createTurtles((world.observer.getGlobal("initial-number-sheep") / 2), "FEMALES").ask(function() {
    SelfPrims.setVariable("color", 9.9);
    SelfPrims.setVariable("size", 2.5);
    SelfPrims.setVariable("age", Prims.random(5));
    SelfPrims.setVariable("energy", Prims.random((2 * world.observer.getGlobal("gain-from-food"))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
      SelfPrims.right(180);
      SelfPrims.fd(1);
    }
    for (var _index_1864_1870 = 0, _repeatcount_1864_1870 = StrictMath.floor(6); _index_1864_1870 < _repeatcount_1864_1870; _index_1864_1870++){
      if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
        SelfPrims.right(90);
        SelfPrims.fd(3);
      }
    }
    SelfPrims.setVariable("genea", Prims.random(2));
    SelfPrims.setVariable("geneb", Prims.random(2));
    SelfPrims.setVariable("genec", 0);
    SelfPrims.setVariable("gened", 0);
  }, true);
  world.turtles().ask(function() {
    if (Prims.equality((SelfPrims.getVariable("genea") + SelfPrims.getVariable("geneb")), 2)) {
      SelfPrims.setVariable("teeth", 1);
    }
    if (Prims.equality((SelfPrims.getVariable("genea") + SelfPrims.getVariable("geneb")), 1)) {
      SelfPrims.setVariable("teeth", 1);
    }
    if (Prims.equality((SelfPrims.getVariable("genea") + SelfPrims.getVariable("geneb")), 0)) {
      SelfPrims.setVariable("teeth", 1);
    }
  }, true);
  world.observer.setGlobal("teeth-avg", (ListPrims.sum(world.turtles().projectionBy(function() {
    return SelfPrims.getVariable("teeth");
  })) / world.turtles().size()));
  Call(setupHistogram);
  Call(doPlot);
  world.ticker.reset();
}
function go() {
  world.patches().ask(function() {
    if ((Prims.equality(SelfPrims.getPatchVariable("pxcor"), 0) && Prims.lt(NLMath.abs(SelfPrims.getPatchVariable("pycor")), world.topology.maxPycor))) {
      if (world.observer.getGlobal("fence?")) {
        SelfPrims.setPatchVariable("pcolor", 15);
      }
    }
  }, true);
  world.turtles().ask(function() {
    if (Prims.equality(SelfPrims.getVariable("color"), 85)) {
      SelfPrims.setVariable("teeth", 2);
    }
  }, true);
  for (var _index_2707_2713 = 0, _repeatcount_2707_2713 = StrictMath.floor(world.observer.getGlobal("year-length")); _index_2707_2713 < _repeatcount_2707_2713; _index_2707_2713++){
    world.turtleManager.turtlesOfBreed("MALES").ask(function() {
      Call(move);
      Call(eatGrass);
      Call(death);
    }, true);
    world.turtleManager.turtlesOfBreed("FEMALES").ask(function() {
      Call(move);
      Call(eatGrass);
      Call(death);
    }, true);
    world.patches().ask(function() {
      Call(growGrass);
    }, true);
    notImplemented('display', undefined)();
  }
  world.turtleManager.turtlesOfBreed("MALES").ask(function() {
    SelfPrims.setVariable("age", (SelfPrims.getVariable("age") + 1));
  }, true);
  world.turtleManager.turtlesOfBreed("FEMALES").ask(function() {
    SelfPrims.setVariable("age", (SelfPrims.getVariable("age") + 1));
    if ((Prims.gt(SelfPrims.getVariable("age"), 1) && Prims.lte(SelfPrims.getVariable("age"), 6))) {
      Call(reproduce);
    }
  }, true);
  world.observer.setGlobal("year", (world.observer.getGlobal("year") + 1));
  if (Prims.gt(world.turtles().size(), 0)) {
    world.observer.setGlobal("teeth-avg", (ListPrims.sum(world.turtles().projectionBy(function() {
      return SelfPrims.getVariable("teeth");
    })) / world.turtles().size()));
  }
  Call(doPlot);
  world.turtles().ask(function() {
    if (Prims.equality((SelfPrims.getVariable("genec") + SelfPrims.getVariable("gened")), 2)) {
      SelfPrims.setVariable("color", 85);
    }
  }, true);
  if (!world.turtles().nonEmpty()) {
    throw new Exception.StopInterrupt;
  }
}
function move() {
  SelfPrims.right((Prims.randomFloat(50) - Prims.randomFloat(50)));
  SelfPrims.fd(1);
  if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
    SelfPrims.right(180);
    SelfPrims.fd(1);
  }
}
function eatGrass() {
  SelfPrims.setVariable("energy", (SelfPrims.getVariable("energy") - 1));
  if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 55)) {
    SelfPrims.setPatchVariable("pcolor", 35);
    if (world.observer.getGlobal("selection?")) {
      SelfPrims.setVariable("energy", (SelfPrims.getVariable("energy") + (world.observer.getGlobal("gain-from-food") * SelfPrims.getVariable("teeth"))));
    }
    else {
      SelfPrims.setVariable("energy", (SelfPrims.getVariable("energy") + (world.observer.getGlobal("gain-from-food") * 1)));
    }
  }
}
function reproduce() {
  Call(breedAndBirth);
}
function breedAndBirth() {
  if (Prims.gt(world.turtleManager.turtlesOfBreed("MALES").agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable("color"), 9.9);
  }).size(), 0)) {
    SelfPrims.hatch(1, "").ask(function() {
      SelfPrims.fd(10);
      SelfPrims.setVariable("age", 0);
      SelfPrims.setVariable("energy", 3);
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable("breed", world.turtleManager.turtlesOfBreed("MALES"));
      }
      else {
        SelfPrims.setVariable("breed", world.turtleManager.turtlesOfBreed("FEMALES"));
      }
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable("genec", SelfPrims.getVariable("genec"));
      }
      else {
        SelfPrims.setVariable("genec", SelfPrims.getVariable("gened"));
      }
      if (Prims.equality(world.observer.getGlobal("fussyfemales?"), true)) {
        if (Prims.equality(Prims.random(2), 1)) {
          SelfPrims.setVariable("gened", ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES").agentFilter(function() {
            return Prims.equality(SelfPrims.getVariable("color"), 9.9);
          })).projectionBy(function() {
            return SelfPrims.getVariable("genec");
          }));
        }
        else {
          SelfPrims.setVariable("gened", ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES").agentFilter(function() {
            return Prims.equality(SelfPrims.getVariable("color"), 9.9);
          })).projectionBy(function() {
            return SelfPrims.getVariable("gened");
          }));
        }
      }
      else {
        if (Prims.equality(Prims.random(2), 1)) {
          SelfPrims.setVariable("gened", ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES")).projectionBy(function() {
            return SelfPrims.getVariable("genec");
          }));
        }
        else {
          SelfPrims.setVariable("gened", ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES")).projectionBy(function() {
            return SelfPrims.getVariable("gened");
          }));
        }
      }
      if (Prims.equality((SelfPrims.getVariable("genec") + SelfPrims.getVariable("gened")), 2)) {
        SelfPrims.setVariable("teeth", 2);
      }
      if (Prims.equality((SelfPrims.getVariable("genec") + SelfPrims.getVariable("gened")), 1)) {
        SelfPrims.setVariable("teeth", 1);
      }
      if (Prims.equality((SelfPrims.getVariable("genec") + SelfPrims.getVariable("gened")), 0)) {
        SelfPrims.setVariable("teeth", 1);
      }
      if (Prims.equality((SelfPrims.getVariable("genec") + SelfPrims.getVariable("gened")), 2)) {
        SelfPrims.setVariable("color", 85);
      }
      else {
        SelfPrims.setVariable("color", 9.9);
      }
    }, true);
  }
}
function addMutants() {
  world.turtleManager.createTurtles(world.observer.getGlobal("number-added"), "").ask(function() {
    if (Prims.equality(Prims.random(2), 0)) {
      SelfPrims.setVariable("breed", world.turtleManager.turtlesOfBreed("FEMALES"));
    }
    else {
      SelfPrims.setVariable("breed", world.turtleManager.turtlesOfBreed("MALES"));
    }
    SelfPrims.setVariable("color", 85);
    SelfPrims.setVariable("size", 2.5);
    SelfPrims.setVariable("age", 2);
    SelfPrims.setVariable("energy", Prims.random((2 * world.observer.getGlobal("gain-from-food"))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
      SelfPrims.fd(3);
    }
    SelfPrims.setVariable("genea", Prims.random(2));
    SelfPrims.setVariable("geneb", Prims.random(2));
    SelfPrims.setVariable("genec", 1);
    SelfPrims.setVariable("gened", 1);
  }, true);
}
function death() {
  if (Prims.lt(SelfPrims.getVariable("energy"), 0)) {
    SelfPrims.die();
  }
  if (Prims.gt(SelfPrims.getVariable("age"), 6)) {
    SelfPrims.die();
  }
}
function growGrass() {
  if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 35)) {
    if (Prims.lte(SelfPrims.getPatchVariable("countdown"), 0)) {
      SelfPrims.setPatchVariable("pcolor", 55);
      SelfPrims.setPatchVariable("countdown", (102 - world.observer.getGlobal("grass-regrowth-rate")));
    }
    else {
      SelfPrims.setPatchVariable("countdown", (SelfPrims.getPatchVariable("countdown") - 1));
    }
  }
}
function createFences() {
  if (Prims.equality(NLMath.abs(SelfPrims.getPatchVariable("pxcor")), world.topology.maxPxcor)) {
    SelfPrims.setPatchVariable("pcolor", 15);
  }
  if (Prims.equality(NLMath.abs(SelfPrims.getPatchVariable("pycor")), world.topology.maxPycor)) {
    SelfPrims.setPatchVariable("pcolor", 15);
  }
  if ((Prims.equality(SelfPrims.getPatchVariable("pxcor"), 0) && world.observer.getGlobal("fence?"))) {
    SelfPrims.setPatchVariable("pcolor", 15);
  }
}
function setupHistogram() {
  plotManager.setCurrentPlot("cc--cC--CC");
  plotManager.setXRange(-0.5, 2.5);
  plotManager.setYRange(0, world.observer.getGlobal("initial-number-sheep"));
  plotManager.setHistogramBarCount(3);
}
function doPlot() {
  plotManager.setCurrentPlot("populations");
  plotManager.setCurrentPen("white sheep");
  plotManager.plotValue(world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable("color"), 9.9);
  }).size());
  plotManager.setCurrentPen("blue mutation");
  plotManager.plotValue(world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable("color"), 85);
  }).size());
  plotManager.setCurrentPlot("cc--cC--CC");
  plotManager.drawHistogramFrom(world.turtles().projectionBy(function() {
    return (SelfPrims.getVariable("genec") + SelfPrims.getVariable("gened"));
  }));
}
world.observer.setGlobal("initial-number-sheep", 100);
world.observer.setGlobal("grass-regrowth-rate", 80);
world.observer.setGlobal("selection?", true);
world.observer.setGlobal("number-added", 9);
world.observer.setGlobal("fussyfemales?", false);
      session.startLoop()
    </script>
<script src='jquery-1.11.3.min.js' type='text/javascript'></script>
<script src='shutterbug-0.5.4.js' type='text/javascript'></script>
<script>
  Shutterbug.enable('body');
</script>
  </body>
</html>
