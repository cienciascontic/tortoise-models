
<!-- saved from url=(0050)http://li425-91.members.linode.com:9000/save-nlogo -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="app.css" charset="utf-8"/>
  </head>
  <body data-feedly-mini="yes">
    <div id="model-container"><div class="netlogo-model" style="width: 719;"><div class="netlogo-header"><label class="netlogo-widget netlogo-speed-slider"><span class="netlogo-label">speed</span> <input type="range" min="-1" max="1" step="0.01"></label> <div class="netlogo-powered-by"><a href="http://ccl.northwestern.edu/netlogo/"><img style="vertical-align: middle;" alt="NetLogo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAANcSURBVHjarJRdaFxFFMd/M/dj7252uxubKms+bGprVyIVbNMWWqkQqtLUSpQWfSiV+oVFTcE3DeiDgvoiUSiCYLH2oVoLtQ+iaaIWWtE2FKGkkSrkq5svN+sm7ma/7p3x4W42lEbjQw8MM8yc87/nzPnNFVprbqWJXyMyXuMqx1Ni6N3ny3cX8tOHNLoBUMvESoFI2Xbs4zeO1lzREpSrMSNS1zkBDv6uo1/noz1H7mpvS4SjprAl2AZYEqzKbEowBAgBAkjPKX2599JjT7R0bj412D0JYNplPSBD1G2SmR/e6u1ikEHG2vYiGxoJmxAyIGSCI8GpCItKimtvl2JtfGujDNkX6epuAhCjNeAZxM1ocPy2Qh4toGQ5DLU+ysiuA2S3P0KgJkjAgEAlQylAA64CG/jlUk6//ng4cNWmLK0yOPNMnG99Rs9LQINVKrD+wmke7upg55PrWP3eYcwrlykpKCkoelDy/HVegQhoABNAepbACwjOt72gZkJhypX70YDWEEklue+rbnYc2MiGp1upPfYReiJJUUG58gFXu4udch1wHcjFIgy0HyIjb2yvBpT2F6t+6+f+D15lW8c9JDo7iPSdgVIRLUqL2AyHDQAOf9hfbqxvMF98eT3RuTS1avHyl+Stcphe2chP9+4k/t3RbXVl3W+Ws17FY56/w3VcbO/koS/eZLoAqrQMxADZMTYOfwpwoWjL4+bCYcgssMqGOzPD6CIkZ/3SxTJ0ayFIN6/BnBrZb2XdE1JUgkJWkfrUNRJnPyc16zsbgPyXIUJBpvc+y89nk/S8/4nek3NPGeBWMwzGvhUPnP6RubRLwfODlqqx3LSCyee2MnlwMwA2RwgO5qouVcHmksUdJweYyi8hZkrUjgT5t/ejNq0jBsSqNWsKyT9uFtxw7Bs585d3g46KOeT2bWHmtd14KyP+5mzqpsYU3OyioACMhGiqPTMocsrHId9cy9BLDzKxq8X3ctMwlV6yKSHL4fr4dd0DeQBTBUgUkvpE1kVPbqkX117ZzuSaFf4zyfz5n9A4lk0yNU7vyb7jTy1kmFGipejKvh6h9n0W995ZPTu227hqmCz33xXgFV1v9NzI96NfjndWt7XWCB/7BSICFWL+j3lAofpCtfYFb6X9MwCJZ07mUsXRGwAAAABJRU5ErkJggg=="> <span style="font-size: 16px;">powered by NetLogo</span></a></div></div> <div style="position: relative; width: 719; height: 593" class="netlogo-widget-container"><div class="netlogo-widget netlogo-view-container" style="position: absolute; left: 339px; top: 10px; width: 380px; height: 401px;"><div class="netlogo-widget netlogo-tick-counter">ticks: <span></span></div><div class="view-layers" style="width: 100%; position: relative;"><canvas width="740" height="740" class="patch-view" style="width: 100%; z-index: 0;"></canvas><canvas width="1110" height="1110" class="turtle-view" style="width: 100%; position: absolute; top: 0px; left: 0px; z-index: 1;"></canvas><canvas width="370" height="370" class="spotlight-view" style="width: 100%; position: absolute; top: 0px; left: 0px; z-index: 2;"></canvas></div></div>              <label class="netlogo-widget netlogo-slider netlogo-input" style="position: absolute; left: 165px; top: 10px; width: 157px; height: 33px;"><input type="range" max="250" min="0" step="1"> <span class="netlogo-label">initial-number-sheep</span> <span class="netlogo-value"><input type="number" min="0" max="250" step="1"> </span></label>         <label class="netlogo-widget netlogo-slider netlogo-input" style="position: absolute; left: 165px; top: 44px; width: 158px; height: 33px;"><input type="range" max="95" min="5" step="5"> <span class="netlogo-label">grass-regrowth-rate</span> <span class="netlogo-value"><input type="number" min="5" max="95" step="5"> </span></label>       <button class="netlogo-widget netlogo-button netlogo-command" type="button" style="position: absolute; left: 22px; top: 10px; width: 69px; height: 33px;"><span>setup</span></button>         <button class="netlogo-widget netlogo-button netlogo-command" type="button" style="position: absolute; left: 20px; top: 89px; width: 87px; height: 33px;"><span>run once</span></button>               <div class="netlogo-widget netlogo-plot netlogo-plot-0 netlogo-output" style="position: absolute; left: 8px; top: 333px; width: 309px; height: 260px;" data-highcharts-chart="2"><div class="highcharts-container" id="highcharts-4" style="position: relative; overflow: hidden; width: 309px; height: 260px; text-align: left; line-height: normal; z-index: 0; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><svg version="1.1" style="font-family:&quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Arial, Helvetica, sans-serif;font-size:12px;" xmlns="http://www.w3.org/2000/svg" width="309" height="260"><desc>Created with Highcharts 4.0.4</desc><defs><clippath id="highcharts-5"><rect x="0" y="0" width="225" height="100"></rect></clippath></defs><rect x="0" y="0" width="309" height="260" strokeWidth="0" fill="#FFFFFF" class=" highcharts-background"></rect><g class="highcharts-button" style="cursor:default;" stroke-linecap="round" transform="translate(275,10)"><title>Chart context menu</title><rect x="0.5" y="0.5" width="24" height="22" strokeWidth="1" fill="white" stroke="none" stroke-width="1" rx="2" ry="2"></rect><path fill="#E0E0E0" d="M 6 6.5 L 20 6.5 M 6 11.5 L 20 11.5 M 6 16.5 L 20 16.5" stroke="#666" stroke-width="3" zIndex="1"></path><text x="0" zIndex="1" style="color:black;fill:black;" y="13"></text></g><g class="highcharts-grid" zIndex="1"></g><g class="highcharts-grid" zIndex="1"><path fill="none" d="M 74 52.5 L 299 52.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path><path fill="none" d="M 74 103.5 L 299 103.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path><path fill="none" d="M 74 153.5 L 299 153.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path></g><g class="highcharts-axis" zIndex="2"><path fill="none" d="M 186.5 153 L 186.5 163" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 299.5 153 L 299.5 163" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 73.5 153 L 73.5 163" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><text x="186.5" zIndex="7" text-anchor="middle" transform="translate(0,0)" class=" highcharts-xaxis-title" style="color:#707070;fill:#707070;" visibility="visible" y="195">time</text><path fill="none" d="M 74 153.5 L 299 153.5" stroke="#C0D0E0" stroke-width="1" zIndex="7" visibility="visible"></path></g><g class="highcharts-axis" zIndex="2"><text x="28.125" zIndex="7" text-anchor="middle" transform="translate(0,0) rotate(270 28.125 103)" class=" highcharts-yaxis-title" style="color:#707070;fill:#707070;" visibility="visible" y="103">pop.</text></g><g class="highcharts-series-group" zIndex="3"><g class="highcharts-series" visibility="visible" zIndex="0.1" transform="translate(74,53) scale(1 1)" clip-path="url(#highcharts-5)"><path fill="none" d="M 0 0" stroke-linejoin="round" visibility="visible" stroke="rgba(192,192,192,0.0001)" stroke-width="22" zIndex="2" class=" highcharts-tracker" style=""></path></g><g class="highcharts-markers highcharts-tracker" visibility="visible" zIndex="0.1" transform="translate(74,53) scale(1 1)" clip-path="none" style=""></g><g class="highcharts-series" visibility="visible" zIndex="0.1" transform="translate(74,53) scale(1 1)" clip-path="url(#highcharts-5)"><path fill="none" d="M 0 0" stroke-linejoin="round" visibility="visible" stroke="rgba(192,192,192,0.0001)" stroke-width="22" zIndex="2" class=" highcharts-tracker" style=""></path></g><g class="highcharts-markers highcharts-tracker" visibility="visible" zIndex="0.1" transform="translate(74,53) scale(1 1)" clip-path="none" style=""></g><g class="highcharts-series" visibility="visible" zIndex="0.1" transform="translate(74,53) scale(1 1)" clip-path="url(#highcharts-5)"><path fill="none" d="M 0 0" stroke-linejoin="round" visibility="visible" stroke="rgba(192,192,192,0.0001)" stroke-width="22" zIndex="2" class=" highcharts-tracker" style=""></path></g><g class="highcharts-markers highcharts-tracker" visibility="visible" zIndex="0.1" transform="translate(74,53) scale(1 1)" clip-path="none" style=""></g></g><text x="155" text-anchor="middle" class="highcharts-title" zIndex="4" style="color:#333333;font-size:18px;fill:#333333;width:245px;" y="25">populations</text><g class="highcharts-legend" zIndex="7" transform="translate(67,206)"><g zIndex="1"><g><g class="highcharts-legend-item" zIndex="1" transform="translate(8,3)"><path fill="none" d="M 0 11 L 16 11" stroke="rgb(3, 3, 3)" stroke-width="2"></path><text x="21" style="color:#333333;font-size:12px;font-weight:bold;cursor:pointer;fill:#333333;" text-anchor="start" zIndex="2" y="15"><tspan>white sheep</tspan></text></g><g class="highcharts-legend-item" zIndex="1" transform="translate(121.03125,3)"><path fill="none" d="M 0 11 L 16 11" stroke="rgb(89, 176, 60)" stroke-width="2"></path><text x="21" y="15" style="color:#333333;font-size:12px;font-weight:bold;cursor:pointer;fill:#333333;" text-anchor="start" zIndex="2">grass</text></g><g class="highcharts-legend-item" zIndex="1" transform="translate(8,21)"><path fill="none" d="M 0 11 L 16 11" stroke="rgb(84, 196, 196)" stroke-width="2"></path><text x="21" y="15" style="color:#333333;font-size:12px;font-weight:bold;cursor:pointer;fill:#333333;" text-anchor="start" zIndex="2"><tspan>blue mutation</tspan></text></g></g></g></g><g class="highcharts-axis-labels highcharts-xaxis-labels" zIndex="7"><text x="74" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="173" opacity="1">0</text><text x="186.5" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="173" opacity="1">10</text><text x="299" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="173" opacity="1">20</text></g><g class="highcharts-axis-labels highcharts-yaxis-labels" zIndex="7"><text x="59" text-anchor="end" style="width:82px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="156.5" opacity="1">0</text><text x="59" text-anchor="end" style="width:82px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="106.5" opacity="1">50</text><text x="59" text-anchor="end" style="width:82px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="56.5" opacity="1">100</text></g><g class="highcharts-tooltip" zIndex="8" style="cursor:default;padding:0;white-space:nowrap;" transform="translate(0,-9999)"><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.049999999999999996" stroke-width="5" transform="translate(1, 1)"></path><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.09999999999999999" stroke-width="3" transform="translate(1, 1)"></path><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.15" stroke-width="1" transform="translate(1, 1)"></path><path fill="rgba(249, 249, 249, .85)" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0"></path><text x="8" zIndex="1" style="font-size:12px;color:#333333;fill:#333333;" y="21"></text></g></svg></div></div>       <div class="netlogo-widget netlogo-monitor netlogo-output" style="position: absolute; left: 64px; top: 275px; width: 77px; height: 45px;"><div class="netlogo-label">white sheep</div> <output class="netlogo-value">0</output></div>         <div class="netlogo-widget netlogo-monitor netlogo-output" style="position: absolute; left: 5px; top: 275px; width: 50px; height: 45px;"><div class="netlogo-label">year</div> <output class="netlogo-value">0</output></div>      <label class="netlogo-widget netlogo-button netlogo-forever-button  netlogo-command" style="position: absolute; left: 18px; top: 50px; width: 88px; height: 33px;"><input type="checkbox"> <span class="netlogo-label">run/stop</span></label>       <label class="netlogo-widget netlogo-switcher netlogo-input" style="position: absolute; left: 189px; top: 91px; width: 118px; height: 33px;"><input type="checkbox"> <span class="netlogo-label">selection?</span></label>              <div class="netlogo-widget netlogo-monitor netlogo-output" style="position: absolute; left: 152px; top: 277px; width: 70px; height: 45px;"><div class="netlogo-label">blue sheep</div> <output class="netlogo-value">0</output></div>   <pre class="netlogo-widget netlogo-text-box" style="position: absolute; left: 190px; top: 131px; width: 150px; height: 56px;">if selection? is ON, blue sheep get much more energy from grass</pre>           <button class="netlogo-widget netlogo-button netlogo-command" type="button" style="position: absolute; left: 22px; top: 153px; width: 109px; height: 33px;"><span>add mutants</span></button>           <label class="netlogo-widget netlogo-slider netlogo-input" style="position: absolute; left: 20px; top: 191px; width: 116px; height: 33px;"><input type="range" max="20" min="0" step="1"> <span class="netlogo-label">number-added</span> <span class="netlogo-value"><input type="number" min="0" max="20" step="1"> </span></label>     <pre class="netlogo-widget netlogo-text-box" style="position: absolute; left: 33px; top: 231px; width: 118px; height: 21px;">adds blue sheep</pre>                 <div class="netlogo-widget netlogo-plot netlogo-plot-1 netlogo-output" style="position: absolute; left: 346px; top: 423px; width: 160px; height: 170px;" data-highcharts-chart="3"><div class="highcharts-container" id="highcharts-10" style="position: relative; overflow: hidden; width: 160px; height: 170px; text-align: left; line-height: normal; z-index: 0; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><svg version="1.1" style="font-family:&quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Arial, Helvetica, sans-serif;font-size:12px;" xmlns="http://www.w3.org/2000/svg" width="160" height="170"><desc>Created with Highcharts 4.0.4</desc><defs><clippath id="highcharts-11"><rect x="0" y="0" width="104" height="77"></rect></clippath></defs><rect x="0" y="0" width="160" height="170" strokeWidth="0" fill="#FFFFFF" class=" highcharts-background"></rect><g class="highcharts-button" style="cursor:default;" stroke-linecap="round" transform="translate(126,10)"><title>Chart context menu</title><rect x="0.5" y="0.5" width="24" height="22" strokeWidth="1" fill="white" stroke="none" stroke-width="1" rx="2" ry="2"></rect><path fill="#E0E0E0" d="M 6 6.5 L 20 6.5 M 6 11.5 L 20 11.5 M 6 16.5 L 20 16.5" stroke="#666" stroke-width="3" zIndex="1"></path><text x="0" zIndex="1" style="color:black;fill:black;" y="13"></text></g><g class="highcharts-grid" zIndex="1"></g><g class="highcharts-grid" zIndex="1"><path fill="none" d="M 46 52.5 L 150 52.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path><path fill="none" d="M 46 92.5 L 150 92.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path><path fill="none" d="M 46 130.5 L 150 130.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path></g><g class="highcharts-axis" zIndex="2"><path fill="none" d="M 97.5 130 L 97.5 140" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 148.5 130 L 148.5 140" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 46.5 130 L 46.5 140" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 46 130.5 L 150 130.5" stroke="#C0D0E0" stroke-width="1" zIndex="7" visibility="visible"></path></g><g class="highcharts-axis" zIndex="2"></g><g class="highcharts-series-group" zIndex="3"><g class="highcharts-series highcharts-tracker" visibility="visible" zIndex="0.1" transform="translate(46,53) scale(1 1)" style="" clip-path="url(#highcharts-11)"></g><g class="highcharts-markers" visibility="visible" zIndex="0.1" transform="translate(46,53) scale(1 1)" clip-path="none"></g></g><text x="80" text-anchor="middle" class="highcharts-title" zIndex="4" style="color:#333333;font-size:18px;fill:#333333;width:96px;" y="25">CC--cC--cc</text><g class="highcharts-axis-labels highcharts-xaxis-labels" zIndex="7"><text x="46.51485148514851" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="150" opacity="1">0</text><text x="98" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="150" opacity="1">50</text><text x="149.4851485148515" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="150" opacity="1">100</text></g><g class="highcharts-axis-labels highcharts-yaxis-labels" zIndex="7"><text x="31" text-anchor="end" style="width:33px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="133.5" opacity="1">0</text><text x="31" text-anchor="end" style="width:33px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="95" opacity="1">50</text><text x="31" text-anchor="end" style="width:33px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="56.5" opacity="1">100</text></g><g class="highcharts-tooltip" zIndex="8" style="cursor:default;padding:0;white-space:nowrap;" transform="translate(0,-9999)"><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.049999999999999996" stroke-width="5" transform="translate(1, 1)"></path><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.09999999999999999" stroke-width="3" transform="translate(1, 1)"></path><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.15" stroke-width="1" transform="translate(1, 1)"></path><path fill="rgba(249, 249, 249, .85)" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0"></path><text x="8" zIndex="1" style="font-size:12px;color:#333333;fill:#333333;" y="21"></text></g></svg></div></div> <pre class="netlogo-widget netlogo-text-box" style="position: absolute; left: 537px; top: 507px; width: 90px; height: 28px;">Only cc has better teeth</pre>          <label class="netlogo-widget netlogo-switcher netlogo-input" style="position: absolute; left: 179px; top: 189px; width: 129px; height: 33px;"><input type="checkbox"> <span class="netlogo-label">fussyfemales?</span></label>        <pre class="netlogo-widget netlogo-text-box" style="position: absolute; left: 178px; top: 227px; width: 139px; height: 28px;">fussy females won't mate with blue males</pre>        </div> <div class="netlogo-tabs"><label class="netlogo-code-tab netlogo-tab netlogo-command "><input type="checkbox"> NetLogo Code</label> <label class="netlogo-info-tab netlogo-tab netlogo-command "><input type="checkbox"> Model Info</label></div> <div class="netlogo-model-text"> </div></div></div>
    <script type="text/string" id="nlogo-code">globals [ year   year-length  fence? teeth-avg gain-from-food ]
breed [ males ]
breed [ females ]

turtles-own [ energy  teeth  age   geneA geneB geneC geneD   ]   
    ;; A and B are the two chromosomes that have the teeth allele on them.
    ;; C and D are the two chromosomes with the cyan allele on them.         
patches-own [ countdown ]
  
to startup
setup
end

to setup 
  ;; (for this model to work with NetLogo's new plotting features,
  ;; __clear-all-and-reset-ticks should be replaced with clear-all at
  ;; the beginning of your setup procedure and reset-ticks at the end
  ;; of the procedure.)
  clear-all
  set year 0
  set year-length 12
  set gain-from-food 2
  ask patches [ set pcolor green ]
  set fence? false    ;;this is not in use  
    ask patches [
      set countdown random (101 - grass-regrowth-rate) ;; initialize grass grow clocks randomly
      if (random 2) = 0  ;;half the patches start out with grass
          [ set pcolor brown ]
    ]
    ask patches [create-fences]
    
  set-default-shape females "ewes"
  set-default-shape males "rams2"
  create-males (initial-number-sheep / 2)  ;; create the males, then initialize their variables
  [ 
    set color white
    set size 2.5
    set age random 5
    set energy random (2 * gain-from-food)
    setxy random-float world-width
          random-float world-height
    repeat 6 [if pcolor = red [rt 90 fd 3 ]]
;;set each gene to 0 or 1, randomly 
    set geneA random 2
    set geneB random 2
    set geneC 0 ;;random 2
    set geneD  0 ;; random 2
  ] 
  
    create-females (initial-number-sheep / 2)  ;; create the females, then initialize their variables
  [ 
    set color white
    set size 2.5
    set age random 5
    set energy random (2 * gain-from-food)
    setxy random-float world-width
          random-float world-height
    if pcolor = red [rt 180 fd 1] 
    repeat 6 [if pcolor = red [rt 90 fd 3 ]]
;;set each gene to 0 or 1, randomly 
    set geneA random 2
    set geneB random 2
    set geneC  0 ;;random 2
    set geneD 0 ;;random 2
]  


;; geneA and geneB arene't expressed in this model
  ask turtles [ 
      if (geneA + geneB = 2)   [set teeth 1.0]   ;; TT condition
      if (geneA + geneB = 1)   [set teeth 1.0]   ;; tT and Tt condition
      if (geneA + geneB = 0)   [set teeth 1.0]   ;; tt condition

      ]
  ;;display-labels
  set teeth-avg (sum [teeth] of turtles) / count turtles
  setup-histogram
  do-plot
  reset-ticks
end

to go
   ask patches [
      if pxcor = 0 and (abs pycor  < max-pycor)
         [if fence?  [set pcolor red] ]    
        ]
        
  ;; make CD very favorable -- regardless of what geneA and geneB are
    ask turtles [if color = cyan [set teeth 2]]
 
  repeat year-length [
  ask males [
        move
        eat-grass
        death
        ] 
  
    ask females [
        move
        eat-grass 
        death
        ]
        
    ask patches [ grow-grass ] 
    display
    ] 
    
    ask males  [ 
      set age age + 1
    ]
    
    ask females [
      set age age + 1 
      if age > 1 and age <= 6 [reproduce]
    ]
   ;; if auto-reap?  [reaper]
    set year year + 1
    if count turtles >  0 [set teeth-avg (sum [teeth] of turtles) / count turtles]
    do-plot  ;; plot populations
 
   ;;express the mutation CD (not Cd,cD, or cd) as changing colo
    ask turtles [    
     if (geneC + geneD = 2) 
       [set color cyan]  
       ]
 ;;   ask turtles [set size (teeth * 2)]
  if not any? turtles [ stop ]
end

to move  ;; turtle procedure
  rt random-float 50 - random-float 50
  fd 1
  if pcolor = red [rt 180 fd 1] 
end

to eat-grass  ;; turtle procedure
  ;; sheep eat grass, turn the patch brown
      set energy energy - 1 ;; deduct energy for sheep only if grass? switch is on
      
    if pcolor = green [ 
      set pcolor brown 
      ifelse selection? ;;no selection pressure on teeth if selection? = false
        [set energy energy + (gain-from-food * teeth) ] ;; sheep gain more energy if they have better teeth
        [set energy energy + (gain-from-food * 1) ] ;; all sheep gain the same energy
      ]
end

to reproduce
    breed-and-birth  ;; females mate with any ram in the whole field  
end

to breed-and-birth ;; turtle procedure
  if count males with [color = white] > 0  [   ;; use this to prevent a runtime error if the population is near to extinction
    hatch 1 [
    fd 10
    set age 0
    set energy 3
    ifelse (random 2 = 1) 
      [set breed males ] 
      [set breed females ]
; 
; ;; geneA and geneB match the mother's by default. Choose baby's geneC to match one
; ;; of mother's genes.

     ifelse (random 2 = 1) ;;
      [set geneC geneC ];; same as mother's first chromosome
      [set geneC geneD];; same as mother's second chromosome
  
;;;; set geneD to match one of father's genes.

  ifelse fussyfemales? = true 
    [ifelse (random 2 = 1)
      [set geneD [geneC] of (one-of males with [color = white ])]
      [set geneD [geneD] of (one-of males with [color = white ])]
    ]
   [ifelse (random 2 = 1)
      [set geneD [geneC] of (one-of males )]
      [set geneD [geneD] of (one-of males )]
    ]
;;express the gene CD -- better teeth are recessive
     if (geneC + geneD = 2)   [set teeth 2.0]   ;; cc condition
     if (geneC + geneD = 1)   [set teeth 1.0]   ;; cC condition
     if (geneC + geneD = 0)   [set teeth 1.0]   ;; CC condition
     ifelse (geneC + geneD = 2)
      [set color cyan]
      [set color white]

   
;      
;  ;; T is dominant for better teeth
;      if (geneA + geneB = 2)   [set teeth 1.0]   ;; TT condition
;      if (geneA + geneB = 1)   [set teeth 1.0]   ;; tT and Tt condition
;      if (geneA + geneB = 0)   [set teeth 1.0]   ;; tt condition
     ] 
  ] 
end

to add-mutants
  crt  number-added [
    ifelse (random 2 = 0) 
      [set breed females]
      [set breed males]
    set color cyan
    set size 2.5
    set age 2
    set energy random (2 * gain-from-food)
    setxy random-float world-width
          random-float world-height
    if pcolor = red [ fd 3 ]
    set geneA random 2
    set geneB random 2
    set geneC 1
    set geneD 1
    ]
 end
 
to death  ;; turtle procedure
  ;; when energy dips below zero, or sheep gets old, die
  if energy < 0 [ die ] 
  if age > 6 [die ]
end

to grow-grass  ;; patch procedure
  ;; countdown on brown patches, if reach 0, grow some grass
  if pcolor = brown [ 
    ifelse countdown <= 0
      [ set pcolor green
        set countdown (102 - grass-regrowth-rate) ] 
      [ set countdown (countdown - 1) ] 
  ] 
end


to create-fences; patch procedure
if (abs pxcor) = max-pxcor   [set pcolor red]
if (abs pycor) = max-pycor [set pcolor red]
if pxcor = 0 and fence? [set pcolor red]
end

to setup-histogram
  set-current-plot "cc--cC--CC"
  set-plot-x-range -.5  2.5
  set-plot-y-range 0 initial-number-sheep
  set-histogram-num-bars 3
end

to do-plot 
  set-current-plot "populations"
  set-current-plot-pen "white sheep" 
    plot (count turtles with [color = white])
 
  ;; divide by four to keep it within similar range as sheep populations                                         
;  set-current-plot-pen "grass"
 ;   plot (count patches with [pcolor = green]) / 4
  set-current-plot-pen "blue mutation"
    plot count turtles with [color = cyan]
   
 set-current-plot "cc--cC--CC"
  histogram [(geneC + geneD)] of  turtles
end
</script>
    <script type="text/string" id="nlogo-info">
		Evolution:  Sheep-fussyfemales
 This is a model of a flock of sheep whose survival depends on eating grass. The babies inherit traits from their parents according to Mendelian genetics. One can watch the spread of a mutation and how it depends on selection pressure. There are two such pressures here: the energy sheep get from grass, and the fact that females will not breed with mutated sheep.

Here are are some explorations:  
1. Picture yourself as a farmer with a large field of sheep. You start with an equal number of males (horns) and females (no horns). They live for six years. The sheep move around the field and eat grass, which grows back at a certain rate. The patch is green if there is grass there, and brown if there is no grass. In the model, the sheep move and eat during each year. They use up energy as they move, and they gain energy from eating grass. If their energy goes to zero, they die. 

2. Once a year, from age 3 to age 6, each female mates with a randomly chosen male and gives birth to a baby. The baby inherits its TEETH trait from both its parents. 

3. In this version, all of the sheep have standard teeth. There are two new   
features, one a pressure in favor of the muation, and one opposing it:  
a. An ADD MUTANTS button. When you hit this button, some blue sheep are added to the herd. Sheep pass their color gene on to their offspring.   
b. A FUSSYFEMALES button. When you hit this button, females refuse to mate with blue (mutated) males.

4. If SELECTION? = ON, a blue sheep gets twice as much energy from grass as a regular sheep. If SELECTION? = OFF, the blue color has no effect on its eating or how likely it is to survive and have offspring.

5. Try the model with SELECTION? on or off, and FUSSYFEMALES? on or off. Run the model, add at least 15 mutants, and fill in the following table. 

Condition			What happens

## SELECTION? = OFF

FUSSYFEMALES? = ON
	  
## SELECTION? = ON

FUSSYFEMALES? = OFF
	  
## SELECTION? = ON

FUSSYFEMALES? = ON
	</script>
<script type="text/javascript" src="app.js"></script>
    <script type="text/javascript">
;

      var widgets = [{"left":339,"top":10,"right":719,"bottom":411,"patchSize":10.0,"fontSize":14,"wrappingAllowedInX":true,"wrappingAllowedInY":true,"minPxcor":-18,"maxPxcor":18,"minPycor":-18,"maxPycor":18,"updateMode":"Continuous","showTickCounter":true,"tickCounterLabel":"ticks","frameRate":30.0,"type":"view"},{"display":"initial-number-sheep","left":165,"top":10,"right":322,"bottom":43,"varName":"initial-number-sheep","min":"0","max":"250","default":100.0,"step":"1","units":null,"direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"250"},"compiledStep":{"success":true,"result":"1"}},{"display":"grass-regrowth-rate","left":165,"top":44,"right":323,"bottom":77,"varName":"grass-regrowth-rate","min":"5","max":"95","default":80.0,"step":"5","units":null,"direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"5"},"compiledMax":{"success":true,"result":"95"},"compiledStep":{"success":true,"result":"5"}},{"display":"setup","left":22,"top":10,"right":91,"bottom":43,"source":"setup","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(setup);"}},{"display":"run once","left":20,"top":89,"right":107,"bottom":122,"source":"go","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"populations","left":8,"top":333,"right":317,"bottom":593,"xAxis":"time","yAxis":"pop.","xmin":0.0,"xmax":20.0,"ymin":0.0,"ymax":100.0,"autoPlotOn":true,"legendOn":true,"setupCode":"","updateCode":"","pens":[{"display":"white sheep","interval":1.0,"mode":0,"color":-16777216,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"grass","interval":1.0,"mode":0,"color":-10899396,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"blue mutation","interval":1.0,"mode":0,"color":-11221820,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}}],"type":"plot","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"white sheep","left":64,"top":275,"right":141,"bottom":320,"source":"count turtles with [color = white]","precision":1,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.turtles().agentFilter(function() {\n  return Prims.equality(SelfPrims.getVariable('color'), 9.9);\n}).size()"}},{"display":"year","left":5,"top":275,"right":55,"bottom":320,"source":"year","precision":0,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.observer.getGlobal('year')"}},{"display":"run/stop","left":18,"top":50,"right":106,"bottom":83,"source":"go","forever":true,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"selection?","left":189,"top":91,"right":307,"bottom":124,"varName":"selection?","on":true,"type":"switch"},{"display":"blue sheep","left":152,"top":277,"right":222,"bottom":322,"source":"count turtles with [color = cyan]","precision":2,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.turtles().agentFilter(function() {\n  return Prims.equality(SelfPrims.getVariable('color'), 85);\n}).size()"}},{"display":"if selection? is ON, blue sheep get much more energy from grass","left":190,"top":131,"right":340,"bottom":187,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"add mutants","left":22,"top":153,"right":131,"bottom":186,"source":"add-mutants","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(addMutants);"}},{"display":"number-added","left":20,"top":191,"right":136,"bottom":224,"varName":"number-added","min":"0","max":"20","default":9.0,"step":"1","units":null,"direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"20"},"compiledStep":{"success":true,"result":"1"}},{"display":"adds blue sheep","left":33,"top":231,"right":151,"bottom":252,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"CC--cC--cc","left":346,"top":423,"right":506,"bottom":593,"xAxis":null,"yAxis":null,"xmin":0.0,"xmax":100.0,"ymin":0.0,"ymax":100.0,"autoPlotOn":true,"legendOn":false,"setupCode":"","updateCode":"","pens":[{"display":"default","interval":1.0,"mode":1,"color":-16777216,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}}],"type":"plot","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"Only cc has better teeth","left":537,"top":507,"right":627,"bottom":535,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"fussyfemales?","left":179,"top":189,"right":308,"bottom":222,"varName":"fussyfemales?","on":false,"type":"switch"},{"display":"fussy females won't mate with blue males","left":178,"top":227,"right":317,"bottom":255,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"}];
      var code    = document.querySelector("#nlogo-code").textContent;
      var info    = document.querySelector("#nlogo-info").textContent;
      var session = Tortoise.fromCompiledModel('#model-container', widgets, code, info, '', true);
      var modelConfig  = (typeof window.modelConfig !== "undefined" && window.modelConfig !== null) ? window.modelConfig : {};
var modelPlotOps = (typeof modelConfig.plotOps !== "undefined" && modelConfig.plotOps !== null) ? modelConfig.plotOps : {};

var PenBundle = tortoise_require('engine/plot/pen');
var Plot      = tortoise_require('engine/plot/plot');
var PlotOps   = tortoise_require('engine/plot/plotops');

modelConfig.plots = [(function() {
  var name    = 'populations';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('white sheep', plotOps.makePenOps, false, new PenBundle.State(0.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'white sheep')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'white sheep')(function() {}); }); }),
new PenBundle.Pen('grass', plotOps.makePenOps, false, new PenBundle.State(55.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'grass')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'grass')(function() {}); }); }),
new PenBundle.Pen('blue mutation', plotOps.makePenOps, false, new PenBundle.State(85.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'blue mutation')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', 'blue mutation')(function() {}); }); })];
  var setup   = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', undefined)(function() {}); }); };
  var update  = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('populations', undefined)(function() {}); }); };
  return new Plot(name, pens, plotOps, 'time', 'pop.', true, 0.0, 20.0, 0.0, 100.0, setup, update);
})(), (function() {
  var name    = 'CC--cC--cc';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('default', plotOps.makePenOps, false, new PenBundle.State(0.0, 1.0, PenBundle.DisplayMode.Bar), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('CC--cC--cc', 'default')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('CC--cC--cc', 'default')(function() {}); }); })];
  var setup   = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('CC--cC--cc', undefined)(function() {}); }); };
  var update  = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('CC--cC--cc', undefined)(function() {}); }); };
  return new Plot(name, pens, plotOps, '', '', false, 0.0, 100.0, 0.0, 100.0, setup, update);
})()];

var workspace = tortoise_require('engine/workspace')(modelConfig)([{ name: 'MALES', singular: 'turtle', varNames: [] }, { name: 'FEMALES', singular: 'turtle', varNames: [] }])(['energy', 'teeth', 'age', 'genea', 'geneb', 'genec', 'gened'], [])(['initial-number-sheep', 'grass-regrowth-rate', 'selection?', 'number-added', 'fussyfemales?', 'year', 'year-length', 'fence?', 'teeth-avg', 'gain-from-food'], ['initial-number-sheep', 'grass-regrowth-rate', 'selection?', 'number-added', 'fussyfemales?'], ['countdown'], -18, 18, -18, 18, 10.0, true, true, {"default":{"rotate":true,"elements":[{"xcors":[150,40,150,260],"ycors":[5,250,205,250],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"ewes":{"rotate":false,"elements":[{"xcors":[91,70,41,16,1,2,23,49,49,58,48,61,85,72,90,122,152,198,190,201,231,215,227,229,220,241,249,252,270,259,239,195,168,140,122],"ycors":[124,96,91,101,127,147,170,175,202,216,248,293,292,251,208,220,220,212,252,287,288,249,186,173,146,153,179,191,189,148,121,116,116,116,123],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[247,218,215,237],"ycors":[175,151,142,144],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[84,135,169,200,198,104,75],"ycors":[218,233,229,224,207,203,203],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[3,12,29,39,63],"ycors":[126,97,88,88,94],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[269,263,247,253],"ycors":[188,212,208,192],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"rams2":{"rotate":false,"elements":[{"xcors":[92,157,238,266,274,270,260,248,229,242,242,232,251,225,204,208,155,92,56,67,39,30,72,59,35,15,3,1,12,47,13,52,78,110,126,129,116,103,111,99,69,64,82,92,126,155,156],"ycors":[102,97,108,146,183,199,197,159,137,184,208,250,292,295,240,195,202,181,206,252,252,199,157,127,125,120,100,68,46,35,47,28,22,25,39,53,73,74,55,39,42,50,66,90,91,97,98],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[69,83,58,57],"ycors":[55,41,40,56],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"sheep":{"rotate":false,"elements":[{"xmin":90,"ymin":75,"xmax":270,"ymax":225,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":15,"y":75,"diam":150,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":81,"ymin":225,"xmax":134,"ymax":286,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":180,"ymin":225,"xmax":238,"ymax":285,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":1,"y":88,"diam":92,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"wolf":{"rotate":false,"elements":[{"xmin":15,"ymin":105,"xmax":105,"ymax":165,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":45,"ymin":90,"xmax":105,"ymax":105,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[60,83,104],"ycors":[90,44,90],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[67,82,97],"ycors":[90,59,89],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":48,"ymin":93,"xmax":59,"ymax":105,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xmin":51,"ymin":96,"xmax":55,"ymax":101,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":0,"ymin":121,"xmax":15,"ymax":135,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":15,"ymin":136,"xmax":60,"ymax":151,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xcors":[15,23,31],"ycors":[136,149,136],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xcors":[30,37,43],"ycors":[151,136,151],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xmin":105,"ymin":120,"xmax":263,"ymax":195,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":108,"ymin":195,"xmax":259,"ymax":201,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":114,"ymin":201,"xmax":252,"ymax":210,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":120,"ymin":210,"xmax":243,"ymax":214,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":115,"ymin":114,"xmax":255,"ymax":120,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":128,"ymin":108,"xmax":248,"ymax":114,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":150,"ymin":105,"xmax":225,"ymax":108,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":132,"ymin":214,"xmax":155,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":110,"ymin":260,"xmax":132,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":210,"ymin":214,"xmax":232,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":260,"xmax":210,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x1":263,"y1":127,"x2":281,"y2":155,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":281,"y1":155,"x2":281,"y2":192,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]}}, {"default":{}});

var BreedManager  = workspace.breedManager;
var LayoutManager = workspace.layoutManager;
var LinkPrims     = workspace.linkPrims;
var ListPrims     = workspace.listPrims;
var MousePrims    = workspace.mousePrims;
var plotManager   = workspace.plotManager;
var Prims         = workspace.prims;
var SelfPrims     = workspace.selfPrims;
var SelfManager   = workspace.selfManager;
var Updater       = workspace.updater;
var world         = workspace.world;

var Call           = tortoise_require('util/call');
var ColorModel     = tortoise_require('util/colormodel');
var Exception      = tortoise_require('util/exception');
var Trig           = tortoise_require('util/trig');
var Type           = tortoise_require('util/typechecker');
var notImplemented = tortoise_require('util/notimplemented');

var Dump      = tortoise_require('engine/dump');
var Link      = tortoise_require('engine/core/link');
var LinkSet   = tortoise_require('engine/core/linkset');
var Nobody    = tortoise_require('engine/core/nobody');
var PatchSet  = tortoise_require('engine/core/patchset');
var Turtle    = tortoise_require('engine/core/turtle');
var TurtleSet = tortoise_require('engine/core/turtleset');
var Tasks     = tortoise_require('engine/prim/tasks');

var AgentModel = tortoise_require('agentmodel');
var Denuller   = tortoise_require('nashorn/denuller');
var Random     = tortoise_require('shim/random');
var StrictMath = tortoise_require('shim/strictmath');
function startup() {
  Call(setup);
}
function setup() {
  world.clearAll();
  world.observer.setGlobal('year', 0);
  world.observer.setGlobal('year-length', 12);
  world.observer.setGlobal('gain-from-food', 2);
  world.patches().ask(function() {
    SelfPrims.setPatchVariable('pcolor', 55);
  }, true);
  world.observer.setGlobal('fence?', false);
  world.patches().ask(function() {
    SelfPrims.setPatchVariable('countdown', Prims.random((101 - world.observer.getGlobal('grass-regrowth-rate'))));
    if (Prims.equality(Prims.random(2), 0)) {
      SelfPrims.setPatchVariable('pcolor', 35);
    }
  }, true);
  world.patches().ask(function() {
    Call(createFences);
  }, true);
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("FEMALES").getBreedName(), "ewes")
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("MALES").getBreedName(), "rams2")
  world.turtleManager.createTurtles((world.observer.getGlobal('initial-number-sheep') / 2), 'MALES').ask(function() {
    SelfPrims.setVariable('color', 9.9);
    SelfPrims.setVariable('size', 2.5);
    SelfPrims.setVariable('age', Prims.random(5));
    SelfPrims.setVariable('energy', Prims.random((2 * world.observer.getGlobal('gain-from-food'))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    Prims.repeat(6, function() {
      if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 15)) {
        SelfPrims.right(90);
        SelfPrims.fd(3);
      }
    });
    SelfPrims.setVariable('genea', Prims.random(2));
    SelfPrims.setVariable('geneb', Prims.random(2));
    SelfPrims.setVariable('genec', 0);
    SelfPrims.setVariable('gened', 0);
  }, true);
  world.turtleManager.createTurtles((world.observer.getGlobal('initial-number-sheep') / 2), 'FEMALES').ask(function() {
    SelfPrims.setVariable('color', 9.9);
    SelfPrims.setVariable('size', 2.5);
    SelfPrims.setVariable('age', Prims.random(5));
    SelfPrims.setVariable('energy', Prims.random((2 * world.observer.getGlobal('gain-from-food'))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 15)) {
      SelfPrims.right(180);
      SelfPrims.fd(1);
    }
    Prims.repeat(6, function() {
      if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 15)) {
        SelfPrims.right(90);
        SelfPrims.fd(3);
      }
    });
    SelfPrims.setVariable('genea', Prims.random(2));
    SelfPrims.setVariable('geneb', Prims.random(2));
    SelfPrims.setVariable('genec', 0);
    SelfPrims.setVariable('gened', 0);
  }, true);
  world.turtles().ask(function() {
    if (Prims.equality((SelfPrims.getVariable('genea') + SelfPrims.getVariable('geneb')), 2)) {
      SelfPrims.setVariable('teeth', 1);
    }
    if (Prims.equality((SelfPrims.getVariable('genea') + SelfPrims.getVariable('geneb')), 1)) {
      SelfPrims.setVariable('teeth', 1);
    }
    if (Prims.equality((SelfPrims.getVariable('genea') + SelfPrims.getVariable('geneb')), 0)) {
      SelfPrims.setVariable('teeth', 1);
    }
  }, true);
  world.observer.setGlobal('teeth-avg', (ListPrims.sum(world.turtles().projectionBy(function() {
    return SelfPrims.getVariable('teeth');
  })) / world.turtles().size()));
  Call(setupHistogram);
  Call(doPlot);
  world.ticker.reset();
}
function go() {
  world.patches().ask(function() {
    if ((Prims.equality(SelfPrims.getPatchVariable('pxcor'), 0) && Prims.lt(StrictMath.abs(SelfPrims.getPatchVariable('pycor')), world.topology.maxPycor))) {
      if (world.observer.getGlobal('fence?')) {
        SelfPrims.setPatchVariable('pcolor', 15);
      }
    }
  }, true);
  world.turtles().ask(function() {
    if (Prims.equality(SelfPrims.getVariable('color'), 85)) {
      SelfPrims.setVariable('teeth', 2);
    }
  }, true);
  Prims.repeat(world.observer.getGlobal('year-length'), function() {
    world.turtleManager.turtlesOfBreed("MALES").ask(function() {
      Call(move);
      Call(eatGrass);
      Call(death);
    }, true);
    world.turtleManager.turtlesOfBreed("FEMALES").ask(function() {
      Call(move);
      Call(eatGrass);
      Call(death);
    }, true);
    world.patches().ask(function() {
      Call(growGrass);
    }, true);
    notImplemented('display', undefined)();
  });
  world.turtleManager.turtlesOfBreed("MALES").ask(function() {
    SelfPrims.setVariable('age', (SelfPrims.getVariable('age') + 1));
  }, true);
  world.turtleManager.turtlesOfBreed("FEMALES").ask(function() {
    SelfPrims.setVariable('age', (SelfPrims.getVariable('age') + 1));
    if ((Prims.gt(SelfPrims.getVariable('age'), 1) && Prims.lte(SelfPrims.getVariable('age'), 6))) {
      Call(reproduce);
    }
  }, true);
  world.observer.setGlobal('year', (world.observer.getGlobal('year') + 1));
  if (Prims.gt(world.turtles().size(), 0)) {
    world.observer.setGlobal('teeth-avg', (ListPrims.sum(world.turtles().projectionBy(function() {
      return SelfPrims.getVariable('teeth');
    })) / world.turtles().size()));
  }
  Call(doPlot);
  world.turtles().ask(function() {
    if (Prims.equality((SelfPrims.getVariable('genec') + SelfPrims.getVariable('gened')), 2)) {
      SelfPrims.setVariable('color', 85);
    }
  }, true);
  if (!world.turtles().nonEmpty()) {
    throw new Exception.StopInterrupt;
  }
}
function move() {
  SelfPrims.right((Prims.randomFloat(50) - Prims.randomFloat(50)));
  SelfPrims.fd(1);
  if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 15)) {
    SelfPrims.right(180);
    SelfPrims.fd(1);
  }
}
function eatGrass() {
  SelfPrims.setVariable('energy', (SelfPrims.getVariable('energy') - 1));
  if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 55)) {
    SelfPrims.setPatchVariable('pcolor', 35);
    if (world.observer.getGlobal('selection?')) {
      SelfPrims.setVariable('energy', (SelfPrims.getVariable('energy') + (world.observer.getGlobal('gain-from-food') * SelfPrims.getVariable('teeth'))));
    }
    else {
      SelfPrims.setVariable('energy', (SelfPrims.getVariable('energy') + (world.observer.getGlobal('gain-from-food') * 1)));
    }
  }
}
function reproduce() {
  Call(breedAndBirth);
}
function breedAndBirth() {
  if (Prims.gt(world.turtleManager.turtlesOfBreed("MALES").agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable('color'), 9.9);
  }).size(), 0)) {
    SelfPrims.hatch(1, '').ask(function() {
      SelfPrims.fd(10);
      SelfPrims.setVariable('age', 0);
      SelfPrims.setVariable('energy', 3);
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable('breed', world.turtleManager.turtlesOfBreed("MALES"));
      }
      else {
        SelfPrims.setVariable('breed', world.turtleManager.turtlesOfBreed("FEMALES"));
      }
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable('genec', SelfPrims.getVariable('genec'));
      }
      else {
        SelfPrims.setVariable('genec', SelfPrims.getVariable('gened'));
      }
      if (Prims.equality(world.observer.getGlobal('fussyfemales?'), true)) {
        if (Prims.equality(Prims.random(2), 1)) {
          SelfPrims.setVariable('gened', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES").agentFilter(function() {
            return Prims.equality(SelfPrims.getVariable('color'), 9.9);
          })).projectionBy(function() {
            return SelfPrims.getVariable('genec');
          }));
        }
        else {
          SelfPrims.setVariable('gened', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES").agentFilter(function() {
            return Prims.equality(SelfPrims.getVariable('color'), 9.9);
          })).projectionBy(function() {
            return SelfPrims.getVariable('gened');
          }));
        }
      }
      else {
        if (Prims.equality(Prims.random(2), 1)) {
          SelfPrims.setVariable('gened', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES")).projectionBy(function() {
            return SelfPrims.getVariable('genec');
          }));
        }
        else {
          SelfPrims.setVariable('gened', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES")).projectionBy(function() {
            return SelfPrims.getVariable('gened');
          }));
        }
      }
      if (Prims.equality((SelfPrims.getVariable('genec') + SelfPrims.getVariable('gened')), 2)) {
        SelfPrims.setVariable('teeth', 2);
      }
      if (Prims.equality((SelfPrims.getVariable('genec') + SelfPrims.getVariable('gened')), 1)) {
        SelfPrims.setVariable('teeth', 1);
      }
      if (Prims.equality((SelfPrims.getVariable('genec') + SelfPrims.getVariable('gened')), 0)) {
        SelfPrims.setVariable('teeth', 1);
      }
      if (Prims.equality((SelfPrims.getVariable('genec') + SelfPrims.getVariable('gened')), 2)) {
        SelfPrims.setVariable('color', 85);
      }
      else {
        SelfPrims.setVariable('color', 9.9);
      }
    }, true);
  }
}
function addMutants() {
  world.turtleManager.createTurtles(world.observer.getGlobal('number-added'), '').ask(function() {
    if (Prims.equality(Prims.random(2), 0)) {
      SelfPrims.setVariable('breed', world.turtleManager.turtlesOfBreed("FEMALES"));
    }
    else {
      SelfPrims.setVariable('breed', world.turtleManager.turtlesOfBreed("MALES"));
    }
    SelfPrims.setVariable('color', 85);
    SelfPrims.setVariable('size', 2.5);
    SelfPrims.setVariable('age', 2);
    SelfPrims.setVariable('energy', Prims.random((2 * world.observer.getGlobal('gain-from-food'))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 15)) {
      SelfPrims.fd(3);
    }
    SelfPrims.setVariable('genea', Prims.random(2));
    SelfPrims.setVariable('geneb', Prims.random(2));
    SelfPrims.setVariable('genec', 1);
    SelfPrims.setVariable('gened', 1);
  }, true);
}
function death() {
  if (Prims.lt(SelfPrims.getVariable('energy'), 0)) {
    SelfPrims.die();
  }
  if (Prims.gt(SelfPrims.getVariable('age'), 6)) {
    SelfPrims.die();
  }
}
function growGrass() {
  if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 35)) {
    if (Prims.lte(SelfPrims.getPatchVariable('countdown'), 0)) {
      SelfPrims.setPatchVariable('pcolor', 55);
      SelfPrims.setPatchVariable('countdown', (102 - world.observer.getGlobal('grass-regrowth-rate')));
    }
    else {
      SelfPrims.setPatchVariable('countdown', (SelfPrims.getPatchVariable('countdown') - 1));
    }
  }
}
function createFences() {
  if (Prims.equality(StrictMath.abs(SelfPrims.getPatchVariable('pxcor')), world.topology.maxPxcor)) {
    SelfPrims.setPatchVariable('pcolor', 15);
  }
  if (Prims.equality(StrictMath.abs(SelfPrims.getPatchVariable('pycor')), world.topology.maxPycor)) {
    SelfPrims.setPatchVariable('pcolor', 15);
  }
  if ((Prims.equality(SelfPrims.getPatchVariable('pxcor'), 0) && world.observer.getGlobal('fence?'))) {
    SelfPrims.setPatchVariable('pcolor', 15);
  }
}
function setupHistogram() {
  plotManager.setCurrentPlot("cc--cC--CC");
  plotManager.setXRange(-0.5, 2.5);
  plotManager.setYRange(0, world.observer.getGlobal('initial-number-sheep'));
  plotManager.setHistogramBarCount(3);
}
function doPlot() {
  plotManager.setCurrentPlot("populations");
  plotManager.setCurrentPen("white sheep");
  plotManager.plotValue(world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable('color'), 9.9);
  }).size());
  plotManager.setCurrentPen("blue mutation");
  plotManager.plotValue(world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable('color'), 85);
  }).size());
  plotManager.setCurrentPlot("cc--cC--CC");
  plotManager.drawHistogramFrom(world.turtles().projectionBy(function() {
    return (SelfPrims.getVariable('genec') + SelfPrims.getVariable('gened'));
  }));
}
world.observer.setGlobal('initial-number-sheep', 100);
world.observer.setGlobal('grass-regrowth-rate', 80);
world.observer.setGlobal('selection?', true);
world.observer.setGlobal('number-added', 9);
world.observer.setGlobal('fussyfemales?', false);
      session.startLoop()
    </script>
  

</body></html>