



<html>
  <head>
<link rel="stylesheet" type="text/css" href="app.css" charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="app-custom.css" charset="utf-8"/>
  </head>
  <body>
    <div id="model-container"></div>
<script type="text/javascript" src="app.js"></script>
    <script type="text/javascript">
;

      var session =
        (function () {
          var widgets = [{"left":339,"top":10,"right":677,"bottom":369,"patchSize":8.0,"fontSize":14,"wrappingAllowedInX":true,"wrappingAllowedInY":true,"minPxcor":-20,"maxPxcor":20,"minPycor":-20,"maxPycor":20,"updateMode":"Continuous","showTickCounter":true,"tickCounterLabel":"ticks","frameRate":30.0,"type":"view"},{"display":"initial-number","left":165,"top":10,"right":323,"bottom":43,"varName":"initial-number","min":"0","max":"250","default":100.0,"step":"1","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"250"},"compiledStep":{"success":true,"result":"1"}},{"display":"gain-from-food","left":166,"top":78,"right":322,"bottom":111,"varName":"gain-from-food","min":"0.0","max":"4","default":2.0,"step":"0.5","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"4"},"compiledStep":{"success":true,"result":"0.5"}},{"display":"grass-regrowth-rate","left":165,"top":44,"right":323,"bottom":77,"varName":"grass-regrowth-rate","min":"5","max":"95","default":80.0,"step":"5","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"5"},"compiledMax":{"success":true,"result":"95"},"compiledStep":{"success":true,"result":"5"}},{"display":"setup","left":49,"top":10,"right":118,"bottom":43,"source":"setup","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(setup);"}},{"display":"go once","left":38,"top":51,"right":119,"bottom":84,"source":"go","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"Teeth Average","left":301,"top":390,"right":497,"bottom":610,"xAxis":"time","yAxis":"teeth","xmin":0.0,"xmax":20.0,"ymin":0.8,"ymax":1.2,"autoPlotOn":true,"legendOn":true,"setupCode":"","updateCode":"","pens":[{"display":"teeth","interval":1.0,"mode":0,"color":-16777216,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}}],"type":"plot","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"sheep","left":70,"top":302,"right":120,"bottom":347,"source":"count turtles","precision":3,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.turtles().size()"}},{"display":"year","left":11,"top":302,"right":61,"bottom":347,"source":"year","precision":0,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.observer.getGlobal(\"year\")"}},{"display":"Each year, reduce the herd by remove-number, chosen from those with best teeth","left":15,"top":207,"right":157,"bottom":266,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"go/stop","left":41,"top":93,"right":123,"bottom":126,"source":"go","forever":true,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"selection?","left":183,"top":160,"right":301,"bottom":193,"varName":"selection?","on":false,"type":"switch"},{"display":"worse-avg-better","left":508,"top":390,"right":675,"bottom":610,"xAxis":null,"yAxis":null,"xmin":-0.5,"xmax":2.5,"ymin":0.0,"ymax":100.0,"autoPlotOn":true,"legendOn":false,"setupCode":"","updateCode":"","pens":[{"display":"default","interval":1.0,"mode":1,"color":-16777216,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}}],"type":"plot","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"Teeth Average","left":134,"top":304,"right":224,"bottom":349,"source":"teeth-avg","precision":2,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.observer.getGlobal(\"teeth-avg\")"}},{"display":"remove-number","left":175,"top":215,"right":301,"bottom":248,"varName":"remove-number","min":"0","max":"10","default":0.0,"step":"1","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"10"},"compiledStep":{"success":true,"result":"1"}},{"display":"if selection? is ON, animals with better teeth get more energy from grass","left":14,"top":156,"right":164,"bottom":204,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"Teeth type percentage","left":10,"top":390,"right":290,"bottom":610,"xAxis":null,"yAxis":null,"xmin":0.0,"xmax":100.0,"ymin":0.0,"ymax":100.0,"autoPlotOn":true,"legendOn":true,"setupCode":"","updateCode":"","pens":[{"display":"better teeth","interval":1.0,"mode":0,"color":-2674135,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"average teeth","interval":1.0,"mode":0,"color":-6459832,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"worse teeth","interval":1.0,"mode":0,"color":-16777216,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}}],"type":"plot","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"better teeth = 1.2\nstandard teeth = 1\nworse teeth = 0.8","left":232,"top":304,"right":340,"bottom":360,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"birthrate-%","left":166,"top":115,"right":322,"bottom":148,"varName":"birthrate-%","min":"0","max":"100","default":100.0,"step":"1","direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"100"},"compiledStep":{"success":true,"result":"1"}}];
          var code    = "globals [ year   year-length  fence?  grass? teeth-avg]\nbreed [ males ]\nbreed [ females ]\n\nturtles-own [ energy  teeth  age ]\nmales-own [  geneA geneB geneC geneD ]     \n    ;; A and B are the two chromosomes that have the teeth allele on them.\n    ;; C and D are the two chromosomes with some other allele on them.         \nfemales-own [   geneA geneB geneC geneD  ]  ;;\npatches-own [ countdown ]\n  \n  to startup\n  setup\n  end\n  \nto setup \n  clear-all\n  set year 0\n  set year-length 12\n  ask patches [ set pcolor green ]\n  set fence? false    ;;this is not in use\n  set grass? true ;; grass is always on\n  if grass? [\n      ;; indicates whether the grass switch is on  \n      ;; if it is true, then grass grows and the sheep eat it  \n      ;; if it false, then the sheep don't need to eat  \n    ask patches [\n      set countdown random (101 - grass-regrowth-rate) ;; initialize grass grow clocks randomly\n      if (random 2) = 0  ;;half the patches start out with grass\n          [ set pcolor brown ]\n    ]\n  ]\n    ask patches [create-fences]\n    \n  set-default-shape females \"ewes\"\n  set-default-shape males \"rams2\"\n  create-males (initial-number / 2)  ;; create the males, then initialize their variables\n  [ \n    set color white\n    set size 3\n    set age random 5\n    set energy random (2 * gain-from-food)\n    setxy random-float world-width\n          random-float world-height\n    repeat 6 [if pcolor = red [rt 90 fd 3 ]]\n;;set each gene to 0 or 1, randomly \n    set geneA random 2\n    set geneB random 2\n    set geneC random 2\n    set geneD random 2\n  ] \n  \n    create-females (initial-number / 2)  ;; create the females, then initialize their variables\n  [ \n    set color white\n    set size 3\n    set age random 5\n    set energy random (2 * gain-from-food)\n    setxy random-float world-width\n          random-float world-height\n    if pcolor = red [rt 180 fd 1] \n    repeat 6 [if pcolor = red [rt 90 fd 3 ]]\n;;set each gene to 0 or 1, randomly \n    set geneA random 2\n    set geneB random 2\n    set geneC random 2\n    set geneD random 2\n]  \n\n;;if selection? = true, make better teeth dominant (TT = best teeth, tT, Tt = better teeth; tt = worse teeth)\n;; if selection? = false, the teeth size doesn't affect energy from eating\n  ask turtles [ \n      if (geneA + geneB = 2)   [set teeth 1.2]   ;; TT condition\n      if (geneA + geneB = 1)   [set teeth 1.0]   ;; tT and Tt condition\n      if (geneA + geneB = 0)   [set teeth 0.8]   ;; tt condition\n\n      ]\n  ;;display-labels\n  set teeth-avg (sum [teeth] of turtles) / count turtles\n  setup-histogram\n  do-plot\nend\n\nto go\n;   ask patches [\n;      if pxcor = 0 and (abs pycor  < screen-edge-y)\n;         [if fence?  [set pcolor red] ]    \n;        ]\n  repeat year-length [\n  ask males [\n        move\n        eat-grass\n        death\n        ] \n  \n    ask females [\n        move\n        eat-grass \n        death\n        ]\n        \n    if grass? [ ask patches [ grow-grass ] ]\n    ask turtles [set size 3 * teeth]\n    display\n    ] \n    \n    ask males  [ \n      set age age + 1\n    ]\n    \n    ask females [\n      set age age + 1 \n      if age > 1 and age <= 6 [reproduce]\n    ]\n   ;; if auto-reap?  [reaper]\n    set year year + 1\n    if count turtles >  0 [\n    set teeth-avg (sum [teeth] of turtles) / count turtles\n    do-plot ] ;; plot populations\n    remove-some\n ;;   ask turtles [set size (teeth * 2)]\n  if not any? turtles [ stop ]\nend\n\nto move  ;; turtle procedure\n  rt random-float 50 - random-float 50\n  fd 1\n  if pcolor = red [rt 180 fd 1] \nend\n\nto eat-grass  ;; turtle procedure\n  ;; sheep eat grass, turn the patch brown\n  if grass? [\n      set energy energy - 1 ;; deduct energy for sheep only if grass? switch is on\n      \n    if pcolor = green [ \n      set pcolor brown \n      ifelse selection? ;;no selection pressure on teeth if selection? = false\n        [set energy energy + (gain-from-food * teeth) ] ;; sheep gain more energy if they have better teeth\n        [set energy energy + (gain-from-food * 1) ] ;; all sheep gain the same energy\n     ] ]\nend\n\nto reproduce\n  if random 100 < birthrate-%\n    [ breed-and-birth ] ;; females mate with any ram in the whole field, \"birth-rate\" percent of the time \nend\n\nto breed-and-birth ;; turtle procedure\n  if count males > 0 [  ;; use this to prevent a runtime error if the population is near to extinction\n    hatch 1 [\n    fd 10\n    set age 0\n    set energy 3\n    ifelse (random 2 = 1) \n      [set breed males ] \n      [set breed females ]\n \n ;; geneA and geneB match the mother's by default. Choose baby's geneA to match one\n ;; of mother's genes.\n    ifelse (random 2 = 1) ;;\n      [set geneA geneA ];; same as mother's first chromosome\n      [set geneA geneB];; same as mother's second chromosome\n      \n;;; set geneB to match one of father's genes.\n    ifelse (random 2 = 1)\n      [set geneB [geneA] of one-of males]\n      [set geneB [geneB] of one-of males]\n  ;; T is dominant for better teeth\n      if (geneA + geneB = 2)   [set teeth 1.2]   ;; TT condition\n      if (geneA + geneB = 1)   [set teeth 1.0]   ;; tT and Tt condition\n      if (geneA + geneB = 0)   [set teeth 0.8]   ;; tt condition\n     ] ]\nend\n\nto remove-some\n   ifelse ((count turtles with [teeth = 1.2]) > remove-number) [\n   ask n-of remove-number turtles with [teeth = 1.2] [die]\n   ]\n   [ask turtles with [teeth = 1.2] [die]]\nend\n\n\nto death  ;; turtle procedure\n  ;; when energy dips below zero, or sheep gets old, die\n  if energy < 0 [ die ] \n  if age > 6 [die ]\nend\n\nto grow-grass  ;; patch procedure\n  ;; countdown on brown patches, if reach 0, grow some grass\n  if pcolor = brown [ \n    ifelse countdown <= 0\n      [ set pcolor green\n        set countdown (102 - grass-regrowth-rate) ] \n      [ set countdown (countdown - 1) ] \n  ] \nend\n\n\nto create-fences; patch procedure\nif (abs pxcor) = max-pxcor   [set pcolor red]\nif (abs pycor) = max-pycor [set pcolor red]\nif pxcor = 0 and fence? [set pcolor red]\nend\n\nto setup-histogram\n ; set-current-plot \"alleles: tt--tT--TT\"\n ; set-plot-x-range -.5  2.5\n ; set-plot-y-range 0 initial-number-sheep\n ; set-histogram-num-bars 3\nend\n\nto do-plot \n  set-current-plot \"Teeth Average\"\n  set-current-plot-pen \"teeth\" \n    plot teeth-avg\n   \n  set-current-plot \"worse-avg-better\"\n  histogram [(geneA + geneB)] of  turtles   \n  \n  set-current-plot \"teeth type percentage\"\n  set-current-plot-pen \"better teeth\"\n    plot 100 * (count turtles with [teeth = 1.2]) / count turtles\n      set-current-plot-pen \"average teeth\"\n    plot 100 * (count turtles with [teeth = 1.0]) / count turtles\n     set-current-plot-pen \"worse teeth\"\n    plot 100 * (count turtles with [teeth = 0.8]) / count turtles\n \n    \nend\n";
          var info    = "\n		Evolution:  Sheep-selection\n This is a model of a flock of sheep whose survival depends on eating grass. The babies inherit traits from their parents according to Mendelian genetics. One can study the effect on the population of a trait that changes the energy they get from eating grass.\n\nHere are are some explorations:  \n1. Picture yourself as a farmer with a large field of sheep. You start with an equal number of males (horns) and females (no horns). They live for six years. The sheep move around the field and eat grass, which grows back at a certain rate. The patch is green if there is grass there, and brown if there is no grass. In the model, the sheep move and eat during each year. They use up energy as they move, and they gain energy from eating grass. If their energy goes to zero, they die. \n\n2. The sheep have one variable trait ï¿½ the quality of their teeth. The ones with better teeth get more energy from the grass they eat, so they are less likely to lose energy and die as they wander around the field. This trait is turned on if SELECTION? = ON. It has no effect if SELECTION? = OFF.   \nThere are three levels of teeth:  \nTEETH = 1.2		better  \nTEETH = 1.0		standard	  \nTEETH = 0.8		worse	\n\n3. Once a year, from age 3 to age 6, each female mates with a randomly chosen male and gives birth to a baby. The baby inherits its TEETH trait from both its parents. \n\n4. If SELECTION? = ON, what do you think will happen to the average value of TEETH over time?\n\n5. if SELECTION? = OFF, what do you think will happen to the average value of TEETH over time?\n\n6. Run the model several times with the initial settings. Make sure SELECTION? = OFF. Note that the average value of TEETH, which is shown in the monitor above the graph, starts at 1.0.Watch the three graphs and notice what happens to the proportions of better, standard, and worse teeth. Also record the average value of TEETH after 50 years.\n\nRun #	Value of TEETH after 50 years  \n1	  \n2	  \n3	  \n4	\n\n7. What can you conclude about evolution of teeth in the herd?\n\n8. Why do you think itï¿½s not the same every time?\n\n9. Set SELECTION? = ON. Now sheep with better teeth will get more food from grass and have less chance of starving to death. Run the model several times. Watch the three graphs and notice what happens to the proportions of better, standard, and worse teeth. Also record the average value of TEETH after 50 years.\n\n10.  What can you conclude about the evolution of teeth in the herd?\n\n11.  Hereï¿½s a challenge, designed to test our theory that the sheep population evolves better teeth because the ones with worse teeth starve to death more often. If thatï¿½s true, think about the effect of the value of GRASS-REGROWTH-RATE. As this value decreases (grass grows back more slowly), what would happen to how fast this adaptation becomes predominant in the population?   \na. [   ] Better teeth would evolve more quickly.  \nb. [   ] Better teeth would evolve more slowly.  \nc. [   ] The evolution rate would not change.  \nd. [   ] The result would be unpredictable.\n\n12. Explain your answer.\n\n13. Now test this idea by running the model. Try changing GRASS-REGROWTH-RATE and record the average value of TEETH after 50 years. Keep all of the other variables constant. (INITIAL-NUMBER=100, BIRTHRATE-%=60, GAIN-FROM-FOOD=2)\n\n## GRASS-REGROWTH-\n\nRATE	Value of TEETH after 50 years  \n85	  \n70	  \n55	  \n40	\n\n14. Combine your results with other teams. What can you conclude about the effect of a scarcity of grass on evolution of teeth? \n\nTo watch a mutation in the sheep population, go on to sheep-mutation.";
          return Tortoise.fromCompiledModel('#model-container', widgets, code, info, '', true);
        })();
      var modelConfig  = (typeof window.modelConfig !== "undefined" && window.modelConfig !== null) ? window.modelConfig : {};
var modelPlotOps = (typeof modelConfig.plotOps !== "undefined" && modelConfig.plotOps !== null) ? modelConfig.plotOps : {};

var PenBundle = tortoise_require('engine/plot/pen');
var Plot      = tortoise_require('engine/plot/plot');
var PlotOps   = tortoise_require('engine/plot/plotops');

modelConfig.plots = [(function() {
  var name    = 'Teeth Average';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('teeth', plotOps.makePenOps, false, new PenBundle.State(0.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth Average', 'teeth')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth Average', 'teeth')(function() {}); }); })];
  var setup   = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth Average', undefined)(function() {}); }); };
  var update  = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth Average', undefined)(function() {}); }); };
  return new Plot(name, pens, plotOps, 'time', 'teeth', true, 0.0, 20.0, 0.8, 1.2, setup, update);
})(), (function() {
  var name    = 'worse-avg-better';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('default', plotOps.makePenOps, false, new PenBundle.State(0.0, 1.0, PenBundle.DisplayMode.Bar), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('worse-avg-better', 'default')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('worse-avg-better', 'default')(function() {}); }); })];
  var setup   = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('worse-avg-better', undefined)(function() {}); }); };
  var update  = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('worse-avg-better', undefined)(function() {}); }); };
  return new Plot(name, pens, plotOps, '', '', false, -0.5, 2.5, 0.0, 100.0, setup, update);
})(), (function() {
  var name    = 'Teeth type percentage';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('better teeth', plotOps.makePenOps, false, new PenBundle.State(15.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'better teeth')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'better teeth')(function() {}); }); }),
new PenBundle.Pen('average teeth', plotOps.makePenOps, false, new PenBundle.State(35.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'average teeth')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'average teeth')(function() {}); }); }),
new PenBundle.Pen('worse teeth', plotOps.makePenOps, false, new PenBundle.State(0.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'worse teeth')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'worse teeth')(function() {}); }); })];
  var setup   = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', undefined)(function() {}); }); };
  var update  = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', undefined)(function() {}); }); };
  return new Plot(name, pens, plotOps, '', '', true, 0.0, 100.0, 0.0, 100.0, setup, update);
})()];
if (typeof javax !== "undefined") { modelConfig.output = { clear: function(){}, write: function(str) { context.getWriter().print(str); } } }

var workspace = tortoise_require('engine/workspace')(modelConfig)([{ name: "MALES", singular: "turtle", varNames: ["genea", "geneb", "genec", "gened"] }, { name: "FEMALES", singular: "turtle", varNames: ["genea", "geneb", "genec", "gened"] }])(["energy", "teeth", "age"], [])(["initial-number", "gain-from-food", "grass-regrowth-rate", "selection?", "remove-number", "birthrate-%", "year", "year-length", "fence?", "grass?", "teeth-avg"], ["initial-number", "gain-from-food", "grass-regrowth-rate", "selection?", "remove-number", "birthrate-%"], ["countdown"], -20, 20, -20, 20, 8.0, true, true, {"default":{"rotate":true,"elements":[{"xcors":[150,40,150,260],"ycors":[5,250,205,250],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"ewes":{"rotate":false,"elements":[{"xcors":[91,70,41,16,1,2,23,49,49,58,48,61,85,72,90,122,152,198,190,201,231,215,227,229,220,241,249,252,270,259,239,195,168,140,122],"ycors":[124,96,91,101,127,147,170,175,202,216,248,293,292,251,208,220,220,212,252,287,288,249,186,173,146,153,179,191,189,148,121,116,116,116,123],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[247,218,215,237],"ycors":[175,151,142,144],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[84,135,169,200,198,104,75],"ycors":[218,233,229,224,207,203,203],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[3,12,29,39,63],"ycors":[126,97,88,88,94],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[269,263,247,253],"ycors":[188,212,208,192],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"rams2":{"rotate":false,"elements":[{"xcors":[92,157,238,266,274,270,260,248,229,242,242,232,251,225,204,208,155,92,56,67,39,30,72,59,35,15,3,1,12,47,13,52,78,110,126,129,116,103,111,99,69,64,82,92,126,155,156],"ycors":[102,97,108,146,183,199,197,159,137,184,208,250,292,295,240,195,202,181,206,252,252,199,157,127,125,120,100,68,46,35,47,28,22,25,39,53,73,74,55,39,42,50,66,90,91,97,98],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[69,83,58,57],"ycors":[55,41,40,56],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"sheep":{"rotate":false,"elements":[{"xmin":90,"ymin":75,"xmax":270,"ymax":225,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":15,"y":75,"diam":150,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":81,"ymin":225,"xmax":134,"ymax":286,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":180,"ymin":225,"xmax":238,"ymax":285,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":1,"y":88,"diam":92,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"sheep2":{"rotate":false,"elements":[{"xmin":64,"ymin":116,"xmax":243,"ymax":214,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":244,"ymin":214,"xmax":244,"ymax":215,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":244,"ymin":215,"xmax":245,"ymax":216,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":91,"ymin":220,"xmax":127,"ymax":280,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":221,"xmax":224,"ymax":283,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":221,"xmax":189,"ymax":220,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":12,"y":65,"diam":105,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[129,195,257,246],"ycors":[116,105,124,175],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[258,271,264,251],"ycors":[128,193,195,157],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[58,90,94,76,59,63],"ycors":[69,72,111,118,110,84],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":false},{"xcors":[63,50,76],"ycors":[93,115,117],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":false},{"xcors":[224,190,191],"ycors":[219,218,225],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":190,"ymin":221,"xmax":225,"ymax":226,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":92,"ymin":220,"xmax":127,"ymax":225,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[250,253,264,276,274,257],"ycors":[164,196,198,195,159,128],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"wolf":{"rotate":false,"elements":[{"xmin":15,"ymin":105,"xmax":105,"ymax":165,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":45,"ymin":90,"xmax":105,"ymax":105,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[60,83,104],"ycors":[90,44,90],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[67,82,97],"ycors":[90,59,89],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":48,"ymin":93,"xmax":59,"ymax":105,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xmin":51,"ymin":96,"xmax":55,"ymax":101,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":0,"ymin":121,"xmax":15,"ymax":135,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":15,"ymin":136,"xmax":60,"ymax":151,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xcors":[15,23,31],"ycors":[136,149,136],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xcors":[30,37,43],"ycors":[151,136,151],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xmin":105,"ymin":120,"xmax":263,"ymax":195,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":108,"ymin":195,"xmax":259,"ymax":201,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":114,"ymin":201,"xmax":252,"ymax":210,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":120,"ymin":210,"xmax":243,"ymax":214,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":115,"ymin":114,"xmax":255,"ymax":120,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":128,"ymin":108,"xmax":248,"ymax":114,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":150,"ymin":105,"xmax":225,"ymax":108,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":132,"ymin":214,"xmax":155,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":110,"ymin":260,"xmax":132,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":210,"ymin":214,"xmax":232,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":260,"xmax":210,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x1":263,"y1":127,"x2":281,"y2":155,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":281,"y1":155,"x2":281,"y2":192,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]}}, {"default":{"direction-indicator":{"rotate":true,"elements":[{"x1":150,"y1":150,"x2":90,"y2":180,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":150,"y1":150,"x2":210,"y2":180,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]},"curviness":0.0,"lines":[{"x-offset":-0.2,"is-visible":false,"dash-pattern":[0.0,1.0]},{"x-offset":0.0,"is-visible":true,"dash-pattern":[1.0,0.0]},{"x-offset":0.2,"is-visible":false,"dash-pattern":[0.0,1.0]}]}});

var BreedManager  = workspace.breedManager;
var LayoutManager = workspace.layoutManager;
var LinkPrims     = workspace.linkPrims;
var ListPrims     = workspace.listPrims;
var MousePrims    = workspace.mousePrims;
var plotManager   = workspace.plotManager;
var Prims         = workspace.prims;
var PrintPrims    = workspace.printPrims;
var OutputPrims   = workspace.outputPrims;
var SelfPrims     = workspace.selfPrims;
var SelfManager   = workspace.selfManager;
var Updater       = workspace.updater;
var world         = workspace.world;

var Call           = tortoise_require('util/call');
var Exception      = tortoise_require('util/exception');
var NLMath         = tortoise_require('util/nlmath');
var notImplemented = tortoise_require('util/notimplemented');

var Dump      = tortoise_require('engine/dump');
var ColorModel = tortoise_require('engine/core/colormodel');
var Link      = tortoise_require('engine/core/link');
var LinkSet   = tortoise_require('engine/core/linkset');
var Nobody    = tortoise_require('engine/core/nobody');
var PatchSet  = tortoise_require('engine/core/patchset');
var Turtle    = tortoise_require('engine/core/turtle');
var TurtleSet = tortoise_require('engine/core/turtleset');
var NLType    = tortoise_require('engine/core/typechecker');
var Tasks     = tortoise_require('engine/prim/tasks');

var AgentModel = tortoise_require('agentmodel');
var Meta       = tortoise_require('meta');
var Random     = tortoise_require('shim/random');
var StrictMath = tortoise_require('shim/strictmath');
function startup() {
  Call(setup);
}
function setup() {
  world.clearAll();
  world.observer.setGlobal("year", 0);
  world.observer.setGlobal("year-length", 12);
  world.patches().ask(function() {
    SelfPrims.setPatchVariable("pcolor", 55);
  }, true);
  world.observer.setGlobal("fence?", false);
  world.observer.setGlobal("grass?", true);
  if (world.observer.getGlobal("grass?")) {
    world.patches().ask(function() {
      SelfPrims.setPatchVariable("countdown", Prims.random((101 - world.observer.getGlobal("grass-regrowth-rate"))));
      if (Prims.equality(Prims.random(2), 0)) {
        SelfPrims.setPatchVariable("pcolor", 35);
      }
    }, true);
  }
  world.patches().ask(function() {
    Call(createFences);
  }, true);
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("FEMALES").getBreedName(), "ewes")
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("MALES").getBreedName(), "rams2")
  world.turtleManager.createTurtles((world.observer.getGlobal("initial-number") / 2), "MALES").ask(function() {
    SelfPrims.setVariable("color", 9.9);
    SelfPrims.setVariable("size", 3);
    SelfPrims.setVariable("age", Prims.random(5));
    SelfPrims.setVariable("energy", Prims.random((2 * world.observer.getGlobal("gain-from-food"))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    for (var _index_1387_1393 = 0, _repeatcount_1387_1393 = StrictMath.floor(6); _index_1387_1393 < _repeatcount_1387_1393; _index_1387_1393++){
      if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
        SelfPrims.right(90);
        SelfPrims.fd(3);
      }
    }
    SelfPrims.setVariable("genea", Prims.random(2));
    SelfPrims.setVariable("geneb", Prims.random(2));
    SelfPrims.setVariable("genec", Prims.random(2));
    SelfPrims.setVariable("gened", Prims.random(2));
  }, true);
  world.turtleManager.createTurtles((world.observer.getGlobal("initial-number") / 2), "FEMALES").ask(function() {
    SelfPrims.setVariable("color", 9.9);
    SelfPrims.setVariable("size", 3);
    SelfPrims.setVariable("age", Prims.random(5));
    SelfPrims.setVariable("energy", Prims.random((2 * world.observer.getGlobal("gain-from-food"))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
      SelfPrims.right(180);
      SelfPrims.fd(1);
    }
    for (var _index_1875_1881 = 0, _repeatcount_1875_1881 = StrictMath.floor(6); _index_1875_1881 < _repeatcount_1875_1881; _index_1875_1881++){
      if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
        SelfPrims.right(90);
        SelfPrims.fd(3);
      }
    }
    SelfPrims.setVariable("genea", Prims.random(2));
    SelfPrims.setVariable("geneb", Prims.random(2));
    SelfPrims.setVariable("genec", Prims.random(2));
    SelfPrims.setVariable("gened", Prims.random(2));
  }, true);
  world.turtles().ask(function() {
    if (Prims.equality((SelfPrims.getVariable("genea") + SelfPrims.getVariable("geneb")), 2)) {
      SelfPrims.setVariable("teeth", 1.2);
    }
    if (Prims.equality((SelfPrims.getVariable("genea") + SelfPrims.getVariable("geneb")), 1)) {
      SelfPrims.setVariable("teeth", 1);
    }
    if (Prims.equality((SelfPrims.getVariable("genea") + SelfPrims.getVariable("geneb")), 0)) {
      SelfPrims.setVariable("teeth", 0.8);
    }
  }, true);
  world.observer.setGlobal("teeth-avg", (ListPrims.sum(world.turtles().projectionBy(function() {
    return SelfPrims.getVariable("teeth");
  })) / world.turtles().size()));
  Call(setupHistogram);
  Call(doPlot);
}
function go() {
  for (var _index_2707_2713 = 0, _repeatcount_2707_2713 = StrictMath.floor(world.observer.getGlobal("year-length")); _index_2707_2713 < _repeatcount_2707_2713; _index_2707_2713++){
    world.turtleManager.turtlesOfBreed("MALES").ask(function() {
      Call(move);
      Call(eatGrass);
      Call(death);
    }, true);
    world.turtleManager.turtlesOfBreed("FEMALES").ask(function() {
      Call(move);
      Call(eatGrass);
      Call(death);
    }, true);
    if (world.observer.getGlobal("grass?")) {
      world.patches().ask(function() {
        Call(growGrass);
      }, true);
    }
    world.turtles().ask(function() {
      SelfPrims.setVariable("size", (3 * SelfPrims.getVariable("teeth")));
    }, true);
    notImplemented('display', undefined)();
  }
  world.turtleManager.turtlesOfBreed("MALES").ask(function() {
    SelfPrims.setVariable("age", (SelfPrims.getVariable("age") + 1));
  }, true);
  world.turtleManager.turtlesOfBreed("FEMALES").ask(function() {
    SelfPrims.setVariable("age", (SelfPrims.getVariable("age") + 1));
    if ((Prims.gt(SelfPrims.getVariable("age"), 1) && Prims.lte(SelfPrims.getVariable("age"), 6))) {
      Call(reproduce);
    }
  }, true);
  world.observer.setGlobal("year", (world.observer.getGlobal("year") + 1));
  if (Prims.gt(world.turtles().size(), 0)) {
    world.observer.setGlobal("teeth-avg", (ListPrims.sum(world.turtles().projectionBy(function() {
      return SelfPrims.getVariable("teeth");
    })) / world.turtles().size()));
    Call(doPlot);
  }
  Call(removeSome);
  if (!world.turtles().nonEmpty()) {
    throw new Exception.StopInterrupt;
  }
}
function move() {
  SelfPrims.right((Prims.randomFloat(50) - Prims.randomFloat(50)));
  SelfPrims.fd(1);
  if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 15)) {
    SelfPrims.right(180);
    SelfPrims.fd(1);
  }
}
function eatGrass() {
  if (world.observer.getGlobal("grass?")) {
    SelfPrims.setVariable("energy", (SelfPrims.getVariable("energy") - 1));
    if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 55)) {
      SelfPrims.setPatchVariable("pcolor", 35);
      if (world.observer.getGlobal("selection?")) {
        SelfPrims.setVariable("energy", (SelfPrims.getVariable("energy") + (world.observer.getGlobal("gain-from-food") * SelfPrims.getVariable("teeth"))));
      }
      else {
        SelfPrims.setVariable("energy", (SelfPrims.getVariable("energy") + (world.observer.getGlobal("gain-from-food") * 1)));
      }
    }
  }
}
function reproduce() {
  if (Prims.lt(Prims.random(100), world.observer.getGlobal("birthrate-%"))) {
    Call(breedAndBirth);
  }
}
function breedAndBirth() {
  if (Prims.gt(world.turtleManager.turtlesOfBreed("MALES").size(), 0)) {
    SelfPrims.hatch(1, "").ask(function() {
      SelfPrims.fd(10);
      SelfPrims.setVariable("age", 0);
      SelfPrims.setVariable("energy", 3);
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable("breed", world.turtleManager.turtlesOfBreed("MALES"));
      }
      else {
        SelfPrims.setVariable("breed", world.turtleManager.turtlesOfBreed("FEMALES"));
      }
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable("genea", SelfPrims.getVariable("genea"));
      }
      else {
        SelfPrims.setVariable("genea", SelfPrims.getVariable("geneb"));
      }
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable("geneb", ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES")).projectionBy(function() {
          return SelfPrims.getVariable("genea");
        }));
      }
      else {
        SelfPrims.setVariable("geneb", ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES")).projectionBy(function() {
          return SelfPrims.getVariable("geneb");
        }));
      }
      if (Prims.equality((SelfPrims.getVariable("genea") + SelfPrims.getVariable("geneb")), 2)) {
        SelfPrims.setVariable("teeth", 1.2);
      }
      if (Prims.equality((SelfPrims.getVariable("genea") + SelfPrims.getVariable("geneb")), 1)) {
        SelfPrims.setVariable("teeth", 1);
      }
      if (Prims.equality((SelfPrims.getVariable("genea") + SelfPrims.getVariable("geneb")), 0)) {
        SelfPrims.setVariable("teeth", 0.8);
      }
    }, true);
  }
}
function removeSome() {
  if (Prims.gt(world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable("teeth"), 1.2);
  }).size(), world.observer.getGlobal("remove-number"))) {
    ListPrims.nOf(world.observer.getGlobal("remove-number"), world.turtles().agentFilter(function() {
      return Prims.equality(SelfPrims.getVariable("teeth"), 1.2);
    })).ask(function() {
      SelfPrims.die();
    }, true);
  }
  else {
    world.turtles().agentFilter(function() {
      return Prims.equality(SelfPrims.getVariable("teeth"), 1.2);
    }).ask(function() {
      SelfPrims.die();
    }, true);
  }
}
function death() {
  if (Prims.lt(SelfPrims.getVariable("energy"), 0)) {
    SelfPrims.die();
  }
  if (Prims.gt(SelfPrims.getVariable("age"), 6)) {
    SelfPrims.die();
  }
}
function growGrass() {
  if (Prims.equality(SelfPrims.getPatchVariable("pcolor"), 35)) {
    if (Prims.lte(SelfPrims.getPatchVariable("countdown"), 0)) {
      SelfPrims.setPatchVariable("pcolor", 55);
      SelfPrims.setPatchVariable("countdown", (102 - world.observer.getGlobal("grass-regrowth-rate")));
    }
    else {
      SelfPrims.setPatchVariable("countdown", (SelfPrims.getPatchVariable("countdown") - 1));
    }
  }
}
function createFences() {
  if (Prims.equality(NLMath.abs(SelfPrims.getPatchVariable("pxcor")), world.topology.maxPxcor)) {
    SelfPrims.setPatchVariable("pcolor", 15);
  }
  if (Prims.equality(NLMath.abs(SelfPrims.getPatchVariable("pycor")), world.topology.maxPycor)) {
    SelfPrims.setPatchVariable("pcolor", 15);
  }
  if ((Prims.equality(SelfPrims.getPatchVariable("pxcor"), 0) && world.observer.getGlobal("fence?"))) {
    SelfPrims.setPatchVariable("pcolor", 15);
  }
}
function setupHistogram() {

}
function doPlot() {
  plotManager.setCurrentPlot("Teeth Average");
  plotManager.setCurrentPen("teeth");
  plotManager.plotValue(world.observer.getGlobal("teeth-avg"));
  plotManager.setCurrentPlot("worse-avg-better");
  plotManager.drawHistogramFrom(world.turtles().projectionBy(function() {
    return (SelfPrims.getVariable("genea") + SelfPrims.getVariable("geneb"));
  }));
  plotManager.setCurrentPlot("teeth type percentage");
  plotManager.setCurrentPen("better teeth");
  plotManager.plotValue(((100 * world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable("teeth"), 1.2);
  }).size()) / world.turtles().size()));
  plotManager.setCurrentPen("average teeth");
  plotManager.plotValue(((100 * world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable("teeth"), 1);
  }).size()) / world.turtles().size()));
  plotManager.setCurrentPen("worse teeth");
  plotManager.plotValue(((100 * world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable("teeth"), 0.8);
  }).size()) / world.turtles().size()));
}
world.observer.setGlobal("initial-number", 100);
world.observer.setGlobal("gain-from-food", 2);
world.observer.setGlobal("grass-regrowth-rate", 80);
world.observer.setGlobal("selection?", false);
world.observer.setGlobal("remove-number", 0);
world.observer.setGlobal("birthrate-%", 100);
      session.startLoop()
    </script>
<script src='jquery-1.11.3.min.js' type='text/javascript'></script>
<script src='shutterbug-0.5.4.js' type='text/javascript'></script>
<script>
  Shutterbug.enable('body');
</script>
  </body>
</html>
