
<!-- saved from url=(0050)http://li425-91.members.linode.com:9000/save-nlogo -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="app.css" charset="utf-8"/>
  </head>
  <body>
    <div id="model-container"><div class="netlogo-model" style="width: 677;"><div class="netlogo-header"><label class="netlogo-widget netlogo-speed-slider"><span class="netlogo-label">speed</span> <input type="range" min="-1" max="1" step="0.01"></label> <div class="netlogo-powered-by"><a href="http://ccl.northwestern.edu/netlogo/"><img style="vertical-align: middle;" alt="NetLogo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAANcSURBVHjarJRdaFxFFMd/M/dj7252uxubKms+bGprVyIVbNMWWqkQqtLUSpQWfSiV+oVFTcE3DeiDgvoiUSiCYLH2oVoLtQ+iaaIWWtE2FKGkkSrkq5svN+sm7ma/7p3x4W42lEbjQw8MM8yc87/nzPnNFVprbqWJXyMyXuMqx1Ni6N3ny3cX8tOHNLoBUMvESoFI2Xbs4zeO1lzREpSrMSNS1zkBDv6uo1/noz1H7mpvS4SjprAl2AZYEqzKbEowBAgBAkjPKX2599JjT7R0bj412D0JYNplPSBD1G2SmR/e6u1ikEHG2vYiGxoJmxAyIGSCI8GpCItKimtvl2JtfGujDNkX6epuAhCjNeAZxM1ocPy2Qh4toGQ5DLU+ysiuA2S3P0KgJkjAgEAlQylAA64CG/jlUk6//ng4cNWmLK0yOPNMnG99Rs9LQINVKrD+wmke7upg55PrWP3eYcwrlykpKCkoelDy/HVegQhoABNAepbACwjOt72gZkJhypX70YDWEEklue+rbnYc2MiGp1upPfYReiJJUUG58gFXu4udch1wHcjFIgy0HyIjb2yvBpT2F6t+6+f+D15lW8c9JDo7iPSdgVIRLUqL2AyHDQAOf9hfbqxvMF98eT3RuTS1avHyl+Stcphe2chP9+4k/t3RbXVl3W+Ws17FY56/w3VcbO/koS/eZLoAqrQMxADZMTYOfwpwoWjL4+bCYcgssMqGOzPD6CIkZ/3SxTJ0ayFIN6/BnBrZb2XdE1JUgkJWkfrUNRJnPyc16zsbgPyXIUJBpvc+y89nk/S8/4nek3NPGeBWMwzGvhUPnP6RubRLwfODlqqx3LSCyee2MnlwMwA2RwgO5qouVcHmksUdJweYyi8hZkrUjgT5t/ejNq0jBsSqNWsKyT9uFtxw7Bs585d3g46KOeT2bWHmtd14KyP+5mzqpsYU3OyioACMhGiqPTMocsrHId9cy9BLDzKxq8X3ctMwlV6yKSHL4fr4dd0DeQBTBUgUkvpE1kVPbqkX117ZzuSaFf4zyfz5n9A4lk0yNU7vyb7jTy1kmFGipejKvh6h9n0W995ZPTu227hqmCz33xXgFV1v9NzI96NfjndWt7XWCB/7BSICFWL+j3lAofpCtfYFb6X9MwCJZ07mUsXRGwAAAABJRU5ErkJggg=="> <span style="font-size: 16px;">powered by NetLogo</span></a></div></div> <div style="position: relative; width: 677; height: 610" class="netlogo-widget-container"><div class="netlogo-widget netlogo-view-container" style="position: absolute; left: 339px; top: 10px; width: 338px; height: 359px;"><div class="netlogo-widget netlogo-tick-counter">ticks: <span></span></div><div class="view-layers" style="width: 100%; position: relative;"><canvas width="656" height="656" class="patch-view" style="width: 100%; z-index: 0;"></canvas><canvas width="984" height="984" class="turtle-view" style="width: 100%; position: absolute; top: 0px; left: 0px; z-index: 1;"></canvas><canvas width="328" height="328" class="spotlight-view" style="width: 100%; position: absolute; top: 0px; left: 0px; z-index: 2;"></canvas></div></div>              <label class="netlogo-widget netlogo-slider netlogo-input" style="position: absolute; left: 165px; top: 10px; width: 158px; height: 33px;"><input type="range" max="250" min="0" step="1"> <span class="netlogo-label">initial-number</span> <span class="netlogo-value"><input type="number" min="0" max="250" step="1"> </span></label>         <label class="netlogo-widget netlogo-slider netlogo-input" style="position: absolute; left: 166px; top: 78px; width: 156px; height: 33px;"><input type="range" max="4" min="0" step="0.5"> <span class="netlogo-label">gain-from-food</span> <span class="netlogo-value"><input type="number" min="0" max="4" step="0.5"> </span></label>         <label class="netlogo-widget netlogo-slider netlogo-input" style="position: absolute; left: 165px; top: 44px; width: 158px; height: 33px;"><input type="range" max="95" min="5" step="5"> <span class="netlogo-label">grass-regrowth-rate</span> <span class="netlogo-value"><input type="number" min="5" max="95" step="5"> </span></label>       <button class="netlogo-widget netlogo-button netlogo-command" type="button" style="position: absolute; left: 49px; top: 10px; width: 69px; height: 33px;"><span>setup</span></button>         <button class="netlogo-widget netlogo-button netlogo-command" type="button" style="position: absolute; left: 38px; top: 51px; width: 81px; height: 33px;"><span>go once</span></button>               <div class="netlogo-widget netlogo-plot netlogo-plot-0 netlogo-output" style="position: absolute; left: 301px; top: 390px; width: 196px; height: 220px;" data-highcharts-chart="2"><div class="highcharts-container" id="highcharts-4" style="position: relative; overflow: hidden; width: 196px; height: 220px; text-align: left; line-height: normal; z-index: 0; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><svg version="1.1" style="font-family:&quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Arial, Helvetica, sans-serif;font-size:12px;" xmlns="http://www.w3.org/2000/svg" width="196" height="220"><desc>Created with Highcharts 4.0.4</desc><defs><clippath id="highcharts-5"><rect x="0" y="0" width="116" height="78"></rect></clippath></defs><rect x="0" y="0" width="196" height="220" strokeWidth="0" fill="#FFFFFF" class=" highcharts-background"></rect><g class="highcharts-button" style="cursor:default;" stroke-linecap="round" transform="translate(162,10)"><title>Chart context menu</title><rect x="0.5" y="0.5" width="24" height="22" strokeWidth="1" fill="white" stroke="none" stroke-width="1" rx="2" ry="2"></rect><path fill="#E0E0E0" d="M 6 6.5 L 20 6.5 M 6 11.5 L 20 11.5 M 6 16.5 L 20 16.5" stroke="#666" stroke-width="3" zIndex="1"></path><text x="0" zIndex="1" style="color:black;fill:black;" y="13"></text></g><g class="highcharts-grid" zIndex="1"></g><g class="highcharts-grid" zIndex="1"><path fill="none" d="M 70 52.5 L 186 52.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path><path fill="none" d="M 70 92.5 L 186 92.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path><path fill="none" d="M 70 131.5 L 186 131.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path></g><g class="highcharts-axis" zIndex="2"><path fill="none" d="M 127.5 131 L 127.5 141" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 186.5 131 L 186.5 141" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 69.5 131 L 69.5 141" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><text x="128" zIndex="7" text-anchor="middle" transform="translate(0,0)" class=" highcharts-xaxis-title" style="color:#707070;fill:#707070;" visibility="visible" y="173">time</text><path fill="none" d="M 70 131.5 L 186 131.5" stroke="#C0D0E0" stroke-width="1" zIndex="7" visibility="visible"></path></g><g class="highcharts-axis" zIndex="2"><text x="27.59375" zIndex="7" text-anchor="middle" transform="translate(0,0) rotate(270 27.59375 92)" class=" highcharts-yaxis-title" style="color:#707070;fill:#707070;" visibility="visible" y="92">teeth</text></g><g class="highcharts-series-group" zIndex="3"><g class="highcharts-series" visibility="visible" zIndex="0.1" transform="translate(70,53) scale(1 1)" clip-path="url(#highcharts-5)"><path fill="none" d="M 0 0" stroke-linejoin="round" visibility="visible" stroke="rgba(192,192,192,0.0001)" stroke-width="22" zIndex="2" class=" highcharts-tracker" style=""></path></g><g class="highcharts-markers highcharts-tracker" visibility="visible" zIndex="0.1" transform="translate(70,53) scale(1 1)" clip-path="none" style=""></g></g><text x="98" text-anchor="middle" class="highcharts-title" zIndex="4" style="color:#333333;font-size:18px;fill:#333333;width:132px;" y="25"><tspan>Teeth Average</tspan></text><g class="highcharts-legend" zIndex="7" transform="translate(68,184)"><g zIndex="1"><g><g class="highcharts-legend-item" zIndex="1" transform="translate(8,3)"><path fill="none" d="M 0 11 L 16 11" stroke="rgb(3, 3, 3)" stroke-width="2"></path><text x="21" style="color:#333333;font-size:12px;font-weight:bold;cursor:pointer;fill:#333333;" text-anchor="start" zIndex="2" y="15">teeth</text></g></g></g></g><g class="highcharts-axis-labels highcharts-xaxis-labels" zIndex="7"><text x="70" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="151" opacity="1">0</text><text x="128" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="151" opacity="1">10</text><text x="186" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="151" opacity="1">20</text></g><g class="highcharts-axis-labels highcharts-yaxis-labels" zIndex="7"><text x="55" text-anchor="end" style="width:45px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="134.5" opacity="1">0.8</text><text x="55" text-anchor="end" style="width:45px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="95.5" opacity="1">1</text><text x="55" text-anchor="end" style="width:45px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="56.5" opacity="1">1.2</text></g><g class="highcharts-tooltip" zIndex="8" style="cursor:default;padding:0;white-space:nowrap;" transform="translate(0,-9999)"><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.049999999999999996" stroke-width="5" transform="translate(1, 1)"></path><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.09999999999999999" stroke-width="3" transform="translate(1, 1)"></path><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.15" stroke-width="1" transform="translate(1, 1)"></path><path fill="rgba(249, 249, 249, .85)" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0"></path><text x="8" zIndex="1" style="font-size:12px;color:#333333;fill:#333333;" y="21"></text></g></svg></div></div>       <div class="netlogo-widget netlogo-monitor netlogo-output" style="position: absolute; left: 70px; top: 302px; width: 50px; height: 45px;"><div class="netlogo-label">sheep</div> <output class="netlogo-value">0</output></div>         <div class="netlogo-widget netlogo-monitor netlogo-output" style="position: absolute; left: 11px; top: 302px; width: 50px; height: 45px;"><div class="netlogo-label">year</div> <output class="netlogo-value">0</output></div>   <pre class="netlogo-widget netlogo-text-box" style="position: absolute; left: 15px; top: 207px; width: 142px; height: 59px;">Each year, reduce the herd by remove-number, chosen from those with best teeth</pre>            <label class="netlogo-widget netlogo-button netlogo-forever-button  netlogo-command" style="position: absolute; left: 41px; top: 93px; width: 82px; height: 33px;"><input type="checkbox"> <span class="netlogo-label">go/stop</span></label>       <label class="netlogo-widget netlogo-switcher netlogo-input" style="position: absolute; left: 183px; top: 160px; width: 118px; height: 33px;"><input type="checkbox"> <span class="netlogo-label">selection?</span></label>              <div class="netlogo-widget netlogo-monitor netlogo-output" style="position: absolute; left: 134px; top: 304px; width: 90px; height: 45px;"><div class="netlogo-label">Teeth Average</div> <output class="netlogo-value">0</output></div>       <label class="netlogo-widget netlogo-slider netlogo-input" style="position: absolute; left: 175px; top: 215px; width: 126px; height: 33px;"><input type="range" max="10" min="0" step="1"> <span class="netlogo-label">remove-number</span> <span class="netlogo-value"><input type="number" min="0" max="10" step="1"> </span></label>     <pre class="netlogo-widget netlogo-text-box" style="position: absolute; left: 14px; top: 156px; width: 150px; height: 48px;">if selection? is ON, animals with better teeth get more energy from grass</pre>                 <div class="netlogo-widget netlogo-plot netlogo-plot-1 netlogo-output" style="position: absolute; left: 10px; top: 390px; width: 280px; height: 220px;" data-highcharts-chart="3"><div class="highcharts-container" id="highcharts-8" style="position: relative; overflow: hidden; width: 280px; height: 220px; text-align: left; line-height: normal; z-index: 0; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><svg version="1.1" style="font-family:&quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Arial, Helvetica, sans-serif;font-size:12px;" xmlns="http://www.w3.org/2000/svg" width="280" height="220"><desc>Created with Highcharts 4.0.4</desc><defs><clippath id="highcharts-9"><rect x="0" y="0" width="224" height="83"></rect></clippath></defs><rect x="0" y="0" width="280" height="220" strokeWidth="0" fill="#FFFFFF" class=" highcharts-background"></rect><g class="highcharts-button" style="cursor:default;" stroke-linecap="round" transform="translate(246,10)"><title>Chart context menu</title><rect x="0.5" y="0.5" width="24" height="22" strokeWidth="1" fill="white" stroke="none" stroke-width="1" rx="2" ry="2"></rect><path fill="#E0E0E0" d="M 6 6.5 L 20 6.5 M 6 11.5 L 20 11.5 M 6 16.5 L 20 16.5" stroke="#666" stroke-width="3" zIndex="1"></path><text x="0" zIndex="1" style="color:black;fill:black;" y="13"></text></g><g class="highcharts-grid" zIndex="1"></g><g class="highcharts-grid" zIndex="1"><path fill="none" d="M 46 52.5 L 270 52.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path><path fill="none" d="M 46 95.5 L 270 95.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path><path fill="none" d="M 46 136.5 L 270 136.5" stroke="#C0C0C0" stroke-width="1" zIndex="1" opacity="1"></path></g><g class="highcharts-axis" zIndex="2"><path fill="none" d="M 157.5 136 L 157.5 146" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 270.5 136 L 270.5 146" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 45.5 136 L 45.5 146" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 46 136.5 L 270 136.5" stroke="#C0D0E0" stroke-width="1" zIndex="7" visibility="visible"></path></g><g class="highcharts-axis" zIndex="2"></g><g class="highcharts-series-group" zIndex="3"><g class="highcharts-series" visibility="visible" zIndex="0.1" transform="translate(46,53) scale(1 1)" clip-path="url(#highcharts-9)"><path fill="none" d="M 0 0" stroke-linejoin="round" visibility="visible" stroke="rgba(192,192,192,0.0001)" stroke-width="22" zIndex="2" class=" highcharts-tracker" style=""></path></g><g class="highcharts-markers highcharts-tracker" visibility="visible" zIndex="0.1" transform="translate(46,53) scale(1 1)" clip-path="none" style=""></g><g class="highcharts-series" visibility="visible" zIndex="0.1" transform="translate(46,53) scale(1 1)" clip-path="url(#highcharts-9)"><path fill="none" d="M 0 0" stroke-linejoin="round" visibility="visible" stroke="rgba(192,192,192,0.0001)" stroke-width="22" zIndex="2" class=" highcharts-tracker" style=""></path></g><g class="highcharts-markers highcharts-tracker" visibility="visible" zIndex="0.1" transform="translate(46,53) scale(1 1)" clip-path="none" style=""></g><g class="highcharts-series" visibility="visible" zIndex="0.1" transform="translate(46,53) scale(1 1)" clip-path="url(#highcharts-9)"><path fill="none" d="M 0 0" stroke-linejoin="round" visibility="visible" stroke="rgba(192,192,192,0.0001)" stroke-width="22" zIndex="2" class=" highcharts-tracker" style=""></path></g><g class="highcharts-markers highcharts-tracker" visibility="visible" zIndex="0.1" transform="translate(46,53) scale(1 1)" clip-path="none" style=""></g></g><text x="140" text-anchor="middle" class="highcharts-title" zIndex="4" style="color:#333333;font-size:18px;fill:#333333;width:216px;" y="25"><tspan>Teeth type percentage</tspan></text><g class="highcharts-legend" zIndex="7" transform="translate(25,166)"><g zIndex="1"><g><g class="highcharts-legend-item" zIndex="1" transform="translate(8,3)"><path fill="none" d="M 0 11 L 16 11" stroke="rgb(215, 50, 41)" stroke-width="2"></path><text x="21" style="color:#333333;font-size:12px;font-weight:bold;cursor:pointer;fill:#333333;" text-anchor="start" zIndex="2" y="15"><tspan>better teeth</tspan></text></g><g class="highcharts-legend-item" zIndex="1" transform="translate(120.046875,3)"><path fill="none" d="M 0 11 L 16 11" stroke="rgb(157, 110, 72)" stroke-width="2"></path><text x="21" y="15" style="color:#333333;font-size:12px;font-weight:bold;cursor:pointer;fill:#333333;" text-anchor="start" zIndex="2"><tspan>standard teeth</tspan></text></g><g class="highcharts-legend-item" zIndex="1" transform="translate(8,21)"><path fill="none" d="M 0 11 L 16 11" stroke="rgb(3, 3, 3)" stroke-width="2"></path><text x="21" y="15" style="color:#333333;font-size:12px;font-weight:bold;cursor:pointer;fill:#333333;" text-anchor="start" zIndex="2"><tspan>worse teeth</tspan></text></g></g></g></g><g class="highcharts-axis-labels highcharts-xaxis-labels" zIndex="7"><text x="46" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="156" opacity="1">0</text><text x="158" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="156" opacity="1">50</text><text x="269.5625" text-anchor="middle" style="color:#606060;cursor:default;font-size:11px;fill:#606060;" y="156" opacity="1">100</text></g><g class="highcharts-axis-labels highcharts-yaxis-labels" zIndex="7"><text x="31" text-anchor="end" style="width:72px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="139.5" opacity="1">0</text><text x="31" text-anchor="end" style="width:72px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="98" opacity="1">50</text><text x="31" text-anchor="end" style="width:72px;color:#606060;cursor:default;font-size:11px;fill:#606060;" y="56.5" opacity="1">100</text></g><g class="highcharts-tooltip" zIndex="8" style="cursor:default;padding:0;white-space:nowrap;" transform="translate(0,-9999)"><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.049999999999999996" stroke-width="5" transform="translate(1, 1)"></path><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.09999999999999999" stroke-width="3" transform="translate(1, 1)"></path><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0" isShadow="true" stroke="black" stroke-opacity="0.15" stroke-width="1" transform="translate(1, 1)"></path><path fill="rgba(249, 249, 249, .85)" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0"></path><text x="8" zIndex="1" style="font-size:12px;color:#333333;fill:#333333;" y="21"></text></g></svg></div></div>     <label class="netlogo-widget netlogo-slider netlogo-input" style="position: absolute; left: 166px; top: 115px; width: 156px; height: 33px;"><input type="range" max="100" min="0" step="1"> <span class="netlogo-label">birthrate-%</span> <span class="netlogo-value"><input type="number" min="0" max="100" step="1"> </span></label>    </div> <div class="netlogo-tabs"><label class="netlogo-code-tab netlogo-tab netlogo-command "><input type="checkbox"> NetLogo Code</label> <label class="netlogo-info-tab netlogo-tab netlogo-command "><input type="checkbox"> Model Info</label></div> <div class="netlogo-model-text"> </div></div></div>
    <script type="text/string" id="nlogo-code">globals [ year   year-length  fence?  grass? teeth-avg]
breed [ males ]
breed [ females ]

turtles-own [ energy  teeth  age ]
males-own [  geneA geneB geneC geneD ]     
    ;; A and B are the two chromosomes that have the teeth allele on them.
    ;; C and D are the two chromosomes with some other allele on them.         
females-own [   geneA geneB geneC geneD  ]  ;;
patches-own [ countdown ]
  
  to startup
  setup
  end
  
to setup 
  clear-all
  set year 0
  set year-length 12
  ask patches [ set pcolor green ]
  set fence? false    ;;this is not in use
  set grass? true ;; grass is always on
  if grass? [
      ;; indicates whether the grass switch is on  
      ;; if it is true, then grass grows and the sheep eat it  
      ;; if it false, then the sheep don't need to eat  
    ask patches [
      set countdown random (101 - grass-regrowth-rate) ;; initialize grass grow clocks randomly
      if (random 2) = 0  ;;half the patches start out with grass
          [ set pcolor brown ]
    ]
  ]
    ask patches [create-fences]
    
  set-default-shape females "ewes"
  set-default-shape males "rams2"
  create-males (initial-number / 2)  ;; create the males, then initialize their variables
  [ 
    set color white
    set size 3
    set age random 5
    set energy random (2 * gain-from-food)
    setxy random-float world-width
          random-float world-height
    repeat 6 [if pcolor = red [rt 90 fd 3 ]]
;;set each gene to 0 or 1, randomly 
    set geneA random 2
    set geneB random 2
    set geneC random 2
    set geneD random 2
  ] 
  
    create-females (initial-number / 2)  ;; create the females, then initialize their variables
  [ 
    set color white
    set size 3
    set age random 5
    set energy random (2 * gain-from-food)
    setxy random-float world-width
          random-float world-height
    if pcolor = red [rt 180 fd 1] 
    repeat 6 [if pcolor = red [rt 90 fd 3 ]]
;;set each gene to 0 or 1, randomly 
    set geneA random 2
    set geneB random 2
    set geneC random 2
    set geneD random 2
]  

;;if selection? = true, make better teeth dominant (TT = best teeth, tT, Tt = better teeth; tt = worse teeth)
;; if selection? = false, the teeth size doesn't affect energy from eating
  ask turtles [ 
      if (geneA + geneB = 2)   [set teeth 1.2]   ;; TT condition
      if (geneA + geneB = 1)   [set teeth 1.0]   ;; tT and Tt condition
      if (geneA + geneB = 0)   [set teeth 0.8]   ;; tt condition

      ]
  ;;display-labels
  set teeth-avg (sum [teeth] of turtles) / count turtles
  setup-histogram
  do-plot
end

to go
;   ask patches [
;      if pxcor = 0 and (abs pycor  < screen-edge-y)
;         [if fence?  [set pcolor red] ]    
;        ]
  repeat year-length [
  ask males [
        move
        eat-grass
        death
        ] 
  
    ask females [
        move
        eat-grass 
        death
        ]
        
    if grass? [ ask patches [ grow-grass ] ]
    ask turtles [set size 3 * teeth]
    display
    ] 
    
    ask males  [ 
      set age age + 1
    ]
    
    ask females [
      set age age + 1 
      if age > 1 and age <= 6 [reproduce]
    ]
   ;; if auto-reap?  [reaper]
    set year year + 1
    if count turtles >  0 [
    set teeth-avg (sum [teeth] of turtles) / count turtles
    do-plot ] ;; plot populations
    remove-some
 ;;   ask turtles [set size (teeth * 2)]
  if not any? turtles [ stop ]
end

to move  ;; turtle procedure
  rt random-float 50 - random-float 50
  fd 1
  if pcolor = red [rt 180 fd 1] 
end

to eat-grass  ;; turtle procedure
  ;; sheep eat grass, turn the patch brown
  if grass? [
      set energy energy - 1 ;; deduct energy for sheep only if grass? switch is on
      
    if pcolor = green [ 
      set pcolor brown 
      ifelse selection? ;;no selection pressure on teeth if selection? = false
        [set energy energy + (gain-from-food * teeth) ] ;; sheep gain more energy if they have better teeth
        [set energy energy + (gain-from-food * 1) ] ;; all sheep gain the same energy
     ] ]
end

to reproduce
  if random 100 < birthrate-%
    [ breed-and-birth ] ;; females mate with any ram in the whole field, "birth-rate" percent of the time 
end

to breed-and-birth ;; turtle procedure
  if count males > 0 [  ;; use this to prevent a runtime error if the population is near to extinction
    hatch 1 [
    fd 10
    set age 0
    set energy 3
    ifelse (random 2 = 1) 
      [set breed males ] 
      [set breed females ]
 
 ;; geneA and geneB match the mother's by default. Choose baby's geneA to match one
 ;; of mother's genes.
    ifelse (random 2 = 1) ;;
      [set geneA geneA ];; same as mother's first chromosome
      [set geneA geneB];; same as mother's second chromosome
      
;;; set geneB to match one of father's genes.
    ifelse (random 2 = 1)
      [set geneB [geneA] of one-of males]
      [set geneB [geneB] of one-of males]
  ;; T is dominant for better teeth
      if (geneA + geneB = 2)   [set teeth 1.2]   ;; TT condition
      if (geneA + geneB = 1)   [set teeth 1.0]   ;; tT and Tt condition
      if (geneA + geneB = 0)   [set teeth 0.8]   ;; tt condition
     ] ]
end

to remove-some
   ifelse ((count turtles with [teeth = 1.2]) > remove-number) [
   ask n-of remove-number turtles with [teeth = 1.2] [die]
   ]
   [ask turtles with [teeth = 1.2] [die]]
end


to death  ;; turtle procedure
  ;; when energy dips below zero, or sheep gets old, die
  if energy < 0 [ die ] 
  if age > 6 [die ]
end

to grow-grass  ;; patch procedure
  ;; countdown on brown patches, if reach 0, grow some grass
  if pcolor = brown [ 
    ifelse countdown <= 0
      [ set pcolor green
        set countdown (102 - grass-regrowth-rate) ] 
      [ set countdown (countdown - 1) ] 
  ] 
end


to create-fences; patch procedure
if (abs pxcor) = max-pxcor   [set pcolor red]
if (abs pycor) = max-pycor [set pcolor red]
if pxcor = 0 and fence? [set pcolor red]
end

to setup-histogram
 ; set-current-plot "alleles: tt--tT--TT"
 ; set-plot-x-range -.5  2.5
 ; set-plot-y-range 0 initial-number-sheep
 ; set-histogram-num-bars 3
end

to do-plot 
  set-current-plot "Teeth Average"
  set-current-plot-pen "teeth" 
    plot teeth-avg  
  
  set-current-plot "teeth type percentage"
  set-current-plot-pen "better teeth"
    plot 100 * (count turtles with [teeth = 1.2]) / count turtles
      set-current-plot-pen "standard teeth"
    plot 100 * (count turtles with [teeth = 1.0]) / count turtles
     set-current-plot-pen "worse teeth"
    plot 100 * (count turtles with [teeth = 0.8]) / count turtles
 
    
end</script>
    <script type="text/string" id="nlogo-info">
		Evolution:  Sheep-selection
 This is a model of a flock of sheep whose survival depends on eating grass. The babies inherit traits from their parents according to Mendelian genetics. One can study the effect on the population of a trait that changes the energy they get from eating grass.

Here are are some explorations:  
1. Picture yourself as a farmer with a large field of sheep. You start with an equal number of males (horns) and females (no horns). They live for six years. The sheep move around the field and eat grass, which grows back at a certain rate. The patch is green if there is grass there, and brown if there is no grass. In the model, the sheep move and eat during each year. They use up energy as they move, and they gain energy from eating grass. If their energy goes to zero, they die. 

2. The sheep have one variable trait ï¿½ the quality of their teeth. The ones with better teeth get more energy from the grass they eat, so they are less likely to lose energy and die as they wander around the field. This trait is turned on if SELECTION? = ON. It has no effect if SELECTION? = OFF.   
There are three levels of teeth:  
TEETH = 1.2		better  
TEETH = 1.0		standard	  
TEETH = 0.8		worse	

3. Once a year, from age 3 to age 6, each female mates with a randomly chosen male and gives birth to a baby. The baby inherits its TEETH trait from both its parents. 

4. If SELECTION? = ON, what do you think will happen to the average value of TEETH over time?

5. if SELECTION? = OFF, what do you think will happen to the average value of TEETH over time?

6. Run the model several times with the initial settings. Make sure SELECTION? = OFF. Note that the average value of TEETH, which is shown in the monitor above the graph, starts at 1.0.Watch the three graphs and notice what happens to the proportions of better, standard, and worse teeth. Also record the average value of TEETH after 50 years.

Run #	Value of TEETH after 50 years  
1	  
2	  
3	  
4	

7. What can you conclude about evolution of teeth in the herd?

8. Why do you think itï¿½s not the same every time?

9. Set SELECTION? = ON. Now sheep with better teeth will get more food from grass and have less chance of starving to death. Run the model several times. Watch the three graphs and notice what happens to the proportions of better, standard, and worse teeth. Also record the average value of TEETH after 50 years.

10.  What can you conclude about the evolution of teeth in the herd?

11.  Hereï¿½s a challenge, designed to test our theory that the sheep population evolves better teeth because the ones with worse teeth starve to death more often. If thatï¿½s true, think about the effect of the value of GRASS-REGROWTH-RATE. As this value decreases (grass grows back more slowly), what would happen to how fast this adaptation becomes predominant in the population?   
a. [   ] Better teeth would evolve more quickly.  
b. [   ] Better teeth would evolve more slowly.  
c. [   ] The evolution rate would not change.  
d. [   ] The result would be unpredictable.

12. Explain your answer.

13. Now test this idea by running the model. Try changing GRASS-REGROWTH-RATE and record the average value of TEETH after 50 years. Keep all of the other variables constant. (INITIAL-NUMBER=100, BIRTHRATE-%=60, GAIN-FROM-FOOD=2)

## GRASS-REGROWTH-

RATE	Value of TEETH after 50 years  
85	  
70	  
55	  
40	

14. Combine your results with other teams. What can you conclude about the effect of a scarcity of grass on evolution of teeth? 

To watch a mutation in the sheep population, go on to sheep-mutation.</script>
<script type="text/javascript" src="app.js"></script>
    <script type="text/javascript">
;

      var widgets = [{"left":339,"top":10,"right":677,"bottom":369,"patchSize":8.0,"fontSize":14,"wrappingAllowedInX":true,"wrappingAllowedInY":true,"minPxcor":-20,"maxPxcor":20,"minPycor":-20,"maxPycor":20,"updateMode":"Continuous","showTickCounter":true,"tickCounterLabel":"ticks","frameRate":30.0,"type":"view"},{"display":"initial-number","left":165,"top":10,"right":323,"bottom":43,"varName":"initial-number","min":"0","max":"250","default":100.0,"step":"1","units":null,"direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"250"},"compiledStep":{"success":true,"result":"1"}},{"display":"gain-from-food","left":166,"top":78,"right":322,"bottom":111,"varName":"gain-from-food","min":"0.0","max":"4","default":2.0,"step":"0.5","units":null,"direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"4"},"compiledStep":{"success":true,"result":"0.5"}},{"display":"grass-regrowth-rate","left":165,"top":44,"right":323,"bottom":77,"varName":"grass-regrowth-rate","min":"5","max":"95","default":80.0,"step":"5","units":null,"direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"5"},"compiledMax":{"success":true,"result":"95"},"compiledStep":{"success":true,"result":"5"}},{"display":"setup","left":49,"top":10,"right":118,"bottom":43,"source":"setup","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(setup);"}},{"display":"go once","left":38,"top":51,"right":119,"bottom":84,"source":"go","forever":false,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"Teeth Average","left":301,"top":390,"right":497,"bottom":610,"xAxis":"time","yAxis":"teeth","xmin":0.0,"xmax":20.0,"ymin":0.8,"ymax":1.2,"autoPlotOn":true,"legendOn":true,"setupCode":"","updateCode":"","pens":[{"display":"teeth","interval":1.0,"mode":0,"color":-16777216,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}}],"type":"plot","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"sheep","left":70,"top":302,"right":120,"bottom":347,"source":"count turtles","precision":3,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.turtles().size()"}},{"display":"year","left":11,"top":302,"right":61,"bottom":347,"source":"year","precision":0,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.observer.getGlobal('year')"}},{"display":"Each year, reduce the herd by remove-number, chosen from those with best teeth","left":15,"top":207,"right":157,"bottom":266,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"go/stop","left":41,"top":93,"right":123,"bottom":126,"source":"go","forever":true,"buttonType":"OBSERVER","actionKey":null,"type":"button","compiledSource":{"success":true,"result":"Call(go);"}},{"display":"selection?","left":183,"top":160,"right":301,"bottom":193,"varName":"selection?","on":false,"type":"switch"},{"display":"Teeth Average","left":134,"top":304,"right":224,"bottom":349,"source":"teeth-avg","precision":2,"fontSize":11,"type":"monitor","compiledSource":{"success":true,"result":"world.observer.getGlobal('teeth-avg')"}},{"display":"remove-number","left":175,"top":215,"right":301,"bottom":248,"varName":"remove-number","min":"0","max":"10","default":0.0,"step":"1","units":null,"direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"10"},"compiledStep":{"success":true,"result":"1"}},{"display":"if selection? is ON, animals with better teeth get more energy from grass","left":14,"top":156,"right":164,"bottom":204,"fontSize":11,"color":0.0,"transparent":false,"type":"textBox"},{"display":"Teeth type percentage","left":10,"top":390,"right":290,"bottom":610,"xAxis":null,"yAxis":null,"xmin":0.0,"xmax":100.0,"ymin":0.0,"ymax":100.0,"autoPlotOn":true,"legendOn":true,"setupCode":"","updateCode":"","pens":[{"display":"better teeth","interval":1.0,"mode":0,"color":-2674135,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"standard teeth","interval":1.0,"mode":0,"color":-6459832,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"worse teeth","interval":1.0,"mode":0,"color":-16777216,"inLegend":true,"setupCode":"","updateCode":"","type":"pen","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}}],"type":"plot","compiledSetupCode":{"success":true,"result":""},"compiledUpdateCode":{"success":true,"result":""}},{"display":"birthrate-%","left":166,"top":115,"right":322,"bottom":148,"varName":"birthrate-%","min":"0","max":"100","default":100.0,"step":"1","units":null,"direction":"horizontal","type":"slider","compiledMin":{"success":true,"result":"0"},"compiledMax":{"success":true,"result":"100"},"compiledStep":{"success":true,"result":"1"}}];
      var code    = document.querySelector("#nlogo-code").textContent;
      var info    = document.querySelector("#nlogo-info").textContent;
      var session = Tortoise.fromCompiledModel('#model-container', widgets, code, info, '', true);
      var modelConfig  = (typeof window.modelConfig !== "undefined" && window.modelConfig !== null) ? window.modelConfig : {};
var modelPlotOps = (typeof modelConfig.plotOps !== "undefined" && modelConfig.plotOps !== null) ? modelConfig.plotOps : {};

var PenBundle = tortoise_require('engine/plot/pen');
var Plot      = tortoise_require('engine/plot/plot');
var PlotOps   = tortoise_require('engine/plot/plotops');

modelConfig.plots = [(function() {
  var name    = 'Teeth Average';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('teeth', plotOps.makePenOps, false, new PenBundle.State(0.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth Average', 'teeth')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth Average', 'teeth')(function() {}); }); })];
  var setup   = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth Average', undefined)(function() {}); }); };
  var update  = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth Average', undefined)(function() {}); }); };
  return new Plot(name, pens, plotOps, 'time', 'teeth', true, 0.0, 20.0, 0.8, 1.2, setup, update);
})(), (function() {
  var name    = 'Teeth type percentage';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('better teeth', plotOps.makePenOps, false, new PenBundle.State(15.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'better teeth')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'better teeth')(function() {}); }); }),
new PenBundle.Pen('standard teeth', plotOps.makePenOps, false, new PenBundle.State(35.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'standard teeth')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'standard teeth')(function() {}); }); }),
new PenBundle.Pen('worse teeth', plotOps.makePenOps, false, new PenBundle.State(0.0, 1.0, PenBundle.DisplayMode.Line), function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'worse teeth')(function() {}); }); }, function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', 'worse teeth')(function() {}); }); })];
  var setup   = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', undefined)(function() {}); }); };
  var update  = function() { workspace.rng.withAux(function() { plotManager.withTemporaryContext('Teeth type percentage', undefined)(function() {}); }); };
  return new Plot(name, pens, plotOps, '', '', true, 0.0, 100.0, 0.0, 100.0, setup, update);
})()];

var workspace = tortoise_require('engine/workspace')(modelConfig)([{ name: 'MALES', singular: 'turtle', varNames: ['genea', 'geneb', 'genec', 'gened'] }, { name: 'FEMALES', singular: 'turtle', varNames: ['genea', 'geneb', 'genec', 'gened'] }])(['energy', 'teeth', 'age'], [])(['initial-number', 'gain-from-food', 'grass-regrowth-rate', 'selection?', 'remove-number', 'birthrate-%', 'year', 'year-length', 'fence?', 'grass?', 'teeth-avg'], ['initial-number', 'gain-from-food', 'grass-regrowth-rate', 'selection?', 'remove-number', 'birthrate-%'], ['countdown'], -20, 20, -20, 20, 8.0, true, true, {"default":{"rotate":true,"elements":[{"xcors":[150,40,150,260],"ycors":[5,250,205,250],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true}]},"ewes":{"rotate":false,"elements":[{"xcors":[91,70,41,16,1,2,23,49,49,58,48,61,85,72,90,122,152,198,190,201,231,215,227,229,220,241,249,252,270,259,239,195,168,140,122],"ycors":[124,96,91,101,127,147,170,175,202,216,248,293,292,251,208,220,220,212,252,287,288,249,186,173,146,153,179,191,189,148,121,116,116,116,123],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[247,218,215,237],"ycors":[175,151,142,144],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[84,135,169,200,198,104,75],"ycors":[218,233,229,224,207,203,203],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[3,12,29,39,63],"ycors":[126,97,88,88,94],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[269,263,247,253],"ycors":[188,212,208,192],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"rams2":{"rotate":false,"elements":[{"xcors":[92,157,238,266,274,270,260,248,229,242,242,232,251,225,204,208,155,92,56,67,39,30,72,59,35,15,3,1,12,47,13,52,78,110,126,129,116,103,111,99,69,64,82,92,126,155,156],"ycors":[102,97,108,146,183,199,197,159,137,184,208,250,292,295,240,195,202,181,206,252,252,199,157,127,125,120,100,68,46,35,47,28,22,25,39,53,73,74,55,39,42,50,66,90,91,97,98],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[69,83,58,57],"ycors":[55,41,40,56],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"sheep":{"rotate":false,"elements":[{"xmin":90,"ymin":75,"xmax":270,"ymax":225,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":15,"y":75,"diam":150,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":81,"ymin":225,"xmax":134,"ymax":286,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":180,"ymin":225,"xmax":238,"ymax":285,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"x":1,"y":88,"diam":92,"type":"circle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false}]},"sheep2":{"rotate":false,"elements":[{"xmin":64,"ymin":116,"xmax":243,"ymax":214,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":244,"ymin":214,"xmax":244,"ymax":215,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":244,"ymin":215,"xmax":245,"ymax":216,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":91,"ymin":220,"xmax":127,"ymax":280,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":221,"xmax":224,"ymax":283,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":221,"xmax":189,"ymax":220,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"x":12,"y":65,"diam":105,"type":"circle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[129,195,257,246],"ycors":[116,105,124,175],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[258,271,264,251],"ycors":[128,193,195,157],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[58,90,94,76,59,63],"ycors":[69,72,111,118,110,84],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":false},{"xcors":[63,50,76],"ycors":[93,115,117],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":false},{"xcors":[224,190,191],"ycors":[219,218,225],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":190,"ymin":221,"xmax":225,"ymax":226,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xmin":92,"ymin":220,"xmax":127,"ymax":225,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true},{"xcors":[250,253,264,276,274,257],"ycors":[164,196,198,195,159,128],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":true}]},"wolf":{"rotate":false,"elements":[{"xmin":15,"ymin":105,"xmax":105,"ymax":165,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":45,"ymin":90,"xmax":105,"ymax":105,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[60,83,104],"ycors":[90,44,90],"type":"polygon","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xcors":[67,82,97],"ycors":[90,59,89],"type":"polygon","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":48,"ymin":93,"xmax":59,"ymax":105,"type":"rectangle","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xmin":51,"ymin":96,"xmax":55,"ymax":101,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":0,"ymin":121,"xmax":15,"ymax":135,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xmin":15,"ymin":136,"xmax":60,"ymax":151,"type":"rectangle","color":"rgba(0, 0, 0, 1.0)","filled":true,"marked":false},{"xcors":[15,23,31],"ycors":[136,149,136],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xcors":[30,37,43],"ycors":[151,136,151],"type":"polygon","color":"rgba(255, 255, 255, 1.0)","filled":true,"marked":false},{"xmin":105,"ymin":120,"xmax":263,"ymax":195,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":108,"ymin":195,"xmax":259,"ymax":201,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":114,"ymin":201,"xmax":252,"ymax":210,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":120,"ymin":210,"xmax":243,"ymax":214,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":115,"ymin":114,"xmax":255,"ymax":120,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":128,"ymin":108,"xmax":248,"ymax":114,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":150,"ymin":105,"xmax":225,"ymax":108,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":132,"ymin":214,"xmax":155,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":110,"ymin":260,"xmax":132,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":210,"ymin":214,"xmax":232,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"xmin":189,"ymin":260,"xmax":210,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1.0)","filled":true,"marked":true},{"x1":263,"y1":127,"x2":281,"y2":155,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true},{"x1":281,"y1":155,"x2":281,"y2":192,"type":"line","color":"rgba(141, 141, 141, 1.0)","filled":false,"marked":true}]}}, {"default":{}});

var BreedManager  = workspace.breedManager;
var LayoutManager = workspace.layoutManager;
var LinkPrims     = workspace.linkPrims;
var ListPrims     = workspace.listPrims;
var MousePrims    = workspace.mousePrims;
var plotManager   = workspace.plotManager;
var Prims         = workspace.prims;
var SelfPrims     = workspace.selfPrims;
var SelfManager   = workspace.selfManager;
var Updater       = workspace.updater;
var world         = workspace.world;

var Call           = tortoise_require('util/call');
var ColorModel     = tortoise_require('util/colormodel');
var Exception      = tortoise_require('util/exception');
var Trig           = tortoise_require('util/trig');
var Type           = tortoise_require('util/typechecker');
var notImplemented = tortoise_require('util/notimplemented');

var Dump      = tortoise_require('engine/dump');
var Link      = tortoise_require('engine/core/link');
var LinkSet   = tortoise_require('engine/core/linkset');
var Nobody    = tortoise_require('engine/core/nobody');
var PatchSet  = tortoise_require('engine/core/patchset');
var Turtle    = tortoise_require('engine/core/turtle');
var TurtleSet = tortoise_require('engine/core/turtleset');
var Tasks     = tortoise_require('engine/prim/tasks');

var AgentModel = tortoise_require('agentmodel');
var Denuller   = tortoise_require('nashorn/denuller');
var Random     = tortoise_require('shim/random');
var StrictMath = tortoise_require('shim/strictmath');
function startup() {
  Call(setup);
}
function setup() {
  world.clearAll();
  world.observer.setGlobal('year', 0);
  world.observer.setGlobal('year-length', 12);
  world.patches().ask(function() {
    SelfPrims.setPatchVariable('pcolor', 55);
  }, true);
  world.observer.setGlobal('fence?', false);
  world.observer.setGlobal('grass?', true);
  if (world.observer.getGlobal('grass?')) {
    world.patches().ask(function() {
      SelfPrims.setPatchVariable('countdown', Prims.random((101 - world.observer.getGlobal('grass-regrowth-rate'))));
      if (Prims.equality(Prims.random(2), 0)) {
        SelfPrims.setPatchVariable('pcolor', 35);
      }
    }, true);
  }
  world.patches().ask(function() {
    Call(createFences);
  }, true);
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("FEMALES").getBreedName(), "ewes")
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("MALES").getBreedName(), "rams2")
  world.turtleManager.createTurtles((world.observer.getGlobal('initial-number') / 2), 'MALES').ask(function() {
    SelfPrims.setVariable('color', 9.9);
    SelfPrims.setVariable('size', 3);
    SelfPrims.setVariable('age', Prims.random(5));
    SelfPrims.setVariable('energy', Prims.random((2 * world.observer.getGlobal('gain-from-food'))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    Prims.repeat(6, function() {
      if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 15)) {
        SelfPrims.right(90);
        SelfPrims.fd(3);
      }
    });
    SelfPrims.setVariable('genea', Prims.random(2));
    SelfPrims.setVariable('geneb', Prims.random(2));
    SelfPrims.setVariable('genec', Prims.random(2));
    SelfPrims.setVariable('gened', Prims.random(2));
  }, true);
  world.turtleManager.createTurtles((world.observer.getGlobal('initial-number') / 2), 'FEMALES').ask(function() {
    SelfPrims.setVariable('color', 9.9);
    SelfPrims.setVariable('size', 3);
    SelfPrims.setVariable('age', Prims.random(5));
    SelfPrims.setVariable('energy', Prims.random((2 * world.observer.getGlobal('gain-from-food'))));
    SelfPrims.setXY(Prims.randomFloat(world.topology.width), Prims.randomFloat(world.topology.height));
    if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 15)) {
      SelfPrims.right(180);
      SelfPrims.fd(1);
    }
    Prims.repeat(6, function() {
      if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 15)) {
        SelfPrims.right(90);
        SelfPrims.fd(3);
      }
    });
    SelfPrims.setVariable('genea', Prims.random(2));
    SelfPrims.setVariable('geneb', Prims.random(2));
    SelfPrims.setVariable('genec', Prims.random(2));
    SelfPrims.setVariable('gened', Prims.random(2));
  }, true);
  world.turtles().ask(function() {
    if (Prims.equality((SelfPrims.getVariable('genea') + SelfPrims.getVariable('geneb')), 2)) {
      SelfPrims.setVariable('teeth', 1.2);
    }
    if (Prims.equality((SelfPrims.getVariable('genea') + SelfPrims.getVariable('geneb')), 1)) {
      SelfPrims.setVariable('teeth', 1);
    }
    if (Prims.equality((SelfPrims.getVariable('genea') + SelfPrims.getVariable('geneb')), 0)) {
      SelfPrims.setVariable('teeth', 0.8);
    }
  }, true);
  world.observer.setGlobal('teeth-avg', (ListPrims.sum(world.turtles().projectionBy(function() {
    return SelfPrims.getVariable('teeth');
  })) / world.turtles().size()));
  Call(setupHistogram);
  Call(doPlot);
}
function go() {
  Prims.repeat(world.observer.getGlobal('year-length'), function() {
    world.turtleManager.turtlesOfBreed("MALES").ask(function() {
      Call(move);
      Call(eatGrass);
      Call(death);
    }, true);
    world.turtleManager.turtlesOfBreed("FEMALES").ask(function() {
      Call(move);
      Call(eatGrass);
      Call(death);
    }, true);
    if (world.observer.getGlobal('grass?')) {
      world.patches().ask(function() {
        Call(growGrass);
      }, true);
    }
    world.turtles().ask(function() {
      SelfPrims.setVariable('size', (3 * SelfPrims.getVariable('teeth')));
    }, true);
    notImplemented('display', undefined)();
  });
  world.turtleManager.turtlesOfBreed("MALES").ask(function() {
    SelfPrims.setVariable('age', (SelfPrims.getVariable('age') + 1));
  }, true);
  world.turtleManager.turtlesOfBreed("FEMALES").ask(function() {
    SelfPrims.setVariable('age', (SelfPrims.getVariable('age') + 1));
    if ((Prims.gt(SelfPrims.getVariable('age'), 1) && Prims.lte(SelfPrims.getVariable('age'), 6))) {
      Call(reproduce);
    }
  }, true);
  world.observer.setGlobal('year', (world.observer.getGlobal('year') + 1));
  if (Prims.gt(world.turtles().size(), 0)) {
    world.observer.setGlobal('teeth-avg', (ListPrims.sum(world.turtles().projectionBy(function() {
      return SelfPrims.getVariable('teeth');
    })) / world.turtles().size()));
    Call(doPlot);
  }
  Call(removeSome);
  if (!world.turtles().nonEmpty()) {
    throw new Exception.StopInterrupt;
  }
}
function move() {
  SelfPrims.right((Prims.randomFloat(50) - Prims.randomFloat(50)));
  SelfPrims.fd(1);
  if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 15)) {
    SelfPrims.right(180);
    SelfPrims.fd(1);
  }
}
function eatGrass() {
  if (world.observer.getGlobal('grass?')) {
    SelfPrims.setVariable('energy', (SelfPrims.getVariable('energy') - 1));
    if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 55)) {
      SelfPrims.setPatchVariable('pcolor', 35);
      if (world.observer.getGlobal('selection?')) {
        SelfPrims.setVariable('energy', (SelfPrims.getVariable('energy') + (world.observer.getGlobal('gain-from-food') * SelfPrims.getVariable('teeth'))));
      }
      else {
        SelfPrims.setVariable('energy', (SelfPrims.getVariable('energy') + (world.observer.getGlobal('gain-from-food') * 1)));
      }
    }
  }
}
function reproduce() {
  if (Prims.lt(Prims.random(100), world.observer.getGlobal('birthrate-%'))) {
    Call(breedAndBirth);
  }
}
function breedAndBirth() {
  if (Prims.gt(world.turtleManager.turtlesOfBreed("MALES").size(), 0)) {
    SelfPrims.hatch(1, '').ask(function() {
      SelfPrims.fd(10);
      SelfPrims.setVariable('age', 0);
      SelfPrims.setVariable('energy', 3);
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable('breed', world.turtleManager.turtlesOfBreed("MALES"));
      }
      else {
        SelfPrims.setVariable('breed', world.turtleManager.turtlesOfBreed("FEMALES"));
      }
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable('genea', SelfPrims.getVariable('genea'));
      }
      else {
        SelfPrims.setVariable('genea', SelfPrims.getVariable('geneb'));
      }
      if (Prims.equality(Prims.random(2), 1)) {
        SelfPrims.setVariable('geneb', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES")).projectionBy(function() {
          return SelfPrims.getVariable('genea');
        }));
      }
      else {
        SelfPrims.setVariable('geneb', ListPrims.oneOf(world.turtleManager.turtlesOfBreed("MALES")).projectionBy(function() {
          return SelfPrims.getVariable('geneb');
        }));
      }
      if (Prims.equality((SelfPrims.getVariable('genea') + SelfPrims.getVariable('geneb')), 2)) {
        SelfPrims.setVariable('teeth', 1.2);
      }
      if (Prims.equality((SelfPrims.getVariable('genea') + SelfPrims.getVariable('geneb')), 1)) {
        SelfPrims.setVariable('teeth', 1);
      }
      if (Prims.equality((SelfPrims.getVariable('genea') + SelfPrims.getVariable('geneb')), 0)) {
        SelfPrims.setVariable('teeth', 0.8);
      }
    }, true);
  }
}
function removeSome() {
  if (Prims.gt(world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable('teeth'), 1.2);
  }).size(), world.observer.getGlobal('remove-number'))) {
    ListPrims.nOf(world.observer.getGlobal('remove-number'), world.turtles().agentFilter(function() {
      return Prims.equality(SelfPrims.getVariable('teeth'), 1.2);
    })).ask(function() {
      SelfPrims.die();
    }, true);
  }
  else {
    world.turtles().agentFilter(function() {
      return Prims.equality(SelfPrims.getVariable('teeth'), 1.2);
    }).ask(function() {
      SelfPrims.die();
    }, true);
  }
}
function death() {
  if (Prims.lt(SelfPrims.getVariable('energy'), 0)) {
    SelfPrims.die();
  }
  if (Prims.gt(SelfPrims.getVariable('age'), 6)) {
    SelfPrims.die();
  }
}
function growGrass() {
  if (Prims.equality(SelfPrims.getPatchVariable('pcolor'), 35)) {
    if (Prims.lte(SelfPrims.getPatchVariable('countdown'), 0)) {
      SelfPrims.setPatchVariable('pcolor', 55);
      SelfPrims.setPatchVariable('countdown', (102 - world.observer.getGlobal('grass-regrowth-rate')));
    }
    else {
      SelfPrims.setPatchVariable('countdown', (SelfPrims.getPatchVariable('countdown') - 1));
    }
  }
}
function createFences() {
  if (Prims.equality(StrictMath.abs(SelfPrims.getPatchVariable('pxcor')), world.topology.maxPxcor)) {
    SelfPrims.setPatchVariable('pcolor', 15);
  }
  if (Prims.equality(StrictMath.abs(SelfPrims.getPatchVariable('pycor')), world.topology.maxPycor)) {
    SelfPrims.setPatchVariable('pcolor', 15);
  }
  if ((Prims.equality(SelfPrims.getPatchVariable('pxcor'), 0) && world.observer.getGlobal('fence?'))) {
    SelfPrims.setPatchVariable('pcolor', 15);
  }
}
function setupHistogram() {

}
function doPlot() {
  plotManager.setCurrentPlot("Teeth Average");
  plotManager.setCurrentPen("teeth");
  plotManager.plotValue(world.observer.getGlobal('teeth-avg'));
  plotManager.setCurrentPlot("teeth type percentage");
  plotManager.setCurrentPen("better teeth");
  plotManager.plotValue(((100 * world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable('teeth'), 1.2);
  }).size()) / world.turtles().size()));
  plotManager.setCurrentPen("standard teeth");
  plotManager.plotValue(((100 * world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable('teeth'), 1);
  }).size()) / world.turtles().size()));
  plotManager.setCurrentPen("worse teeth");
  plotManager.plotValue(((100 * world.turtles().agentFilter(function() {
    return Prims.equality(SelfPrims.getVariable('teeth'), 0.8);
  }).size()) / world.turtles().size()));
}
world.observer.setGlobal('initial-number', 100);
world.observer.setGlobal('gain-from-food', 2);
world.observer.setGlobal('grass-regrowth-rate', 80);
world.observer.setGlobal('selection?', false);
world.observer.setGlobal('remove-number', 0);
world.observer.setGlobal('birthrate-%', 100);
      session.startLoop()
    </script>
  

</body></html>